<%@ Page Title="" Language="C#" MasterPageFile="~/ERPMaster.master" EnableEventValidation="false" AutoEventWireup="true" CodeFile="SalesInvoice1.aspx.cs" Inherits="Sales_SalesInvoice1" %>

<%@ Register Src="~/WebUserControl/Expenses_Tax.ascx" TagName="Expenses_Tax" TagPrefix="ET" %>
<%@ Register Src="~/WebUserControl/AddContact.ascx" TagName="Contactmaster" TagPrefix="UC" %>
<%@ Register Assembly="AjaxControlToolkit" Namespace="AjaxControlToolkit" TagPrefix="cc1" %>
<%@ Register Src="~/WebUserControl/AccountMaster.ascx" TagPrefix="uc1" TagName="AccountMaster" %>
<%@ Register Assembly="AjaxControlToolkit" Namespace="AjaxControlToolkit.HTMLEditor"
    TagPrefix="cc1" %>
<%@ Register Src="~/WebUserControl/AddressControl.ascx" TagName="AddAddress" TagPrefix="AA1" %>
<%@ Register Src="~/WebUserControl/ContactInfo.ascx" TagName="ViewContact" TagPrefix="AT1" %>

<asp:Content ID="Content1" ContentPlaceHolderID="Head" runat="Server">

    <style type="text/css">
        .pager {
            background-color: #3AC0F2;
            color: white;
            height: 30px;
            min-width: 30px;
            line-height: 30px;
            display: block;
            text-align: center;
            text-decoration: none;
            border: 1px solid #2E99C1;
        }

        .active_pager {
            background-color: #2E99C1;
            color: white;
            height: 30px;
            min-width: 30px;
            line-height: 30px;
            display: block;
            text-align: center;
            text-decoration: none;
            border: 1px solid #2E99C1;
        }

        .grid td, .grid th {
            text-align: center;
        }

        tooltip-inner {
            max-width: none;
            white-space: nowrap;
        }

        #progressBar {
            visibility: hidden;
            min-width: 250px;
            border-radius: 2px;
            padding: 16px;
            position: fixed;
            z-index: 1;
            top: 50%;
            left: 50%;
            font-size: 17px;
        }

            #progressBar.show {
                visibility: visible;
                -webkit-animation: fadein 0.5s;
                animation: fadein 0.5s;
            }

            #progressBar.hide {
                visibility: hidden;
                -webkit-animation: fadeout 0.5s 2.5s;
                animation: fadeout 0.5s 2.5s;
            }

        @-webkit-keyframes fadein {
            from {
                top: 0;
                opacity: 0;
            }

            to {
                top: 30px;
                opacity: 1;
            }
        }

        @keyframes fadein {
            from {
                top: 0;
                opacity: 0;
            }

            to {
                top: 30px;
                opacity: 1;
            }
        }

        @-webkit-keyframes fadeout {
            from {
                top: 30px;
                opacity: 1;
            }

            to {
                top: 0;
                opacity: 0;
            }
        }

        @keyframes fadeout {
            from {
                top: 30px;
                opacity: 1;
            }

            to {
                top: 0;
                opacity: 0;
            }
        }
    </style>
</asp:Content>
<asp:Content ID="Content2" ContentPlaceHolderID="HeaderContent" runat="Server">
</asp:Content>
<asp:Content ID="Content3" ContentPlaceHolderID="MainContent" runat="Server">
    <asp:UpdatePanel ID="Update_Button" runat="server">
        <ContentTemplate>
            <asp:Button ID="Btn_View_Modal" Style="display: none;" runat="server" data-toggle="modal" data-target="#Return_Modal" Text="View Modal" />
            <asp:Button ID="Btn_GST_Modal" Style="display: none;" runat="server" data-toggle="modal" data-target="#Modal_GST" Text="GST" />
            <asp:Button ID="Btn_Show_Expenses_Tax" Style="display: none;" runat="server" data-toggle="modal" data-target="#Expenses_Tax_Web_Control" Text="Expenses Tax" />
            <asp:Button ID="Btn_Modal_Expenses_Tax" Style="display: none;" runat="server" data-toggle="modal" data-target="#Modal_Expenses_Tax" Text="Expenses Tax" />
            <asp:Button ID="Btn_NewAddress" Style="display: none;" runat="server" data-toggle="modal" data-target="#NewAddress" Text="New Address" />
        </ContentTemplate>
    </asp:UpdatePanel>
    <asp:UpdateProgress ID="UpdateProgress11" runat="server" AssociatedUpdatePanelID="Update_Button">
        <ProgressTemplate>
            <div class="modal_Progress">
                <div class="center_Progress">
                    <img alt="" src="../Images/ajax-loader2.gif" style="vertical-align: middle; background-color: White; border-radius: 10px;" />
                </div>
            </div>
        </ProgressTemplate>
    </asp:UpdateProgress>
    <div id="progressBar">
        <img alt="" src="../Images/ajax-loader2.gif" style="vertical-align: middle; background-color: White; border-radius: 10px;" />
    </div>

    <div class="row">
        <div class="col-md-12">
            <div class="nav-tabs-custom">
                <ul class="nav nav-tabs pull-right bg-blue-gradient">
                    
                    <li id="Li_Cancel"><a href="#Cancel" data-toggle="tab">
                        <i class="fa fa-list"></i>&nbsp;&nbsp;<asp:Label ID="Label25" runat="server" Text="<%$ Resources:Attendance,Cancel %>"></asp:Label></a></li>
                    
                    <li style="display: none" id="Li_Job_Card"><a href="#Job_Card" onclick="Li_Tab_Job_Card()" data-toggle="tab">
                        <i class="fa fa-file"></i>&nbsp;&nbsp;<asp:Label ID="Label29" runat="server" Text="<%$ Resources:Attendance,Job Card%>"></asp:Label></a></li>
                    <li id="Li_Pending_Order"><a href="#Pending_Order" onclick="Li_Tab_Pending_Order()" data-toggle="tab">
                        <i class="fas fa-user-check"></i>&nbsp;&nbsp;<asp:Label ID="Label13" runat="server" Text="<%$ Resources:Attendance,Pending Order %>"></asp:Label></a></li>
                    <li id="Li_New"><a href="#New" data-toggle="tab">
                        <asp:UpdatePanel ID="Update_Li" runat="server">
                            <ContentTemplate>
                                <i class="fa fa-file"></i>&nbsp;&nbsp;
                                <asp:Label ID="Lbl_Tab_New" runat="server" Text="<%$ Resources:Attendance,New%>"></asp:Label>
                            </ContentTemplate>
                        </asp:UpdatePanel>
                    </a></li>
                    <li id="Li_List" class="active"><a href="#List" data-toggle="tab">
                        <i class="fa fa-list"></i>&nbsp;&nbsp;<asp:Label ID="Label1" runat="server" Text="<%$ Resources:Attendance,List %>"></asp:Label></a></li>
                  
                </ul>
                <div class="tab-content">
                    <div class="tab-pane active" id="List">
                         <div style="display: none;">
                          <asp:Button ID="btnShowPopup" runat="server" Text="Show Popup" OnClientClick="ShowPopup();" CssClass="btn btn-info btn-lg" />                     
                        </div>
                        <asp:UpdatePanel ID="Update_List" runat="server">
                            <ContentTemplate>
                                <div class="row">
                                    <div class="form-group">
                                        <asp:HiddenField ID="hdnTransType" runat="server" />
                                        <asp:HiddenField ID="hdnTransTypeValue" runat="server" />

                                        <asp:HiddenField ID="hdnDecimalCount" runat="server" />
                                        <asp:HiddenField ID="hdnCurrencyCode" runat="server" />
                                        <asp:HiddenField ID="hdnDefaultCurrencyIndex" runat="server" />
                                        <asp:HiddenField ID="hdnDefaultSalesPersonName" runat="server" />
                                        <asp:HiddenField ID="hdnDocNo" runat="server" />
                                        <asp:HiddenField ID="hdnIsApproved" runat="server" />
                                        <asp:HiddenField ID="hdnQtyDecimal" runat="server" />
                                        <asp:HiddenField ID="hdnCanView" runat="server" />
                                        <asp:HiddenField ID="hdnCanEdit" runat="server" />
                                        <asp:HiddenField ID="hdnCanSave" runat="server" />
                                        <asp:HiddenField ID="hdnCanPrint" runat="server" />
                                        <asp:HiddenField ID="hdnCanRestore" runat="server" />
                                        <asp:HiddenField ID="hdnCanUpload" runat="server" />
                                        <asp:HiddenField ID="hdnCanDelete" runat="server" />

                                        <div class="col-lg-4">
                                            <asp:DropDownList ID="ddlPosted" runat="server" CssClass="form-control" onchange="setDllActionOptions();fillTblInvoice()">
                                                <asp:ListItem Text="<%$ Resources:Attendance,Posted %>" Value="posted"></asp:ListItem>
                                                <asp:ListItem Text="<%$ Resources:Attendance,UnPosted %>" Value="unPosted" Selected="True"></asp:ListItem>
                                                <asp:ListItem Text="<%$ Resources:Attendance,Bin %>" Value="inActive"></asp:ListItem>
                                                <asp:ListItem Text="<%$ Resources:Attendance,All %>" Value="all"></asp:ListItem>
                                            </asp:DropDownList>
                                        </div>
                                        <div class="col-md-4">
                                            <asp:DropDownList ID="ddlAction" runat="server" onchange="ddlActionChange(this)" CssClass="form-control">                                          

                                           </asp:DropDownList>
                                        </div>
                                    </div>
                                </div>
                                <br />
                                <div class="box box-solid">

                                    <div class="box-body">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="col-md-12" style="overflow: auto; width: 100%">
                                                    <table id="tblInvoice" class="table table-striped table-bordered" style="width: 100%">
                                                        <thead>
                                                            <tr>
                                                                <td></td>
                                                                <td>Invoice No.</td>
                                                                <td>Invoice Date</td>
                                                                <td>Ref. Type</td>
                                                                <td>Ref. No.</td>
                                                                <td>Sales Person</td>
                                                                <td>Customer Name</td>
                                                                <td>Status</td>
                                                                <td>Created By</td>
                                                                <td>Amount</td>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                        </tbody>
                                                    </table>
                                                    <table id="tblPaging">
                                                        <tbody>
                                                            <tr></tr>
                                                        </tbody>
                                                    </table>

                                                </div>
                                                <br />

                                            </div>

                                        </div>
                                    </div>
                                    <!-- /.box-body -->
                                </div>

                                <%--  <script type="text/javascript" src='https://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.8.3.min.js'></script>
                                <script type="text/javascript" src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.0.3/js/bootstrap.min.js'></script>
                                <link rel="stylesheet" href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.0.3/css/bootstrap.min.css'
                                    media="screen" />--%>
                                <!-- Bootstrap -->
                                <div id="MyPopup" class="modal fade" role="dialog">
                                    <div class="modal-dialog">
                                        <!-- Modal content-->
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <button type="button" class="close" data-dismiss="modal">
                                                    &times;</button>
                                                <h4 class="modal-title"></h4>
                                            </div>
                                            <div class="modal-body">
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <div class="box box-primary">
                                                            <div class="box-body">
                                                                <div class="form-group">
                                                                    <div class="col-md-12">
                                                                        <br />
                                                                        <asp:Label ID="lblDesc" runat="server" Text="<%$ Resources:Attendance,Comment %>"></asp:Label>
                                                                        &nbsp:&nbsp<asp:TextBox ID="txtCancelDescription" runat="server" CssClass="form-control" TextMode="MultiLine" Height="100px"></asp:TextBox>
                                                                        <br />
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <asp:Button ID="btnUpdateCancelInvoice" runat="server" CssClass="btn btn-primary"
                                                    Text="<%$ Resources:Attendance,Update %>" OnClick="btnUpdateCancelInvoice_Click" />
                                                <button type="button" class="btn btn-danger" data-dismiss="modal">
                                                    Close</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>



                            </ContentTemplate>
                        </asp:UpdatePanel>
                    </div>
                    <div class="tab-pane" id="New">
                        <asp:UpdatePanel ID="Update_New" runat="server">
                            <ContentTemplate>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="box box-primary">
                                            <div class="box-body">
                                                <div class="form-group">

                                                    <div class="col-md-6">
                                                        <asp:HiddenField ID="Hdn_Tax_By" runat="server" />
                                                        <asp:HiddenField ID="hdnIsTaxEnabled" runat="server" Value="false" />
                                                        <asp:HiddenField ID="hdnIsDiscountEnable" runat="server" Value="false" />
                                                        <asp:HiddenField ID="hdnDenomination" runat="server" Value="" />
                                                        <asp:Label ID="lblSInvDate" runat="server" Text="<%$ Resources:Attendance,Invoice Date %>"></asp:Label>
                                                        <a style="color: Red">*</a>
                                                        <asp:RequiredFieldValidator EnableClientScript="true" Style="float: right;" runat="server" ID="RequiredFieldValidator3" ValidationGroup="Save"
                                                            Display="Dynamic" SetFocusOnError="true" ControlToValidate="txtSInvDate" ErrorMessage="<%$ Resources:Attendance,Enter Invoice Date %>"></asp:RequiredFieldValidator>
                                                        <asp:TextBox ID="txtSInvDate" onkeydown='return (event.keyCode!=13);' runat="server" CssClass="form-control no-border" Enabled="false" />
                                                        <cc1:CalendarExtender OnClientShown="showCalendar" ID="Calender" runat="server" TargetControlID="txtSInvDate" />
                                                        <br />
                                                    </div>
                                                    <div class="col-md-6">
                                                        <asp:Label ID="lblSInvNo" runat="server" Text="<%$ Resources:Attendance,Invoice No. %>"></asp:Label>
                                                        <a style="color: Red">*</a>
                                                        <asp:RequiredFieldValidator EnableClientScript="true" Style="float: right;" runat="server" ID="RequiredFieldValidator1" ValidationGroup="Save"
                                                            Display="Dynamic" SetFocusOnError="true" ControlToValidate="txtSInvNo" ErrorMessage="<%$ Resources:Attendance,Enter Invoice No %>"></asp:RequiredFieldValidator>

                                                        <asp:TextBox ID="txtSInvNo" onkeydown='return (event.keyCode!=13);' runat="server" CssClass="form-control" />
                                                        <br/>
                                                    </div>

                                                    <div class="col-md-6">
                                                        <asp:Label ID="lblCurrency" runat="server" Text="<%$ Resources:Attendance,Currency %>" />
                                                        <a style="color: Red">*</a>
                                                        <asp:RequiredFieldValidator EnableClientScript="true" Style="float: right;" runat="server" ID="RequiredFieldValidator2" ValidationGroup="Save" Display="Dynamic"
                                                            SetFocusOnError="true" ControlToValidate="ddlCurrency" InitialValue="--Select--" ErrorMessage="<%$ Resources:Attendance,Select Currency %>" />

                                                        <asp:DropDownList ID="ddlCurrency" runat="server" CssClass="form-control" onchange="setDecimalAndSymbol()" />

                                                        <br />
                                                    </div>
                                                    <div class="col-md-6">
                                                        <asp:Label ID="lblexchangerate" runat="server" Text="<%$ Resources:Attendance,Exchange Rate%>" />
                                                        <asp:TextBox ID="txtExchangeRate" onkeydown='return (event.keyCode!=13);' Text="1" onchange="txtExchangeRate_TextChanged()" runat="server" CssClass="form-control"></asp:TextBox>
                                                        <cc1:FilteredTextBoxExtender ID="FilteredTextBoxExtender18" runat="server" Enabled="True"
                                                            TargetControlID="txtExchangeRate" ValidChars="1,2,3,4,5,6,7,8,9,0,.">
                                                        </cc1:FilteredTextBoxExtender>
                                                        <br />
                                                    </div>
                                                    <div class="col-md-6">
                                                        <asp:Label ID="lblrefference" runat="server" Text="Refference No." />
                                                        <asp:TextBox ID="txtInvoiecRefno" onkeydown='return (event.keyCode!=13);' runat="server" CssClass="form-control"></asp:TextBox>
                                                        <br />
                                                    </div>
                                                    <div class="col-md-6">
                                                        <asp:Label ID="lblOrderId" runat="server" Text="Customer Order Id" />
                                                        <asp:TextBox ID="txtOrderId" onkeydown='return (event.keyCode!=13);' runat="server" CssClass="form-control"></asp:TextBox>
                                                        <br />
                                                    </div>
                                                    <div class="col-md-6">
                                                        <asp:Label ID="Label16" runat="server" Text="Invoice Merchant" />
                                                        <asp:DropDownList ID="ddlMerchant" runat="server" CssClass="form-control">
                                                        </asp:DropDownList>
                                                        <br />
                                                    </div>

                                                    <div class="col-md-6">
                                                        <asp:Label ID="lblPOSNo" runat="server" Text="<%$ Resources:Attendance,POS No.%>" />
                                                        <a style="color: Red; display: none">*</a>
                                                        <asp:RequiredFieldValidator EnableClientScript="true" Style="float: right;" runat="server" ID="RequiredFieldValidator6" ValidationGroup="Save"
                                                            Display="Dynamic" SetFocusOnError="true" ControlToValidate="txtPOSNo" ErrorMessage="<%$ Resources:Attendance,Enter POS No%>" Enabled="false"></asp:RequiredFieldValidator>

                                                        <asp:TextBox ID="txtPOSNo" onkeydown='return (event.keyCode!=13);' runat="server" CssClass="form-control" />
                                                        <br />
                                                    </div>
                                                    <div class="col-md-12">
                                                        <asp:Label ID="lblCustomerName" runat="server" Text="<%$ Resources:Attendance,Customer Name %>" />
                                                        <a style="color: Red">*</a>
                                                        <asp:RequiredFieldValidator EnableClientScript="true" Style="float: right;" runat="server" ID="RequiredFieldValidator7" ValidationGroup="Save"
                                                            Display="Dynamic" SetFocusOnError="true" ControlToValidate="txtCustomer" ErrorMessage="<%$ Resources:Attendance,Enter Customer Name %>"></asp:RequiredFieldValidator>

                                                        <div class="input-group">
                                                            <asp:TextBox onkeydown='return (event.keyCode!=13);' ID="txtCustomer" runat="server" CssClass="form-control" onchange="txtCustomer_TextChanged(this)" ClientIDMode="Static"
                                                                BackColor="#eeeeee" />
                                                            <cc1:AutoCompleteExtender ID="txtCustomerName_AutoCompleteExtender" runat="server"
                                                                DelimiterCharacters="" Enabled="True" CompletionInterval="100" CompletionSetCount="1"
                                                                MinimumPrefixLength="1" ServiceMethod="GetCompletionListCustomer" ServicePath=""
                                                                TargetControlID="txtCustomer" UseContextKey="True" CompletionListCssClass="autoCompleteList" CompletionListItemCssClass="autoCompleteListItem" CompletionListHighlightedItemCssClass="autoCompleteSelectedListItem" OnClientShown="resetPosition">
                                                            </cc1:AutoCompleteExtender>
                                                            <div class="input-group-btn">
                                                                <asp:Button ID="btnAddCustomer" runat="server" CssClass="btn btn-primary" OnClientClick="btnAddCustomer_OnClick();return false;"
                                                                    Text="<%$ Resources:Attendance,Add %>" CausesValidation="False" />
                                                                <asp:Button ID="lnkcustomerHistory" runat="server" Text="History" CssClass="btn btn-primary" CausesValidation="False"
                                                                    OnClientClick="lnkcustomerHistory_OnClick();return false;"></asp:Button>
                                                               <%-- <input type="button" class="btn btn-primary" value="Credit Detail" onclick="GetCreditInfo()" />--%>
                                                            </div>
                                                        </div>
                                                        <br />
                                                    </div>
                                                    <div class="col-md-6">
                                                        <asp:HiddenField runat="server" ID="hdnContactId" />
                                                        <asp:Label ID="Label5" runat="server" Text="Contact" />
                                                        <asp:TextBox ID="txtContactPerson" runat="server" CssClass="form-control" BackColor="#eeeeee" onchange="txtContactPerson_TextChanged(this)" />
                                                        <cc1:AutoCompleteExtender ID="AutoCompleteExtender1" runat="server"
                                                            DelimiterCharacters="" Enabled="True" CompletionInterval="100" CompletionSetCount="1"
                                                            MinimumPrefixLength="1" ServiceMethod="GetCompletionContactList" ServicePath=""
                                                            TargetControlID="txtContactPerson" UseContextKey="True" CompletionListCssClass="autoCompleteList" CompletionListItemCssClass="autoCompleteListItem" CompletionListHighlightedItemCssClass="autoCompleteSelectedListItem" OnClientShown="resetPosition">
                                                        </cc1:AutoCompleteExtender>
                                                        <br />
                                                       <asp:LinkButton ID="lnkAddNewContact" runat="server" ToolTip="Add New Contact" OnClick="lnkAddNewContact_Click" AlternateText="<%$ Resources:Attendance,Add %>" CausesValidation="False"><i class="fa fa-plus-square" style="font-size:35px;padding:5px;margin-top: -5px;"></i></asp:LinkButton>
                                                       
                                                    </div>
                                                    <div class="col-md-6">
                                                        <asp:Label ID="lblSalesPerson" runat="server" Text="<%$ Resources:Attendance,Sales Person%>" />
                                                        <a style="color: Red">*</a>
                                                        <asp:RequiredFieldValidator EnableClientScript="true" Style="float: right;" runat="server" ID="RequiredFieldValidator5" ValidationGroup="Save"
                                                            Display="Dynamic" SetFocusOnError="true" ControlToValidate="txtSalesPerson" ErrorMessage="<%$ Resources:Attendance,Enter Sales Person %>"></asp:RequiredFieldValidator>

                                                        <asp:TextBox onkeydown='return (event.keyCode!=13);' ID="txtSalesPerson" runat="server" CssClass="form-control" BackColor="#eeeeee"
                                                            onchange="validateEmployee(this)" />
                                                        <cc1:AutoCompleteExtender ID="txtSalesPerson_AutoCompleteExtender" runat="server"
                                                            DelimiterCharacters="" Enabled="True" CompletionInterval="100" CompletionSetCount="1"
                                                            MinimumPrefixLength="1" ServiceMethod="GetCompletionListEmployeeName" ServicePath=""
                                                            TargetControlID="txtSalesPerson" UseContextKey="True" CompletionListCssClass="autoCompleteList" CompletionListItemCssClass="autoCompleteListItem" CompletionListHighlightedItemCssClass="autoCompleteSelectedListItem" OnClientShown="resetPosition">
                                                        </cc1:AutoCompleteExtender>
                                                        <br />
                                                    </div>

                                                    <div class="col-md-6" id="Trans_Div" runat="server">
                                                        <asp:Label ID="lblTransType" runat="server" Text="Transaction Type"></asp:Label>
                                                        <asp:DropDownList ID="ddlTransType" runat="server" CssClass="form-control"></asp:DropDownList>
                                                        <br />
                                                    </div>
                                                       <div id="trCreditInfo" runat="server" style="display:none;" class="col-md-12">
                                                        <div class="box box-info">
                                                            <div class="box-header with-border">
                                                                <h3 class="box-title">
                                                                    <asp:Label ID="Label46" Font-Names="Times New roman" Font-Size="18px" Font-Bold="true"
                                                                        runat="server" Text="Credit Terms & Condition"></asp:Label></h3>
                                                                <div class="box-tools pull-right">
                                                                    <button type="button" class="btn btn-box-tool" data-widget="collapse">
                                                                        <i class="fa fa-minus"></i>
                                                                    </button>
                                                                </div>
                                                            </div>
                                                            <div class="box-body">
                                                                <div class="form-group">
                                                                    <div class="col-md-3">
                                                                        <asp:Label ID="Label6" runat="server" Font-Bold="true" Text="<%$ Resources:Attendance,Credit Limit %>"/>
                                                                        &nbsp:&nbsp<asp:Label ID="Label10" runat="server"></asp:Label>
                                                                        <asp:Label ID="Label17" runat="server"></asp:Label>
                                                                        <br />
                                                                    </div>
                                                                    <div class="col-md-3">
                                                                        <asp:Label ID="Label18" runat="server" Font-Bold="true" Text="<%$ Resources:Attendance,Credit Days %>" />
                                                                        &nbsp:&nbsp<asp:Label ID="Label19" runat="server"></asp:Label>
                                                                        <br />
                                                                    </div>
                                                                    <div class="col-md-3">
                                                                        <asp:Label ID="Label21" runat="server" Font-Bold="true" Text="Currenct Balance" />
                                                                        &nbsp:&nbsp<asp:Label ID="lblCurrentBalance" runat="server"></asp:Label>
                                                                        <br />
                                                                    </div>
                                                                    <div class="col-md-3">
                                                                        <asp:Label ID="Label20" runat="server" Font-Bold="true" Text="Credit Parameter" />
                                                                        &nbsp:&nbsp<asp:Label ID="Label23" runat="server"></asp:Label>                                                                       
                                                                        <br />
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <asp:Label ID="lblInvoiceTo" runat="server" Text="<%$ Resources:Attendance,Invoice Address %>" />
                                                        <asp:TextBox onkeydown='return (event.keyCode!=13);' ID="txtInvoiceTo" runat="server" CssClass="form-control" BackColor="#eeeeee"
                                                            onchange="validateAddress(this)" />
                                                        <cc1:AutoCompleteExtender ID="AutoCompleteExtender_invoice" runat="server" DelimiterCharacters=""
                                                            Enabled="True" ServiceMethod="GetCompletionListAddressName" ServicePath="" CompletionInterval="100"
                                                            MinimumPrefixLength="1" CompletionSetCount="1" TargetControlID="txtInvoiceTo"
                                                            UseContextKey="True" CompletionListCssClass="autoCompleteList" CompletionListItemCssClass="autoCompleteListItem" CompletionListHighlightedItemCssClass="autoCompleteSelectedListItem" OnClientShown="resetPosition">
                                                        </cc1:AutoCompleteExtender>
                                                        <br />
                                                    </div>
                                                    <div class="col-md-6">
                                                        <asp:Label ID="lblShipTo" runat="server" Text="<%$ Resources:Attendance,Ship To %>" />
                                                        <asp:TextBox onkeydown='return (event.keyCode!=13);' ID="txtShipCustomerName" runat="server" CssClass="form-control" BackColor="#eeeeee"
                                                            onchange="txtCustomer_TextChanged(this)" />
                                                        <cc1:AutoCompleteExtender ID="AutoCompleteExtender_shipCustname" runat="server" DelimiterCharacters=""
                                                            Enabled="True" CompletionInterval="100" CompletionSetCount="1" MinimumPrefixLength="1"
                                                            ServiceMethod="GetCompletionListContact" ServicePath="" TargetControlID="txtShipCustomerName"
                                                            UseContextKey="True" CompletionListCssClass="autoCompleteList" CompletionListItemCssClass="autoCompleteListItem" CompletionListHighlightedItemCssClass="autoCompleteSelectedListItem" OnClientShown="resetPosition">
                                                        </cc1:AutoCompleteExtender>
                                                        <br />
                                                    </div>
                                                    <div class="col-md-6">
                                                        <asp:Label ID="lblShipingAddress" runat="server" Text="<%$ Resources:Attendance,Shipping Address %>" />
                                                        <asp:TextBox onkeydown='return (event.keyCode!=13);' ID="txtShipingAddress" runat="server" CssClass="form-control" BackColor="#eeeeee"
                                                            onchange="validateAddress(this)" />
                                                        <cc1:AutoCompleteExtender ID="AutoCompleteExtender_shipaddress" runat="server" DelimiterCharacters=""
                                                            Enabled="True" ServiceMethod="GetCompletionListAddressName" ServicePath="" CompletionInterval="100"
                                                            MinimumPrefixLength="1" CompletionSetCount="1" TargetControlID="txtShipingAddress"
                                                            UseContextKey="True" CompletionListCssClass="autoCompleteList" CompletionListItemCssClass="autoCompleteListItem" CompletionListHighlightedItemCssClass="autoCompleteSelectedListItem" OnClientShown="resetPosition">
                                                        </cc1:AutoCompleteExtender>
                                                        <br />
                                                    </div>
                                                     <div class="col-md-2">
                                                        <br />
                                                          <asp:Button ID="btnNewaddress" runat="server" Text="New Address" class="btn btn btn-primary" OnClick="btnNewaddress_Click" />                                                        
                                                        <br />
                                                    </div>

                                                    <div class="col-md-4">
                                                        <br />
                                                        <asp:RadioButton ID="RdoSo" runat="server" Text="<%$ Resources:Attendance,Sales Order %>"
                                                            onchange="GetPendingSalesOrder()" GroupName="So" />
                                                        <asp:RadioButton ID="RdoWithOutSo" runat="server" Style="margin-left: 15px;" GroupName="So" onchange="showProductSearching()"
                                                            Text="<%$ Resources:Attendance,Without Sales Order %>" />
                                                        <br />
                                                    </div>
                                                    <div style="display: none" class="col-md-6">
                                                        <asp:CheckBox ID="chkPost" runat="server" Visible="false" Text="<%$ Resources:Attendance,Post %>" />
                                                        <br />
                                                    </div>
                                                    <div class="col-md-6">
                                                        <asp:RadioButton ID="rbtnFormView" Font-Bold="true" runat="server" Text="<%$ Resources:Attendance,Form View%>"
                                                            Visible="false" AutoPostBack="true" GroupName="Product"
                                                            OnCheckedChanged="rbtnFormView_OnCheckedChanged" />&nbsp;&nbsp;&nbsp;
                                                        <asp:RadioButton ID="rbtnAdvancesearchView" Font-Bold="true" runat="server" Visible="false"
                                                            Text="<%$ Resources:Attendance,Advance Search View%>"
                                                            AutoPostBack="true" GroupName="Product" OnCheckedChanged="rbtnFormView_OnCheckedChanged" />
                                                        <br />
                                                    </div>
                                                    <div class="col-md-6">
                                                        <asp:Button ID="btnAddNewProduct" runat="server" Text="<%$ Resources:Attendance,Add Product %>"
                                                            Visible="false" CssClass="btn btn-info"
                                                            OnClick="btnAddNewProduct_Click" />
                                                        <br />
                                                    </div>

                                                    <div id="PnlProductSearching" runat="server" class="col-md-12">
                                                        <br />
                                                        <div class="row" id="divProductSearch" style="display: none">
                                                            <div class="col-md-12">
                                                                <a class="btn btn-primary" onclick="btnAddProductScreen_Click()">Add Product List</a>
                                                                <a class="btn btn-primary" onclick="btnAddtoList_Click()">Fill Your Product</a>
                                                                <br />
                                                                <br />

                                                            </div>
                                                            <div class="col-md-12">

                                                                <div class="col-lg-3">
                                                                    <asp:DropDownList ID="ddlProductSerach" runat="server" CssClass="form-control" onchange="ddlProductSerach_SelectedIndexChanged(this)">
                                                                        <asp:ListItem Text="<%$ Resources:Attendance,Product Id %>" Value="ProductCode" Selected="True"></asp:ListItem>
                                                                        <asp:ListItem Text="<%$ Resources:Attendance,Product Name %>" Value="ProductName"
                                                                            ></asp:ListItem>
                                                                    </asp:DropDownList>
                                                                </div>
                                                                <div class="col-lg-9" style="display: none;" id="divProductCode">
                                                                    <asp:TextBox onkeydown='return (event.keyCode!=13);' ID="txtProductSerachValue" runat="server" CssClass="form-control" Visible="false" />
                                                                    <asp:TextBox onkeydown='return (event.keyCode!=13);' ID="txtProductId" runat="server" CssClass="form-control" onchange="txtProductName_TextChanged(this)" BackColor="#eeeeee" />
                                                                    <cc1:AutoCompleteExtender ID="AutoCompleteExtenderProductcode" runat="server" CompletionInterval="100" DelimiterCharacters="" Enabled="True" MinimumPrefixLength="1" ServiceMethod="GetCompletionListProductCode"
                                                                        ServicePath="" TargetControlID="txtProductId" UseContextKey="True" CompletionListCssClass="autoCompleteList" CompletionListItemCssClass="autoCompleteListItem" CompletionListHighlightedItemCssClass="autoCompleteSelectedListItem" OnClientShown="resetPosition">
                                                                    </cc1:AutoCompleteExtender>
                                                                </div>
                                                                <div class="col-lg-9" id="divProductName">
                                                                    <asp:TextBox onkeydown='return (event.keyCode!=13);' ID="txtSearchProductName" runat="server" BackColor="#eeeeee" CssClass="form-control" onchange="txtProductName_TextChanged(this)" />
                                                                    <cc1:AutoCompleteExtender ID="AutoCompleteExtenderProductName" runat="server" CompletionInterval="100" DelimiterCharacters="" Enabled="True" MinimumPrefixLength="1" ServiceMethod="GetCompletionListProductName"
                                                                        ServicePath="" TargetControlID="txtSearchProductName" UseContextKey="True" CompletionListCssClass="autoCompleteList" CompletionListItemCssClass="autoCompleteListItem" CompletionListHighlightedItemCssClass="autoCompleteSelectedListItem" OnClientShown="resetPosition">
                                                                    </cc1:AutoCompleteExtender>
                                                                </div>

                                                                <div class="col-md-2"></div>
                                                            </div>
                                                        </div>

                                                        <div class="box box-solid" id="divPendingOrders" style="display: none">
                                                            <div class="box-header with-border">
                                                                <h3 class="box-title"></h3>
                                                            </div>
                                                            <div class="box-body">
                                                                <div class="row">
                                                                    <div class="col-md-12">
                                                                        <a id="btnshowAdvancePayment" style="visibility: hidden" class="btn btn-primary" onclick="showAdvancePaymentTbl()">Show Advance Payment</a>
                                                                    </div>
                                                                    <div class="col-md-12">
                                                                        <div style="overflow: auto; max-height: 500px;">
                                                                            <table id="tblOrders" class="grid">
                                                                                <thead>
                                                                                    <tr>
                                                                                        <th></th>
                                                                                        <th><%= Resources.Attendance.Order_No_ %></th>
                                                                                        <th><%= Resources.Attendance.Order_Date %></th>
                                                                                        <th><%= Resources.Attendance.Product_Id%></th>
                                                                                        <th><%= Resources.Attendance.Product_Name %></th>
                                                                                        <th><%= Resources.Attendance.Unit %></th>
                                                                                        <th><%= Resources.Attendance.Order %></th>
                                                                                        <th>salesOrderId</th>
                                                                                        <th>productId</th>
                                                                                    </tr>
                                                                                </thead>
                                                                                <tbody>
                                                                                </tbody>
                                                                            </table>
                                                                        </div>
                                                                        <asp:HiddenField ID="hdnProductId" runat="server" />
                                                                        <asp:HiddenField ID="hdnProductName" runat="server" />
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="box box-solid" id="divProducts" style="display: none">
                                                            <div class="box-header with-border">
                                                                <h3 class="box-title"></h3>
                                                            </div>
                                                            <div class="box-body">
                                                                <div class="row">
                                                                    <div class="col-md-12">
                                                                        <div style="overflow: auto; max-height: 500px;" class="grid">
                                                                            <table id="tblProduct" class="table table-striped table-border">
                                                                                <thead>
                                                                                    <tr>
                                                                                        <th></th>
                                                                                        <th>Sales Order</th>
                                                                                        <th>Sno</th>
                                                                                        <th colspan="2">Product Detail</th>
                                                                                        <th colspan="2">Unit</th>
                                                                                        <th colspan="7">Qty</th>
                                                                                        <th colspan="2" <%= hdnIsDiscountEnable.Value == "true" ? "" : "style='display:none'"%>>Discount</th>
                                                                                        <th colspan="2" <%= hdnIsTaxEnabled.Value == "true" ? "" : "style='display:none'"%>>Tax</th>
                                                                                        <th>Total</th>
                                                                                        <th>Customer Product Code</th>
                                                                                        <th>Location Out</th>
                                                                                        <th>Stock</th>
                                                                                    </tr>
                                                                                    <tr>
                                                                                        <th>Delete</th>
                                                                                        <th></th>
                                                                                        <th></th>
                                                                                        <th>Id</th>
                                                                                        <th>Name</th>
                                                                                        <th>Name</th>
                                                                                        <th>Price</th>
                                                                                        <th>Free</th>
                                                                                        <th>Order</th>
                                                                                        <th>Sold</th>
                                                                                        <th>Sys.</th>
                                                                                        <th>Remain</th>
                                                                                        <th>Sales Qty</th>
                                                                                        <th>KWD Gross Price</th>
                                                                                        <th <%= hdnIsDiscountEnable.Value == "true" ? "" : "style='display:none'"%>>(%)</th>
                                                                                        <th <%= hdnIsDiscountEnable.Value == "true" ? "" : "style='display:none'"%>>KWD Value</th>
                                                                                        <th <%= hdnIsTaxEnabled.Value == "true" ? "" : "style='display:none'"%>>(%)</th>
                                                                                        <th <%= hdnIsTaxEnabled.Value == "true" ? "" : "style='display:none'"%>>Value</th>
                                                                                        <th></th>
                                                                                        <th></th>
                                                                                        <th></th>
                                                                                        <th></th>
                                                                                    </tr>
                                                                                </thead>
                                                                                <tbody>
                                                                                </tbody>
                                                                            </table>
                                                                    
                                                                            <br />
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <hr />
                                                    </div>
                                                    <div class="col-md-6">
                                                        <asp:Label ID="lblAmount" runat="server" Text="<%$ Resources:Attendance,Gross Amount %>" />
                                                        <asp:TextBox onkeydown='return (event.keyCode!=13);' ID="txtAmount" runat="server" ReadOnly="true" CssClass="form-control" />
                                                        <br />
                                                    </div>
                                                    <div class="col-md-6">
                                                        <asp:Label ID="lblTotalQuantity" runat="server" Text="<%$ Resources:Attendance, Total Quantity %>" />
                                                        <asp:TextBox onkeydown='return (event.keyCode!=13);' ID="txtTotalQuantity" runat="server" CssClass="form-control" ReadOnly="true" />
                                                        <cc1:FilteredTextBoxExtender ID="FilteredTextBoxExtender9" runat="server" Enabled="True"
                                                            TargetControlID="txtTotalQuantity" ValidChars="1,2,3,4,5,6,7,8,9,0,.">
                                                        </cc1:FilteredTextBoxExtender>
                                                        <br />
                                                    </div>
                                                    <div class="col-md-6">
                                                        <asp:Label ID="lblDiscountP" runat="server" Text="<%$ Resources:Attendance,Discount(%) %>" />
                                                        <div class="input-group">
                                                            <asp:TextBox onkeydown='return (event.keyCode!=13);' ID="txtDiscountP" runat="server" CssClass="form-control"
                                                                onchange="txtDiscountP_TextChanged(this)" />
                                                            <cc1:FilteredTextBoxExtender ID="FilteredTextBoxExtender10" runat="server" Enabled="True"
                                                                TargetControlID="txtDiscountP" ValidChars="1,2,3,4,5,6,7,8,9,0,.">
                                                            </cc1:FilteredTextBoxExtender>
                                                            <div style="width: 50%" class="input-group-btn">
                                                                <asp:Label ID="Label3" Width="100px" runat="server" CssClass="form-control" Text="<%$ Resources:Attendance,Value %>" />
                                                                <asp:TextBox onkeydown='return (event.keyCode!=13);' ID="txtDiscountV" Width="110px" runat="server" CssClass="form-control" Enabled="false" />
                                                                <cc1:FilteredTextBoxExtender ID="FilteredTextBoxExtender11" runat="server" Enabled="True"
                                                                    TargetControlID="txtDiscountV" ValidChars="1,2,3,4,5,6,7,8,9,0,.">
                                                                </cc1:FilteredTextBoxExtender>
                                                            </div>
                                                        </div>
                                                        <br />
                                                    </div>
                                                    <div class="col-md-6">
                                                        <asp:Label ID="lblPriceafterdiscountheader" runat="server"
                                                            Text="<%$ Resources:Attendance,Price After Discount %>" Visible="false" />
                                                        <asp:TextBox onkeydown='return (event.keyCode!=13);' ID="txtPriceafterdiscountheader" runat="server" CssClass="form-control"
                                                            Visible="false" ReadOnly="True" />
                                                        <br />
                                                    </div>

                                                    <div class="col-md-6">
                                                        <asp:Label ID="lblTaxP" runat="server" Text="<%$ Resources:Attendance,Tax(%) %>" />
                                                        <asp:TextBox onkeydown='return (event.keyCode!=13);' ID="txtTaxP" runat="server" CssClass="form-control" Enabled="false" />
                                                        <cc1:FilteredTextBoxExtender ID="FilteredTextBoxExtender12" runat="server" Enabled="True"
                                                            TargetControlID="txtTaxP" ValidChars="1,2,3,4,5,6,7,8,9,0,.">
                                                        </cc1:FilteredTextBoxExtender>
                                                        <br />
                                                    </div>
                                                    <div class="col-md-6">
                                                        <asp:Label ID="Label2" runat="server" Text="<%$ Resources:Attendance,Value %>" />
                                                        <asp:TextBox onkeydown='return (event.keyCode!=13);' ID="txtTaxV" runat="server" CssClass="form-control" Enabled="false" />
                                                        <cc1:FilteredTextBoxExtender ID="FilteredTextBoxExtender13" runat="server" Enabled="True"
                                                            TargetControlID="txtTaxV" ValidChars="1,2,3,4,5,6,7,8,9,0,.">
                                                        </cc1:FilteredTextBoxExtender>
                                                        <br />
                                                    </div>

                                                    <div class="col-md-4">
                                                        <asp:Label ID="lblGrandTotal" runat="server" Text="<%$ Resources:Attendance,Net Amount %>" />
                                                        <asp:TextBox onkeydown='return (event.keyCode!=13);' ID="txtNetAmount" runat="server" CssClass="form-control" Visible="false"
                                                            ReadOnly="True" />
                                                        <asp:TextBox onkeydown='return (event.keyCode!=13);' ID="txtGrandTotal" runat="server" CssClass="form-control" ReadOnly="True" />
                                                        <br />
                                                    </div>
                                                    <div class="col-md-4">
                                                        <asp:Label ID="Label11" runat="server" Text="<%$ Resources:Attendance,Total Expenses %>" />
                                                        <asp:TextBox onkeydown='return (event.keyCode!=13);' ID="txtTotalExpensesAmount" runat="server" CssClass="form-control" ReadOnly="True" />
                                                        <br />
                                                    </div>
                                                    <div class="col-md-4">
                                                        <asp:Label ID="Label12" runat="server" Text="<%$ Resources:Attendance,Net Amount %>" />
                                                        <asp:TextBox onkeydown='return (event.keyCode!=13);' ID="txtNetAmountwithexpenses" runat="server" CssClass="form-control" ReadOnly="true"></asp:TextBox>
                                                        <br />
                                                    </div>

                                                    <div class="col-md-12">
                                                        <cc1:TabContainer ID="TabContainer1" runat="server" CssClass="ajax__tab_yuitabview-theme" ActiveTabIndex="0">
                                                            <cc1:TabPanel ID="TabProductPaymentMode" runat="server" Width="100%" HeaderText="<%$ Resources:Attendance,Payment Mode %>">
                                                                <ContentTemplate>
                                                                    <asp:UpdatePanel ID="Update_TabPayment" runat="server">
                                                                        <ContentTemplate>
                                                                            <div class="row">
                                                                                <div class="col-md-12">
                                                                                    <div class="col-md-6">
                                                                                        <asp:Label ID="Label8" runat="server" Text="<%$ Resources:Attendance,Payment Mode %>"></asp:Label>
                                                                                        <a style="color: Red">*</a>
                                                                                        <asp:RequiredFieldValidator EnableClientScript="true" Style="float: right;" runat="server" ID="RequiredFieldValidator8" ValidationGroup="Add_Container" Display="Dynamic"
                                                                                            SetFocusOnError="true" ControlToValidate="ddlTabPaymentMode" InitialValue="--Select--" ErrorMessage="<%$ Resources:Attendance,Select Payment Mode %>" />
                                                                                          <asp:DropDownList ID="ddlTabPaymentMode" runat="server" CssClass="form-control"
                                                                                             onchange="ddlPaymentMode_Selected()">
                                                                                        </asp:DropDownList>
                                                                                        <asp:HiddenField ID="hdnPaymentType" runat="server"/>
                                                                                        <br/>
                                                                                    </div>
                                                                                    <div class="col-md-6">
                                                                                        <asp:HiddenField runat="server" ID="hdnVoucherID" />
                                                                                        <asp:Label ID="lblCreditNote" runat="server" Text="<%$ Resources:Attendance,Customer Credit Note %>"></asp:Label>
                                                                                        <asp:TextBox onkeydown='return (event.keyCode!=13);' ID="txtCreditNote" runat="server" CssClass="form-control" Enabled="false" onchange="txtCreditNote_TextChanged()"></asp:TextBox>
                                                                                        <cc1:AutoCompleteExtender ID="autoCompleteCreditNote" runat="server" DelimiterCharacters=""
                                                                                            Enabled="True" ServiceMethod="GetCompletionListCreditNote" ServicePath="" CompletionInterval="100"
                                                                                            MinimumPrefixLength="1" CompletionSetCount="1" TargetControlID="txtCreditNote"
                                                                                            UseContextKey="True" CompletionListCssClass="autoCompleteList" CompletionListItemCssClass="autoCompleteListItem" CompletionListHighlightedItemCssClass="autoCompleteSelectedListItem" OnClientShown="resetPosition">
                                                                                        </cc1:AutoCompleteExtender>
                                                                                        <br />

                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-md-12">
                                                                                    <div class="col-md-6">
                                                                                        <asp:Label ID="lblPayAmmount" runat="server" Text="<%$ Resources:Attendance,Balance Amount%>"></asp:Label>
                                                                                        <asp:TextBox onkeydown='return (event.keyCode!=13);' ID="txtPayAmount" runat="server" CssClass="form-control" onchange="txtPayAmount_OnTextChanged()"></asp:TextBox>
                                                                                        <cc1:FilteredTextBoxExtender ID="FilteredTextBoxExtender1" runat="server" Enabled="True"
                                                                                            TargetControlID="txtPayAmount" ValidChars="1,2,3,4,5,6,7,8,9,0,.">
                                                                                        </cc1:FilteredTextBoxExtender>
                                                                                        <br />
                                                                                    </div>                                                                      
                                                                                </div>
                                                                                  <div class="col-md-12">
                                                                                    <div class="col-md-6">
                                                                                        <asp:Label ID="lblPayAccountNo" runat="server" Text="<%$ Resources:Attendance,Account No. %>"></asp:Label>
                                                                                        <a style="color: Red">*</a>
                                                                                        <asp:RequiredFieldValidator EnableClientScript="true" Style="float: right;" runat="server" ID="RequiredFieldValidator9" ValidationGroup="Add_Container"
                                                                                            Display="Dynamic" SetFocusOnError="true" ControlToValidate="txtPayAccountNo" ErrorMessage="<%$ Resources:Attendance,Enter Account No %>"></asp:RequiredFieldValidator>

                                                                                        <asp:TextBox onkeydown='return (event.keyCode!=13);' ID="txtPayAccountNo" runat="server" CssClass="form-control" onchange="txtPayAccountNo_TextChanged()" BackColor="#eeeeee" />
                                                                                        <cc1:AutoCompleteExtender ID="AutoCompleteExtender3" runat="server" DelimiterCharacters=""
                                                                                            Enabled="True" ServiceMethod="GetCompletionListAccountNo" ServicePath="" CompletionInterval="100"
                                                                                            MinimumPrefixLength="1" CompletionSetCount="1" TargetControlID="txtPayAccountNo"
                                                                                            UseContextKey="True" CompletionListCssClass="autoCompleteList" CompletionListItemCssClass="autoCompleteListItem" CompletionListHighlightedItemCssClass="autoCompleteSelectedListItem" OnClientShown="resetPosition">
                                                                                        </cc1:AutoCompleteExtender>
                                                                                        <br />
                                                                                    </div>
                                                                                   </div>
                                                                                <div class="col-md-12" id="divChequeDetails" style="display: none;">

                                                                                    <div class="col-md-4">
                                                                                        <asp:Label ID="lblPayBank" runat="server" Text="<%$ Resources:Attendance,Bank %>"></asp:Label>
                                                                                        <asp:DropDownList ID="ddlPayBank" runat="server" CssClass="form-control">
                                                                                        </asp:DropDownList>
                                                                                        <br />
                                                                                    </div>

                                                                                    <div class="col-md-4">
                                                                                        <asp:Label ID="lblPayChequeNo" runat="server" Text="<%$ Resources:Attendance,Cheque No %>"></asp:Label>
                                                                                        <asp:TextBox onkeydown='return (event.keyCode!=13);' ID="txtPayChequeNo" runat="server" CssClass="form-control"></asp:TextBox>
                                                                                        <br />
                                                                                    </div>
                                                                                    <div class="col-md-4">
                                                                                        <asp:Label ID="lblPayChequeDate" runat="server" Text="<%$ Resources:Attendance,Cheque Date %>"></asp:Label>
                                                                                        <asp:TextBox onkeydown='return (event.keyCode!=13);' ID="txtPayChequeDate" runat="server" CssClass="form-control"></asp:TextBox>
                                                                                        <cc1:CalendarExtender OnClientShown="showCalendar" ID="txtChequedate_CalenderExtender" runat="server" TargetControlID="txtPayChequeDate">
                                                                                        </cc1:CalendarExtender>
                                                                                        <br />
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-md-12" id="divCardDetails" style="display: none;">

                                                                                    <div class="col-md-6">
                                                                                        <asp:Label ID="lblPayCardNo" runat="server" Text="<%$ Resources:Attendance,Card No %>"></asp:Label>
                                                                                        <asp:TextBox onkeydown='return (event.keyCode!=13);' ID="txtPayCardNo" runat="server" CssClass="form-control"></asp:TextBox>
                                                                                        <br />
                                                                                    </div>
                                                                                    <div class="col-md-6">
                                                                                        <asp:Label ID="lblPayCardName" runat="server" Text="<%$ Resources:Attendance,Card Name %>"></asp:Label>
                                                                                        <asp:TextBox onkeydown='return (event.keyCode!=13);' ID="txtPayCardName" runat="server" CssClass="form-control"></asp:TextBox>
                                                                                        <br />
                                                                                    </div>

                                                                                </div>
                                                                                <div class="col-md-12">
                                                                                    <div class="col-md-6">
                                                                                        <asp:Label ID="Label9" runat="server" Text="<%$ Resources:Attendance,Exchange Rate %>"></asp:Label>
                                                                                        <asp:TextBox onkeydown='return (event.keyCode!=13);' ID="txtPaymentExchangerate" runat="server" CssClass="form-control" Text="1" Enabled="false"></asp:TextBox>
                                                                                        <br />
                                                                                    </div>
                                                                                    <div class="col-md-6">
                                                                                        <asp:Label ID="Label7" runat="server" Text="Local Amount"></asp:Label>
                                                                                        <div class="input-group">
                                                                                            <asp:TextBox onkeydown='return (event.keyCode!=13);' ID="txtLocalAmount" runat="server" CssClass="form-control" Enabled="false"></asp:TextBox>
                                                                                            <div class="input-group-btn">


                                                                                                  <asp:LinkButton runat="server" ID="btnPaymentSave" Style="width: 37px;" ValidationGroup="Add_Container" ><a onclick="btnAddPayment()"><i class="fa fa-plus-square" style="font-size:35px;padding:5px;margin-top: -5px;"></i></asp:LinkButton>


                                                                                                <%--<asp:ImageButton runat="server" Style="width: 37px;" ValidationGroup="Add_Container" Visible="false" ImageUrl="~/Images/add.png"
                                                                                                    ToolTip="<%$ Resources:Attendance,Add %>" ID="btnPaymentSave"></asp:ImageButton>
                                                                                                <a onclick="btnAddPayment()">
                                                                                                    <img src="../Images/add.png" width="37px"></img></a>--%>
                                                                                            </div>
                                                                                        </div>
                                                                                        <br />
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-md-12">
                                                                                    <div style="overflow: auto">
                                                                                        <table id="tblPayment" class="table table-striped table-border">
                                                                                            <thead>
                                                                                                <tr>
                                                                                                    <td></td>
                                                                                                    <th>Payment Mode</th>
                                                                                                    <th>Account Name</th>
                                                                                                    <th>Net Price</th>
                                                                                                    <th>Exchange Rate</th>
                                                                                                    <th>Payment Amount (Local)</th>
                                                                                                </tr>
                                                                                            </thead>
                                                                                            <tbody>
                                                                                            </tbody>

                                                                                        </table>
                                                                                    </div>
                                                                                    <br />
                                                                                </div>
                                                                            </div>
                                                                        </ContentTemplate>
                                                                    </asp:UpdatePanel>
                                                                    <asp:UpdateProgress ID="UpdateProgress4" runat="server" AssociatedUpdatePanelID="Update_TabPayment">
                                                                        <ProgressTemplate>
                                                                            <div class="modal_Progress">
                                                                                <div class="center_Progress">
                                                                                    <img alt="" src="../Images/ajax-loader2.gif" style="vertical-align: middle; background-color: White; border-radius: 10px;" />
                                                                                </div>
                                                                            </div>
                                                                        </ProgressTemplate>
                                                                    </asp:UpdateProgress>
                                                                </ContentTemplate>
                                                            </cc1:TabPanel>
                                                            <cc1:TabPanel ID="TabProductSupplier" runat="server" Width="100%" HeaderText="<%$ Resources:Attendance,Expenses %>">
                                                                <ContentTemplate>
                                                                    <asp:UpdatePanel ID="Update_ProductSupplier" runat="server">
                                                                        <ContentTemplate>
                                                                            <div class="row">

                                                                                <div class="col-md-6">
                                                                                    <asp:Label ID="Label14" runat="server" Text="<%$ Resources:Attendance,Currency %>"></asp:Label>
                                                                                    <a style="color: Red">*</a>
                                                                                    <asp:RequiredFieldValidator EnableClientScript="true" Style="float: right;" runat="server" ID="RequiredFieldValidator11" ValidationGroup="Add_Supplier" Display="Dynamic"
                                                                                        SetFocusOnError="true" ControlToValidate="ddlExpCurrency" InitialValue="--Select--" ErrorMessage="<%$ Resources:Attendance,Select Currency %>" />

                                                                                    <asp:DropDownList ID="ddlExpCurrency" runat="server" Enabled="false" CssClass="form-control">
                                                                                    </asp:DropDownList>
                                                                                    <br />
                                                                                </div>

                                                                                <div class="col-md-6">
                                                                                    <asp:Label ID="Label15" runat="server" Text="<%$ Resources:Attendance,Exchange Rate %>"></asp:Label>
                                                                                    <asp:TextBox onkeydown='return (event.keyCode!=13);' ID="txtExpExchangeRate" Enabled="false" ReadOnly="true" runat="server" CssClass="form-control" onchange="txtFCExpAmount_OnTextChanged" Text="0"></asp:TextBox>
                                                                                    <cc1:FilteredTextBoxExtender ID="FilteredTextBoxExtender41" runat="server" Enabled="True"
                                                                                        TargetControlID="txtExpExchangeRate" ValidChars="1,2,3,4,5,6,7,8,9,0,.">
                                                                                    </cc1:FilteredTextBoxExtender>
                                                                                    <br />
                                                                                </div>

                                                                                <div class="col-md-6">
                                                                                    <asp:Label ID="lblSelectExp" runat="server" Text="<%$ Resources:Attendance,Select Expenses %>" />
                                                                                    <a style="color: Red">*</a>
                                                                                    <asp:RequiredFieldValidator EnableClientScript="true" Style="float: right;" runat="server" ID="RequiredFieldValidator10" ValidationGroup="Add_Supplier" Display="Dynamic"
                                                                                        SetFocusOnError="true" ControlToValidate="ddlExpense" InitialValue="--Select--" ErrorMessage="<%$ Resources:Attendance,Select Expenses %>" />

                                                                                    <asp:DropDownList ID="ddlExpense" runat="server" onchange="ddlExpense_SelectedIndexChanged()" CssClass="form-control">
                                                                                    </asp:DropDownList>
                                                                                    <br />
                                                                                </div>
                                                                                <div class="col-md-6">
                                                                                    <asp:Label ID="lblExpAccount" runat="server" Text="<%$ Resources:Attendance,Expenses Account %>"></asp:Label>
                                                                                    <a style="color: Red">*</a>
                                                                                    <asp:RequiredFieldValidator EnableClientScript="true" Style="float: right;" runat="server" ID="RequiredFieldValidator12" ValidationGroup="Add_Supplier"
                                                                                        Display="Dynamic" SetFocusOnError="true" ControlToValidate="txtExpensesAccount" ErrorMessage="<%$ Resources:Attendance,Enter Expenses Account %>"></asp:RequiredFieldValidator>

                                                                                    <asp:TextBox onkeydown='return (event.keyCode!=13);' ID="txtExpensesAccount" runat="server" CssClass="form-control" onchange="txtExpensesAccount_TextChanged(this)" BackColor="#eeeeee" />
                                                                                    <cc1:AutoCompleteExtender ID="AutoCompleteExtender2" runat="server" DelimiterCharacters=""
                                                                                        Enabled="True" ServiceMethod="GetCompletionListAccountNo" ServicePath="" CompletionInterval="100"
                                                                                        MinimumPrefixLength="1" CompletionSetCount="1" TargetControlID="txtExpensesAccount"
                                                                                        UseContextKey="True" CompletionListCssClass="autoCompleteList" CompletionListItemCssClass="autoCompleteListItem" CompletionListHighlightedItemCssClass="autoCompleteSelectedListItem" OnClientShown="resetPosition">
                                                                                    </cc1:AutoCompleteExtender>
                                                                                    <br />
                                                                                </div>

                                                                                <div class="col-md-6">
                                                                                    <asp:Label ID="lblFCExpAmount" runat="server" Text="<%$ Resources:Attendance,FCExp Amount %>"></asp:Label>
                                                                                    <asp:TextBox onkeydown='return (event.keyCode!=13);' ID="txtFCExpAmount" runat="server" CssClass="form-control" onchange="txtFCExpAmount_OnTextChanged()" Text="0"></asp:TextBox>
                                                                                    <cc1:FilteredTextBoxExtender ID="FilteredTextBoxExtender40" runat="server" Enabled="True"
                                                                                        TargetControlID="txtFCExpAmount" ValidChars="1,2,3,4,5,6,7,8,9,0,.">
                                                                                    </cc1:FilteredTextBoxExtender>
                                                                                    <br />
                                                                                </div>

                                                                                <div class="col-md-6">
                                                                                    <asp:Label ID="lblExpCharges" runat="server" Text="<%$ Resources:Attendance,Expenses Charges %>" />
                                                                                    <a style="color: Red">*</a>
                                                                                    <asp:RequiredFieldValidator EnableClientScript="true" Style="float: right;" runat="server" ID="RequiredFieldValidator13" ValidationGroup="Add_Supplier"
                                                                                        Display="Dynamic" SetFocusOnError="true" ControlToValidate="txtExpCharges" ErrorMessage="<%$ Resources:Attendance,Enter Expenses Charges %>"></asp:RequiredFieldValidator>

                                                                                    <asp:TextBox onkeydown='return (event.keyCode!=13);' ID="txtExpCharges" runat="server" ReadOnly="true" Enabled="false" CssClass="form-control" Text="0"></asp:TextBox>
                                                                                    <cc1:FilteredTextBoxExtender ID="FilteredTextBoxExtender42" runat="server" Enabled="True"
                                                                                        TargetControlID="txtExpCharges" ValidChars="1,2,3,4,5,6,7,8,9,0,.">
                                                                                    </cc1:FilteredTextBoxExtender>

                                                                                    <asp:HiddenField ID="hdnProductExpenses" runat="server" Value="0" />
                                                                                    <br />
                                                                                </div>
                                                                                <div id="Div_Add_Tax" runat="server" class="col-md-6">
                                                                                    <asp:Label ID="Label55" runat="server" Text="<%$ Resources:Attendance,Expenses Tax Amount%>"></asp:Label>
                                                                                    <div class="input-group" style="width: 100%;">
                                                                                        <asp:Label ID="Lbl_Expenses_Tax_Amount_ET" CssClass="form-control" runat="server"></asp:Label>
                                                                                        <div class="input-group-addon" style="width: 25%">
                                                                                            <asp:Label ID="Lbl_Expenses_Tax_ET" runat="server"></asp:Label>
                                                                                        </div>
                                                                                        <div class="input-group-btn">
                                                                                            <asp:Button ID="Btn_Add_Expenses_Tax" runat="server" ValidationGroup="Add_Supplier" Text="Add Tax" OnClick="Btn_Add_Expenses_Tax_Click" CssClass="btn btn-info" />
                                                                                        </div>
                                                                                    </div>
                                                                                    <br />
                                                                                </div>

                                                                                <div class="col-md-6" style="text-align: center">
                                                                                    <br />
                                                                                    <a onclick="AddExpenses()" class="btn btn-info">Add</a>
                                                                                    <asp:Button ID="Btn_Exp_Reset" Visible="false" runat="server" Text="Reset" OnClick="Btn_Exp_Reset_Click" CssClass="btn btn-warning" />
                                                                                </div>

                                                                                <div class="col-md-12">
                                                                                    <br />
                                                                                    <div style="overflow: auto">
                                                                                        <table id="tblExpenses" class="table table-striped table-border">
                                                                                            <thead>
                                                                                                <tr>
                                                                                                    <th>Delete</th>
                                                                                                    <th>Expenses</th>
                                                                                                    <th>Currency</th>
                                                                                                    <th>FC Exchange Amount</th>
                                                                                                    <th>Exchange Rate</th>
                                                                                                    <th>Expenses Charges</th>
                                                                                                    <th>Line Total</th>
                                                                                                </tr>
                                                                                            </thead>
                                                                                            <tbody>
                                                                                            </tbody>
                                                                                        </table>

                                                                                        <asp:HiddenField ID="hdnfPSC" runat="server" />
                                                                                    </div>
                                                                                    <br />
                                                                                </div>
                                                                            </div>
                                                                        </ContentTemplate>
                                                                    </asp:UpdatePanel>
                                                                    <asp:UpdateProgress ID="UpdateProgress5" runat="server" AssociatedUpdatePanelID="Update_ProductSupplier">
                                                                        <ProgressTemplate>
                                                                            <div class="modal_Progress">
                                                                                <div class="center_Progress">
                                                                                    <img alt="" src="../Images/ajax-loader2.gif" style="vertical-align: middle; background-color: White; border-radius: 10px;" />
                                                                                </div>
                                                                            </div>
                                                                        </ProgressTemplate>
                                                                    </asp:UpdateProgress>
                                                                </ContentTemplate>
                                                            </cc1:TabPanel>
                                                            <cc1:TabPanel ID="TabPanel1" runat="server" Width="100%" HeaderText="<%$ Resources:Attendance,Remark %>">
                                                                <ContentTemplate>
                                                                    <asp:UpdatePanel ID="Update_Remark" runat="server">
                                                                        <ContentTemplate>
                                                                            <div class="row">
                                                                                <div class="col-md-12">
                                                                                    <asp:TextBox ID="txtRemark" runat="server" CssClass="form-control" TextMode="MultiLine" Height="160px"></asp:TextBox>
                                                                                    <br />
                                                                                </div>
                                                                            </div>
                                                                        </ContentTemplate>
                                                                    </asp:UpdatePanel>
                                                                    <asp:UpdateProgress ID="UpdateProgress8" runat="server" AssociatedUpdatePanelID="Update_Remark">
                                                                        <ProgressTemplate>
                                                                            <div class="modal_Progress">
                                                                                <div class="center_Progress">
                                                                                    <img alt="" src="../Images/ajax-loader2.gif" style="vertical-align: middle; background-color: White; border-radius: 10px;" />
                                                                                </div>
                                                                            </div>
                                                                        </ProgressTemplate>
                                                                    </asp:UpdateProgress>
                                                                </ContentTemplate>
                                                            </cc1:TabPanel>
                                                            <cc1:TabPanel ID="TabPanel2" runat="server" Width="100%" HeaderText="<%$ Resources:Attendance,Terms & Conditions %>">
                                                                <ContentTemplate>
                                                                    <asp:UpdatePanel ID="Update_Terms_Conditions" runat="server">
                                                                        <ContentTemplate>
                                                                            <div class="row">
                                                                                <div class="col-md-12">
                                                                                    <cc1:Editor ID="txtCondition1" runat="server" TextMode="MultiLine" Height="160px" />
                                                                                    <br />
                                                                                </div>
                                                                            </div>
                                                                        </ContentTemplate>
                                                                    </asp:UpdatePanel>
                                                                    <asp:UpdateProgress ID="UpdateProgress9" runat="server" AssociatedUpdatePanelID="Update_Terms_Conditions">
                                                                        <ProgressTemplate>
                                                                            <div class="modal_Progress">
                                                                                <div class="center_Progress">
                                                                                    <img alt="" src="../Images/ajax-loader2.gif" style="vertical-align: middle; background-color: White; border-radius: 10px;" />
                                                                                </div>
                                                                            </div>
                                                                        </ProgressTemplate>
                                                                    </asp:UpdateProgress>
                                                                </ContentTemplate>
                                                            </cc1:TabPanel>
                                                        </cc1:TabContainer>
                                                    </div>


                                                    <div class="col-md-12" style="text-align: center">
                                                        <br />
                                                        <a id="btnSaveUsingAjax" class="btn btn-success"onclick="saveInvoice()"></i>Save</a>
                                                        <a class="btn btn-primary" style="cursor: pointer" onclick="reset()">Reset</a>
                                                        <a class="btn btn-danger" style="cursor: pointer" onclick="btnSInvCancel_Click()">Cancel</a>

                                                        <asp:HiddenField ID="editid" runat="server" />
                                                        <br />
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </ContentTemplate>
                        </asp:UpdatePanel>
                    </div>
                    <div class="tab-pane" id="Pending_Order">
                        <asp:UpdatePanel ID="Update_Pending_Order" runat="server">
                            <ContentTemplate>

                                <div class="box box-solid">
                                    <div class="box-header with-border">
                                        <h3 class="box-title"></h3>
                                    </div>
                                    <div class="box-body">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="flow">
                                                    <table id="tblPendingOrder" class="table table-striped table-border">
                                                        <thead>
                                                            <tr>
                                                                <td>Order No</td>
                                                                <td>Order Date</td>
                                                                <td>Transfer Type</td>
                                                                <td>Transfer No</td>
                                                                <td>Customer Name</td>
                                                                <td>Product Code</td>
                                                                <td>Unit Name</td>
                                                                <td>Sys Qty</td>
                                                                <td>Order Qty</td>
                                                                <td>Remain Qty</td>
                                                                <td>Created By</td>
                                                                <td>Amount</td>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                        </tbody>
                                                    </table>

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </ContentTemplate>
                        </asp:UpdatePanel>
                    </div>
                     <div class="tab-pane" id="Cancel">
                        <asp:UpdatePanel ID="Update_List_Cancel" runat="server">
                            <ContentTemplate>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div id="Div5" runat="server" class="box box-info collapsed-box">
                                            <div class="box-header with-border">
                                                <h3 class="box-title">
                                                    <asp:Label ID="Label24" runat="server" Text="Advance Search"></asp:Label></h3>
                                                &nbsp;&nbsp;|&nbsp;&nbsp;
					<asp:Label ID="lblTotalRecordsCancel" Font-Bold="true" runat="server" Text="<%$ Resources:Attendance,Total Records: 0 %>"></asp:Label>
                                                <div class="box-tools pull-right">
                                                    <button type="button" class="btn btn-box-tool" data-widget="collapse">
                                                        <i id="I4" runat="server" class="fa fa-plus"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="box-body">
                                                <asp:HiddenField ID="hdnTransTypeCancel" runat="server" />
                                                <asp:HiddenField ID="hdnTransTypeValueCancel" runat="server" />

                                                <div class="col-lg-12">
                                                    <asp:DropDownList ID="ddlLocationCancel" runat="server" Class="form-control" OnSelectedIndexChanged="ddlLocationCancel_SelectedIndexChanged"
                                                        AutoPostBack="true">
                                                    </asp:DropDownList>
                                                    <br />
                                                </div>


                                                <div class="col-lg-2">
                                                    <asp:DropDownList ID="ddlFieldNameCancel" runat="server" CssClass="form-control" OnSelectedIndexChanged="SetCustomerTextBoxCancel" AutoPostBack="true">
                                                        <asp:ListItem Text="<%$ Resources:Attendance, Invoice Id %>" Value="Trans_Id"></asp:ListItem>
                                                        <asp:ListItem Text="<%$ Resources:Attendance, Invoice No %>" Value="Invoice_No" Selected="True"></asp:ListItem>
                                                        <asp:ListItem Text="<%$ Resources:Attendance, Invoice Date %>" Value="Invoice_Date"></asp:ListItem>
                                                        <asp:ListItem Text="Ref. Type" Value="Transtype"></asp:ListItem>
                                                        <asp:ListItem Text="Ref. No." Value="OrderList"></asp:ListItem>
                                                        <asp:ListItem Text="<%$ Resources:Attendance,Sales Person %>" Value="Emp_Name"></asp:ListItem>
                                                        <asp:ListItem Text="<%$ Resources:Attendance, Customer Name %>" Value="Name"></asp:ListItem>
                                                        <asp:ListItem Text="Customer Order No" Value="ref_order_number"></asp:ListItem>
                                                        <asp:ListItem Text="<%$ Resources:Attendance,Serial No %>" Value="SerialNo"></asp:ListItem>
                                                        <asp:ListItem Text="<%$ Resources:Attendance,Created By %>" Value="InvoiceCreatedBy"></asp:ListItem>
                                                        <asp:ListItem Text="Net Amount" Value="GrandTotal"></asp:ListItem>
                                                    </asp:DropDownList>
                                                </div>
                                                <div class="col-lg-2">
                                                    <asp:DropDownList ID="ddlOptionCancel" runat="server" CssClass="form-control">
                                                        <asp:ListItem Text="<%$ Resources:Attendance,--Select-- %>"></asp:ListItem>
                                                        <asp:ListItem Text="<%$ Resources:Attendance,Equal %>"></asp:ListItem>
                                                        <asp:ListItem Selected="True" Text="<%$ Resources:Attendance,Contains %>"></asp:ListItem>
                                                        <asp:ListItem Text="<%$ Resources:Attendance,Like %>"></asp:ListItem>
                                                    </asp:DropDownList>
                                                </div>
                                                <div class="col-lg-5">
                                                    <asp:Panel ID="Panel1" runat="server" DefaultButton="btnbind">
                                                        <asp:TextBox ID="txtValue" placeholder="Search from Content" runat="server" CssClass="form-control"></asp:TextBox>
                                                    </asp:Panel>
                                                </div>
                                                <div class="col-lg-2">
                                                    <asp:LinkButton ID="btnbind" runat="server" CausesValidation="False" OnClick="btnbindrptCancel_Click" ToolTip="<%$ Resources:Attendance,Search %>"><span class="fa fa-search"  style="font-size:25px;"></span></asp:LinkButton>&nbsp;&nbsp;&nbsp;

                                                    <asp:LinkButton ID="btnRefresh" runat="server" CausesValidation="False" OnClick="btnRefreshReportCancel_Click" ToolTip="<%$ Resources:Attendance,Refresh %>"><span class="fa fa-repeat"  style="font-size:25px;"></span></asp:LinkButton>&nbsp;&nbsp;&nbsp;
                                                </div>                                                
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="box box-warning box-solid" <%= GvSalesInvoiceCancel.Rows.Count>0?"style='display:block'":"style='display:none'"%>>
                                    <div class="box-body">
                                        <div class="row">
                                            <div class="col-md-12">
                                                Page Size :
                                                <asp:DropDownList ID="ddlPageSizeCancel" runat="server" OnSelectedIndexChanged="ddlPageSizeCancel_OnSelectedIndexChanged" AutoPostBack="true"></asp:DropDownList>
                                                <br />
                                                <br />
                                                <div class="flow">
                                                  													
<asp:GridView CssClass="table-striped table-bordered table table-hover" AutoPostBack="True" ID="GvSalesInvoiceCancel" AllowPaging="true" OnPageIndexChanging="GvSalesInvoiceCancel_PageIndexChanging"  PageSize="10"  runat="server" AutoGenerateColumns="False" Width="100%">
                      <Columns>
 <asp:TemplateField HeaderText="<%$ Resources:Attendance,Invoice No. %>" SortExpression="Invoice_No">
                                                                <ItemTemplate>
                                                                    <asp:Label ID="lblgvSInvNo" runat="server" Text='<%#Eval("Invoice_No") %>' />
                                                                </ItemTemplate>
                                                                <ItemStyle HorizontalAlign="Center" Width="90px" />
                                                            </asp:TemplateField>
                                                            <asp:TemplateField HeaderText="<%$ Resources:Attendance,Invoice Date %>" SortExpression="Invoice_Date">
                                                                <ItemTemplate>
                                                                    <asp:Label ID="lblgvSInvDate" runat="server" Text='<%#GetDateTime(Eval("Invoice_Date").ToString())%>' />
                                                                </ItemTemplate>
                                                                <ItemStyle HorizontalAlign="Center" Width="80px" />
                                                            </asp:TemplateField>
                                                           
                                                            <asp:TemplateField HeaderText="Ref. No." SortExpression="OrderList">
                                                                <ItemTemplate>
                                                                    <asp:Label ID="lblgvOrderList" runat="server" Text='<%#Eval("OrderList") %>' />
                                                                </ItemTemplate>
                                                                <ItemStyle HorizontalAlign="Center" Width="90px" />
                                                            </asp:TemplateField>


                                                             <asp:TemplateField HeaderText="Ref.Type" SortExpression="OrderList">
                                                                <ItemTemplate>
                                                                    <asp:Label ID="Ref_Type" runat="server" Text='<%#Eval("Ref_Type") %>' />
                                                                </ItemTemplate>
                                                                <ItemStyle HorizontalAlign="Center" Width="90px" />
                                                            </asp:TemplateField>
                                                        
                                                            <asp:TemplateField HeaderText="<%$ Resources:Attendance,Customer Name%>" SortExpression="CustomerName">
                                                                <ItemTemplate>
                                                                    <table width="100%">
                                                                        <tr>
                                                                            <td width="80%">
                                                                                <asp:Label ID="lblgvCustomerName" runat="server" Text='<%#Eval("CustomerName") %>' />
                                                                            </td>
                                                                            <td align="right" width="20%">
                                                                                <asp:LinkButton ID="lnkcustomerdetail" runat="server" Text="More.." ForeColor="Blue"
                                                                                    CommandArgument='<%# Eval("Customer_Id") %>' OnCommand="lblgvCustomerName_Command"
                                                                                    ToolTip="Customer History" />
                                                                            </td>
                                                                        </tr>
                                                                    </table>
                                                                </ItemTemplate>
                                                                <FooterStyle HorizontalAlign="Right" />
                                                                <ItemStyle HorizontalAlign="Left" />
                                                            </asp:TemplateField>                                                     

                                                           
                                                            <asp:TemplateField HeaderText="<%$ Resources:Attendance,Created By%>" SortExpression="InvoiceCreatedBy">
                                                                <ItemTemplate>
                                                                    <asp:Label ID="lblgvCreatedBy" runat="server" Text='<%#Eval("InvoiceCreatedBy")%>'></asp:Label>
                                                                </ItemTemplate>
                                                                <FooterStyle HorizontalAlign="Center" />
                                                                <ItemStyle HorizontalAlign="Left" />
                                                            </asp:TemplateField>
                                                            <asp:TemplateField HeaderText="<%$ Resources:Attendance,Amount%>" SortExpression="GrandTotal">
                                                                <ItemTemplate>
                                                                    <asp:Label ID="lblgvGrandTotal1" runat="server" Text='<%# GetCurrencySymbol(Eval("GrandTotal").ToString(),Eval("Currency_Id").ToString()) %>' />
                                                                </ItemTemplate>
                                                                <FooterStyle HorizontalAlign="Center" />
                                                                <ItemStyle HorizontalAlign="Right" />
                                                            </asp:TemplateField>  
                                                        </Columns>
                         <PagerStyle CssClass="pagination-ys" />
</asp:GridView>
                                                </div>
                                                <br />
                                                <div class="col-md-12" style="margin-left: -30px">
                                                    <div class="col-md-9">
                                                        <asp:DataList CellPadding="10" RepeatDirection="Horizontal" runat="server" ID="dlPagerCancel" OnItemCommand="dlPagerCancel_ItemCommand">
                                                            <ItemTemplate>

                                                                <ul class="pagination">
                                                                    <li class='<%# Convert.ToBoolean(Eval("Enabled")) ? "page-item" : "page-item active" %>'>

                                                                        <asp:LinkButton Enabled='<%#Eval("Enabled") %>' runat="server" ID="lnkPageNoCancel" Text='<%#Eval("Text") %>' CommandArgument='<%#Eval("Value") %>' CommandName="PageNo" CssClass="page-link"></asp:LinkButton>
                                                                    </li>
                                                                </ul>


                                                            </ItemTemplate>
                                                        </asp:DataList>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <asp:Label ID="lblTotalAmount_ListCancel" Font-Bold="true" runat="server" Text="<%$ Resources:Attendance,Total %>"></asp:Label>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                    <!-- /.box-body -->
                                </div>
                            </ContentTemplate>
                        </asp:UpdatePanel>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="Return_Modal" tabindex="-1" role="dialog" aria-labelledby="Return_ModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <h4 class="modal-title" id="Return_ModalLabel">Serial No</h4>
                </div>
                <div class="modal-body">
                    <asp:UpdatePanel ID="Update_Modal" runat="server">
                        <ContentTemplate>
                            <asp:HiddenField ID="hdnSalesOrderId" runat="server" Value="0" />
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="box box-primary">
                                        <div class="box-body">
                                            <div class="form-group">
                                                <div class="col-md-12">
                                                    <asp:Label ID="lblproductId" runat="server" Text="Product Id"></asp:Label>
                                                    &nbsp:&nbsp<asp:Label ID="lblProductIdvalue" runat="server" Text="0"></asp:Label>
                                                    <br />
                                                </div>
                                                <div class="col-md-12">
                                                    <asp:Label ID="lblserialProductname" runat="server" Text="Product Name"></asp:Label>
                                                    &nbsp:&nbsp<asp:Label ID="lblProductNameValue" runat="server"
                                                        Text="0"></asp:Label>
                                                    <br />
                                                </div>
                                                <div id="pnlSerialNumber" runat="server" class="col-md-12">
                                                    <div class="col-md-6">
                                                        <asp:Label ID="Label30" runat="server" Text="<%$ Resources:Attendance, File Upload%>"></asp:Label>
                                                        <div class="input-group" style="width: 100%;">
                                                            <cc1:AsyncFileUpload ID="FULogoPath"
                                                                OnClientUploadStarted="FUAll_UploadStarted"
                                                                OnClientUploadError="FUAll_UploadError"
                                                                OnClientUploadComplete="FUAll_UploadComplete"
                                                                OnUploadedComplete="FUAll_FileUploadComplete"
                                                                runat="server" CssClass="form-control"
                                                                CompleteBackColor="White"
                                                                UploaderStyle="Traditional"
                                                                UploadingBackColor="#CCFFFF"
                                                                ThrobberID="FUAll_ImgLoader" Width="100%" />
                                                            <div class="input-group-btn" style="border: solid 1px #d2d6de; width: 35px;">
                                                                <asp:Image ID="FUAll_Img_Right" runat="server" Width="30px" Height="30px" ImageUrl="../Images/Allow.png" Style="display: none" />
                                                                <asp:Image ID="FUAll_Img_Wrong" runat="server" Width="30px" Height="30px" ImageUrl="../Images/Delete1.png" Style="display: none" />
                                                                <asp:Image ID="FUAll_ImgLoader" runat="server" ImageUrl="../Images/loader.gif" />
                                                            </div>
                                                        </div>
                                                        <br />
                                                    </div>
                                                    <div class="col-md-6" style="text-align: center">
                                                        <asp:Button ID="Btnloadfile" runat="server" Text="Load" Enabled="false" CssClass="btn btn-primary"
                                                            OnClick="Btnloadfile_Click" />

                                                        <a class="btn btn-primary" onclick="btnexecute_Click()">Execute </a>
                                                        <br />
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="alert alert-info " style="display: none;">
                                                            <div class="row">
                                                                <div class="form-group">
                                                                    <div class="col-lg-3">
                                                                        <asp:TextBox onkeydown='return (event.keyCode!=13);' ID="txtserachserialnumber" runat="server" CssClass="form-control"></asp:TextBox>
                                                                        <cc1:TextBoxWatermarkExtender ID="txtwatermarkup" runat="server" TargetControlID="txtserachserialnumber"
                                                                            WatermarkText="Search Serial Number">
                                                                        </cc1:TextBoxWatermarkExtender>
                                                                    </div>
                                                                    <div class="col-lg-2">
                                                                        <asp:ImageButton ID="btnsearchserial" runat="server" CausesValidation="False"
                                                                            ImageUrl="~/Images/search.png" OnClick="btnsearchserial_Click" Style="margin-top: -5px;" ToolTip="<%$ Resources:Attendance,Search %>"></asp:ImageButton>

                                                                        <asp:ImageButton ID="btnRefreshserial" runat="server" CausesValidation="False"
                                                                            ImageUrl="~/Images/refresh.png" OnClick="btnRefreshserial_Click" Style="width: 33px;"
                                                                            ToolTip="<%$ Resources:Attendance,Refresh %>"></asp:ImageButton>
                                                                    </div>
                                                                    <div class="col-lg-2">
                                                                        <h5>
                                                                            <asp:Label ID="Label31" runat="server" Text="Total :"></asp:Label>
                                                                            <asp:Label ID="txtselectedSerialNumber" runat="server" Text="0"></asp:Label></h5>
                                                                    </div>
                                                                    <div class="col-lg-2">
                                                                        <h5>
                                                                            <asp:Label ID="lblCount" runat="server"></asp:Label>
                                                                            <asp:Label ID="txtCount" runat="server" Text="0"></asp:Label></h5>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="box box-solid">
                                                            <div class="box-header with-border">
                                                                <h3 class="box-title"></h3>
                                                            </div>
                                                            <div class="box-body">
                                                                <div class="row">
                                                                    <div class="col-md-8">
                                                                        <div class="flow">
                                                                            <asp:HiddenField ID="hdnHeaderRowForSno" Value="" runat="server" />
                                                                            <asp:HiddenField ID="hdnProductIdForSno" Value="" runat="server" />
                                                                            <table id="tblSerialNo" class="table table-striped table-border">
                                                                                <thead>
                                                                                    <tr>
                                                                                        <th style="display: none">sNo</th>
                                                                                        <th>delete</th>
                                                                                        <th>Serial No</th>
                                                                                        <th>Manufacturing Date</th>
                                                                                        <th>Batch No</th>
                                                                                    </tr>
                                                                                </thead>
                                                                                <tbody>
                                                                                </tbody>
                                                                            </table>

                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-4">
                                                                        <asp:TextBox onkeydown='return (event.keyCode!=13);' ID="txtSerialNo" Height="350px" runat="server" CssClass="form-control"
                                                                            TextMode="MultiLine"></asp:TextBox>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </ContentTemplate>
                    </asp:UpdatePanel>
                </div>
                <div class="modal-footer">
                    <asp:UpdatePanel ID="Update_Modal_Button" runat="server">
                        <ContentTemplate>

                            <input type="button" id="btnAddSerialNo" class="btn btn-primary" value="Add" onclick="productSerialAdd()" />

                            <button type="button" class="btn btn-danger" data-dismiss="modal">
                                Close</button>
                            <asp:Button ID="btnDefault" runat="server" Style="visibility: hidden" />
                        </ContentTemplate>
                    </asp:UpdatePanel>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="Modal_GST" tabindex="-1" role="dialog" aria-labelledby="Modal_GSTLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <h4 class="modal-title" id="Modal_GSTLabel">TAX Calculation
                    </h4>
                </div>
                <div class="modal-body">
                    <asp:UpdatePanel ID="Update_Modal_GST" runat="server">
                        <ContentTemplate>
                            <div class="row">
                                <div class="col-md-12">
                                    <table id="tblTax" class="table table-striped" style="width: 100%">
                                        <thead>
                                            <tr>
                                                <td style="display: none">HeaderId</td>
                                                <td style="display: none">Tax Id</td>
                                                <td>Tax Name</td>
                                                <td>Tax(%)</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>

                                </div>
                            </div>
                        </ContentTemplate>
                    </asp:UpdatePanel>

                </div>
                <div class="modal-footer">
                    <asp:UpdatePanel ID="Update_Modal_Button_GST" runat="server">
                        <ContentTemplate>
                            <%--<asp:Button ID="btnSaveGST" Visible="false" runat="server" CssClass="btn btn-primary" ValidationGroup="S_update"
                                Text="<%$ Resources:Attendance,Save %>" OnClick="btnSaveGST_Click" />

                            <asp:Button ID="btnCancelGST" runat="server" CausesValidation="False" CssClass="btn btn-primary"
                                Text="<%$ Resources:Attendance,Reset %>" Visible="false" />--%>
                            <asp:HiddenField ID="Hdn_Serial_No_Tax" runat="server" />
                            <asp:HiddenField ID="Hdn_Product_Id_Tax" runat="server" />
                            <asp:HiddenField ID="Hdn_unit_Price_Tax" runat="server" />
                            <asp:HiddenField ID="Hdn_Discount_Tax" runat="server" />
                            <asp:Button ID="Btn_Update_Tax" runat="server" CssClass="btn btn-primary"
                                Text="<%$ Resources:Attendance,Update %>" OnClick="Btn_Update_Tax_Click" />
                            <button id="btnClosePopup" type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                        </ContentTemplate>
                    </asp:UpdatePanel>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="NewAddress" tabindex="-1" role="dialog" aria-labelledby="NewAddress_ModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-body">
                    <AA1:AddAddress ID="addaddress" runat="server" />
                </div>
                <div class="modal-footer">
                    <button type="button" id="" class="btn btn-danger" data-dismiss="modal">
                        Close</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="Modal_Expenses_Tax" tabindex="-1" role="dialog" aria-labelledby="Modal_Expenses_TaxLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <h4 class="modal-title" id="Modal_Expenses_TaxLabel">TAX Calculation
                    </h4>
                </div>
                <div class="modal-body">
                    <asp:UpdatePanel ID="UpdatePanel1" runat="server">
                        <ContentTemplate>
                            <div class="row">
                                <div class="col-md-12">
                                    <asp:GridView CssClass="table-striped table-bordered table table-hover" ID="gvTaxExpenses_tax" runat="server" Width="100%" AutoGenerateColumns="false" >
                                        <Columns>
                                            <asp:TemplateField HeaderText="Tax Name">
                                                <ItemTemplate>
                                                    <asp:Label ID="lblTaxName" runat="server" Text='<%# Eval("Tax_Type_Name") %>' />
                                                </ItemTemplate>
                                            </asp:TemplateField>
                                            <asp:TemplateField HeaderText="Tax Value (%)">
                                                <ItemTemplate>
                                                    <asp:TextBox onkeydown='return (event.keyCode!=13);' ID="txtTaxValueInPer" CssClass="form-control" Style="text-align: center;" runat="server" Text='<%# Eval("Tax_Percentage") %>' AutoPostBack="true" />
                                                </ItemTemplate>
                                            </asp:TemplateField>
                                        </Columns>
                                        
                                        
                                        
                                    </asp:GridView>
                                </div>
                            </div>
                        </ContentTemplate>
                    </asp:UpdatePanel>

                </div>
                <div class="modal-footer">
                    <asp:UpdatePanel ID="UpdatePanel2" runat="server">
                        <ContentTemplate>
                            <button id="btnClosePopup_Expenses_Tax" type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                        </ContentTemplate>
                    </asp:UpdatePanel>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="Expenses_Tax_Web_Control" tabindex="-1" role="dialog" aria-labelledby="Expenses_Tax_Web_Control_Label" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <h4 class="modal-title" id="Expenses_Tax_Web_Control_Label">Expenses TAX
                    </h4>
                </div>
                <div class="modal-body">
                    <asp:UpdatePanel ID="UpdatePanel_Expenses" runat="server">
                        <ContentTemplate>
                            <div class="row">
                                <div class="col-md-12">
                                    <ET:Expenses_Tax ID="Expenses_Tax_Modal" runat="server" />
                                    <asp:HiddenField ID="Hdn_Expenses_Id_Web_Control" runat="server" />
                                    <asp:HiddenField ID="Hdn_Expenses_Name_Web_Control" runat="server" />
                                    <asp:HiddenField ID="Hdn_Expenses_Amount_Web_Control" runat="server" />
                                    <%--<asp:HiddenField ID="Hdn_Session_Name_For_Expenses_Tax" runat="server" />
								<asp:HiddenField ID="Hdn_Save_Session_Name_For_Expenses_Tax" runat="server" />--%>
                                    <asp:HiddenField ID="Hdn_Page_Name_Web_Control" runat="server" />
                                    <asp:HiddenField ID="Hdn_Tax_Entry_Type" runat="server" />
                                    <asp:HiddenField ID="Hdn_Saved_Expenses_Tax_Session" runat="server" />
                                    <asp:HiddenField ID="Hdn_Local_Expenses_Tax_Session" runat="server" />
                                </div>
                            </div>
                        </ContentTemplate>
                    </asp:UpdatePanel>
                </div>
            </div>
        </div>
    </div>

    <asp:UpdateProgress ID="UpdateProgress14" runat="server" AssociatedUpdatePanelID="UpdatePanel_Expenses">
        <ProgressTemplate>
            <div class="modal_Progress">
                <div class="center_Progress">
                    <img alt="" src="../Images/ajax-loader2.gif" style="vertical-align: middle; background-color: White; border-radius: 10px;" />
                </div>
            </div>
        </ProgressTemplate>
    </asp:UpdateProgress>

    <asp:UpdateProgress ID="UpdateProgress6" runat="server" AssociatedUpdatePanelID="Update_Modal">
        <ProgressTemplate>
            <div class="modal_Progress">
                <div class="center_Progress">
                    <img alt="" src="../Images/ajax-loader2.gif" style="vertical-align: middle; background-color: White; border-radius: 10px;" />
                </div>
            </div>
        </ProgressTemplate>
    </asp:UpdateProgress>

    <asp:UpdateProgress ID="UpdateProgress7" runat="server" AssociatedUpdatePanelID="Update_Modal_Button">
        <ProgressTemplate>
            <div class="modal_Progress">
                <div class="center_Progress">
                    <img alt="" src="../Images/ajax-loader2.gif" style="vertical-align: middle; background-color: White; border-radius: 10px;" />
                </div>
            </div>
        </ProgressTemplate>
    </asp:UpdateProgress>

    <asp:UpdateProgress ID="UpdateProgress1" runat="server" AssociatedUpdatePanelID="Update_List">
        <ProgressTemplate>
            <div class="modal_Progress">
                <div class="center_Progress">
                    <img alt="" src="../Images/ajax-loader2.gif" style="vertical-align: middle; background-color: White; border-radius: 10px;" />
                </div>
            </div>
        </ProgressTemplate>
    </asp:UpdateProgress>

    <asp:UpdateProgress ID="UpdateProgress2" runat="server" AssociatedUpdatePanelID="Update_New">
        <ProgressTemplate>
            <div class="modal_Progress">
                <div class="center_Progress">
                    <img alt="" src="../Images/ajax-loader2.gif" style="vertical-align: middle; background-color: White; border-radius: 10px;" />
                </div>
            </div>
        </ProgressTemplate>
    </asp:UpdateProgress>

    <asp:UpdateProgress ID="UpdateProgress3" runat="server" AssociatedUpdatePanelID="Update_Pending_Order">
        <ProgressTemplate>
            <div class="modal_Progress">
                <div class="center_Progress">
                    <img alt="" src="../Images/ajax-loader2.gif" style="vertical-align: middle; background-color: White; border-radius: 10px;" />
                </div>
            </div>
        </ProgressTemplate>
    </asp:UpdateProgress>

     <div class="modal fade" id="modelContactDetail" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">

                <div class="modal-body">
                    <AT1:ViewContact ID="UcContactList" runat="server" />
                </div>

                <div class="modal-footer">
                    <button type="button" id="" class="btn btn-danger" data-dismiss="modal">
                        Close</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="ModelAcMaster" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-body">
                    <uc1:AccountMaster runat="server" ID="UcAcMaster" />
                </div>
                <div class="modal-footer">
                    <button type="button" id="" class="btn btn-danger" data-dismiss="modal">
                        Close</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="creditTermsNConditions" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="box-title">
                        <asp:Label ID="Label22" Font-Names="Times New roman" Font-Size="18px" Font-Bold="true" runat="server" Text="Credit Terms & Condition"></asp:Label>
                    </h3>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <div class="col-md-4">
                            <asp:Label ID="lblCreditLimit" runat="server" Font-Bold="true" Text="<%$ Resources:Attendance,Credit Limit %>" />
                            &nbsp:&nbsp<asp:Label ID="lblCreditLimitValue" runat="server"></asp:Label>
                            <asp:Label ID="lblCurrencyCreditLimit" runat="server"></asp:Label>
                            <br />
                        </div>
                        <div class="col-md-4">
                            <asp:Label ID="lblCreditDays" runat="server" Font-Bold="true" Text="<%$ Resources:Attendance,Credit Days %>" />
                            &nbsp:&nbsp<asp:Label ID="lblCreditDaysValue" runat="server"></asp:Label>
                            <br />
                        </div>
                        <div class="col-md-4">
                            <asp:Label ID="Label47" runat="server" Font-Bold="true" Text="Credit Parameter" />
                            &nbsp:&nbsp<asp:Label ID="lblCreditParameterValue" runat="server"></asp:Label>
                            <br />
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" id="" class="btn btn-danger" data-dismiss="modal">
                        Close</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="advancePayment" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="box-title">
                        <asp:Label ID="Label4" Font-Names="Times New roman" Font-Size="18px" Font-Bold="true" runat="server" Text="Advance Payment"></asp:Label>
                    </h3>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <div class="col-md-12">
                            <div style="overflow: auto">
                                <table id="tblAdvancePayment" class="table table-striped table-bordered" style="width: 100%">
                                    <thead>
                                        <tr>
                                            <td>Order No.</td>
                                            <td>Payment Mode</td>
                                            <td>Account Name</td>
                                            <td>Paid Amount</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>
                            <br />
                        </div>

                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" id="" class="btn btn-danger" data-dismiss="modal">
                        Close</button>
                </div>
            </div>
        </div>
    </div>

    <asp:Panel ID="PnlNewEdit" runat="server" Visible="false"></asp:Panel>
    <asp:Panel ID="pnlMenuNew" runat="server" Visible="false"></asp:Panel>
    <asp:Panel ID="pnlMenuList" runat="server" Visible="false"></asp:Panel>
    <asp:Panel ID="pnlMenuOrder" runat="server" Visible="false"></asp:Panel>
    <asp:Panel ID="PnlList" runat="server" Visible="false"></asp:Panel>
    <asp:Panel ID="PnlBin" runat="server" Visible="false"></asp:Panel>
    <asp:Panel ID="pnlPendingOrder" runat="server" Visible="false"></asp:Panel>
    <asp:Panel ID="pnlJobCard" runat="server" Visible="false"></asp:Panel>
    <asp:Panel ID="pnlMenuBin" runat="server" Visible="false"></asp:Panel>
    <asp:Panel ID="pnlMenuJobCard" runat="server" Visible="false"></asp:Panel>
    <asp:Panel ID="pnlProduct1" runat="server" Visible="false"></asp:Panel>
    <asp:Panel ID="pnlProduct2" runat="server" Visible="false"></asp:Panel>
    <asp:Panel ID="SerialPanel" runat="server" Visible="false"></asp:Panel>
</asp:Content>
<asp:Content ID="Content4" ContentPlaceHolderID="FooterContent" runat="Server">
    <div id="prgBar" class="modal_Progress" style="display: none">
        <div class="center_Progress">
            <img alt="" src="../Images/ajax-loader2.gif" style="vertical-align: middle; background-color: White; border-radius: 10px;" />
        </div>
    </div>
</asp:Content>
<asp:Content ID="Content5" ContentPlaceHolderID="AfterLoadScriptContent" runat="Server"><script src="../Script/common.js"></script>
    <script type="text/javascript">
       
        function findPositionWithScrolling(oElement) {
            if (typeof (oElement.offsetParent) != 'undefined') {
                var originalElement = oElement;
                for (var posX = 0, posY = 0; oElement; oElement = oElement.offsetParent) {
                    posX += oElement.offsetLeft;
                    posY += oElement.offsetTop;
                    if (oElement != originalElement && oElement != document.body && oElement != document.documentElement) {
                        posX -= oElement.scrollLeft;
                        posY -= oElement.scrollTop;
                    }
                }
                return [posX, posY];
            } else {
                return [oElement.x, oElement.y];
            }
        }
        function showCalendar(sender, args) {

            var ctlName = sender._textbox._element.name;

            ctlName = ctlName.replace('$', '_');
            ctlName = ctlName.replace('$', '_');

            var processingControl = $get(ctlName);
            //var targetCtlHeight = processingControl.clientHeight;
            sender._popupDiv.parentElement.style.top = processingControl.offsetTop + processingControl.clientHeight + 'px';
            sender._popupDiv.parentElement.style.left = processingControl.offsetLeft + 'px';

            var positionTop = processingControl.clientHeight + processingControl.offsetTop;
            var positionLeft = processingControl.offsetLeft;
            var processingParent;
            var continueLoop = false;

            do {
                // If the control has parents continue loop.
                if (processingControl.offsetParent != null) {
                    processingParent = processingControl.offsetParent;
                    positionTop += processingParent.offsetTop;
                    positionLeft += processingParent.offsetLeft;
                    processingControl = processingParent;
                    continueLoop = true;
                }
                else {
                    continueLoop = false;
                }
            } while (continueLoop);

            sender._popupDiv.parentElement.style.top = positionTop + 2 + 'px';
            sender._popupDiv.parentElement.style.left = positionLeft + 'px';
            sender._popupBehavior._element.style.zIndex = 10005;
        }

        function LI_Edit_Active() {
            $("#Li_List").removeClass("active");
            $("#List").removeClass("active");

            $("#Li_New").addClass("active");
            $("#New").addClass("active");
        }

        function LI_List_Active() {
            $("#Li_List").addClass("active");
            $("#List").addClass("active");

            $("#Li_New").removeClass("active");
            $("#New").removeClass("active");
        }

        function Li_Tab_Pending_Order() {
            fillTblPendingOrder();
        }
        function Close_Modal_Popup() {
            document.getElementById('<%= Btn_View_Modal.ClientID %>').click();
        }
        function Show_Modal_Popup() {
            document.getElementById('<%= Btn_View_Modal.ClientID %>').click();
        }

        function Show_Modal_GST() {
            document.getElementById('<%= Btn_GST_Modal.ClientID %>').click();
        }

        function Hide_List() {
            var List_LI = document.getElementById("Li_List");
            List_LI.style.display = List_LI.style.display = 'none';
        }
        function Show_List() {
            var List_LI = document.getElementById("Li_List");
            List_LI.style.display = List_LI.style.display = '';
        }

        function Hide_Bin() {
            var Bin_LI = document.getElementById("Li_Bin");
            Bin_LI.style.display = Bin_LI.style.display = 'none';
        }
        function Show_Bin() {
            var Bin_LI = document.getElementById("Li_Bin");
            Bin_LI.style.display = Bin_LI.style.display = '';
        }

    </script>
    <script type="text/javascript">
        function Confirm() {
            var confirm_value = document.createElement("INPUT");
            confirm_value.type = "hidden";
            confirm_value.name = "confirm_value";
            if (confirm("Do you want to print Invoice ?")) {
                confirm_value.value = "Yes";
            } else {
                confirm_value.value = "No";
            }
            document.forms[0].appendChild(confirm_value);
        }

        function DeliveryConfirm() {
            var confirm_value1 = document.createElement("INPUT");
            confirm_value1.type = "hidden";
            confirm_value1.name = "confirm_value1";
            if (confirm("Do you want to print delivery ?")) {
                confirm_value1.value = "Yes";
            } else {
                confirm_value1.value = "No";
            }
            document.forms[0].appendChild(confirm_value1);
        }

        function count(clientId) {
            var txtInput = document.getElementById(clientId);
            if (event.keyCode == 13) {
                document.getElementById('<%= txtCount.ClientID %>').innerHTML = lineBreakCount(txtInput.value);
            }
            if (event.keyCode == 8 || event.keyCode == 46) {
                document.getElementById('<%= txtCount.ClientID %>').innerHTML = lineDelBreakCount(txtInput.value); // The button id over here
            }
        }

        function lineBreakCount(str) {
            try {
                return ((str.match(/[^\n]*\n[^\n]*/gi).length) + 1);
            } catch (e) {
                return 1;
            }
        }

        function lineDelBreakCount(str) {
            try {
                return ((str.match(/[^\n]*\n[^\n]*/gi).length) - 1);
            }
            catch (e) {
                return 0;
            }
        }
        function Hide_Model_GST() {
            $('#btnClosePopup').click();
        }
    </script>
    <script>
$(document).ready(function(){
    $('#txtCustomer').change(function(){
        GetCreditInfo();
  });
});
</script>
   <%-- <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.10.0.min.js" type="text/javascript"></script>
    <script src="https://ajax.aspnetcdn.com/ajax/jquery.ui/1.9.2/jquery-ui.min.js" type="text/javascript"></script>
    <link href="https://ajax.aspnetcdn.com/ajax/jquery.ui/1.9.2/themes/blitzer/jquery-ui.css"rel="Stylesheet" type="text/css" />--%>
  
     <script type="text/javascript">
         function LoctionList(){
             debugger;
             var location=[];
             $.ajax({
                 url: 'SalesInvoice1.aspx/GetLocationList',
                 method: 'post',
                 async:false,
                 contentType: "application/json; charset=utf-8",                
                 success: function (data) {
                     console.log(data.d[0]);
                     console.log(data.d.length);
                     console.log(data);
                   

                     location=data;

                      

                 }
             }); 
             console.log(location);
             return location;
                    
         }

         function CancelData(transId){    
             var cancel;
              $('#<%= editid.ClientID %>').val(transId); 
             debugger;
             $.ajax({
                 url: 'SalesInvoice1.aspx/IbtnCancel_Command',
                 method: 'post',
                 data:'{transId:'+transId+'}',
                 async:false,
                 contentType: "application/json; charset=utf-8",                
                 success: function (data) {  cancel=data;              
                                     

                 },
                 processData: false
             });

             if(cancel.d=="2")
             {
                
                 View_Modal_Popup();
                 return false;
             }
             if(cancel.d=="0")
             {
                 alert("Sales Invoice has posted,can not be Cancel");
                 return false;                       
             }
             if(cancel.d=="1")
             {
                 alert("Sales Invoice has Approved, cannot be Cancel");
                 return false;                             
             }


             return false;
             debugger;
         }

                
     </script>

    <script type="text/javascript">
        function FUAll_UploadComplete(sender, args) {
            document.getElementById('<%= FUAll_Img_Wrong.ClientID %>').style.display = "none";
            document.getElementById('<%= FUAll_Img_Right.ClientID %>').style.display = "";
        }
        function FUAll_UploadError(sender, args) {
            document.getElementById('<%= FUAll_Img_Right.ClientID %>').style.display = "none";
            document.getElementById('<%= FUAll_Img_Wrong.ClientID %>').style.display = "";
        }
        function FUAll_UploadStarted(sender, args) {

        }
        function Show_Modal_Expenses_Tax() {
            document.getElementById('<%= Btn_Modal_Expenses_Tax.ClientID %>').click();
        }
        function Show_Expenses_Tax_Web_Control() {
            document.getElementById('<%= Btn_Show_Expenses_Tax.ClientID %>').click();GetLocationList
        }

        Sys.WebForms.PageRequestManager.getInstance().add_beginRequest(BeginRequestHandler);
        function BeginRequestHandler(sender, args) { var oControl = args.get_postBackElement(); oControl.disabled = true; }

        function Modal_AcMaster_Open() {
            var _result = confirm("Account not exist in " + $('#<%= ddlCurrency.ClientID %> option:selected').text() + ". Do you want to create it");
            if (_result == true) {
                $('#ModelAcMaster').modal('show');
            }
        }
        //Initialize tooltip with jQuery
        $(document).ready(function () {
            $('[data-toggle="tooltip"]').tooltip({
                'selector': '',
                'placement': 'top',
                'container': 'body'
            });
            

            var data = document.getElementById('<%= txtCondition1.ClientID %>');
            
            //storing default currency and sales person name in hdn fields
            var hdnDefaultCurrency_ = document.getElementById('<%=hdnDefaultCurrencyIndex.ClientID %>');
            var ddlCurrency_ = document.getElementById('<%=ddlCurrency.ClientID %>');
            hdnDefaultCurrency_.value=ddlCurrency_.selectedIndex;
            var hdnDefaultSalesPersonName_ = document.getElementById('<%=hdnDefaultSalesPersonName.ClientID %>');            
            hdnDefaultSalesPersonName_.value = document.getElementById('<%= txtSalesPerson.ClientID%>').value; 
            // end

            
            var urlParams = new URLSearchParams(window.location.search);
            if(urlParams.has('Id'))
            {
                urlRequest();
            }
        },setDecimalAndSymbol(),setCurrencySymbol(),setDllActionOptions(),getDocumentNo());

        function validateEmployee(ctl) {
            try {
                if (ctl.value == "") {
                    return;
                }
                var empCode = ctl.value.substring(ctl.value.lastIndexOf("/") + 1, ctl.value.length);
                var empName = ctl.value.substring(0, ctl.value.lastIndexOf("/"));
                if (!$.isNumeric(empCode)) {
                    throw "Emp Name is not valid";
                }
                PageMethods.ValidateEmployeeName(empCode, empName, function (data) {
                    if (data == false) {
                        alert("Sales person is not valid");
                        ctl.value = "";
                        ctl.focus();
                    }
                }, errorMessages);
            }
            catch (ex) {
                alert(ex);
            }
        }
        function txtCustomer_TextChanged(ctl) {

            debugger;
            try {
                if (ctl.value == "") {
                    resetCustomerIdForContact();
                    return;
                }
                var id = ctl.value.split('/')[1];
                var name = ctl.value.split('/')[0];
                if (!$.isNumeric(id)) {
                    throw "Customer is not valid";
                }

                $('#<%= RdoSo.ClientID %>')[0].checked = false;
                $('#<%= RdoWithOutSo.ClientID %>')[0].checked = false;

 PageMethods.txtCustomer_TextChanged(name, id, function (data) {
                    if (data == "false") {
                       alert("Customer is not valid");
                        ctl.value = "";
                        ctl.focus();
                    }
                    else
                    {
                        if (ctl.id == "txtCustomer") {
                            $('#<%= txtShipingAddress.ClientID %>').val(data);
                            $('#<%= txtInvoiceTo.ClientID %>').val(data);
                            $('#<%= txtShipCustomerName.ClientID %>').val(ctl.value);
                        }
                        else
                        {
                            $('#<%= txtShipingAddress.ClientID %>').val(data);
                        }

                    }
 },);
                PageMethods.GetContactInfo(name, id, function (data) {
                    console.log(data.split("/")[1]);

                    $('#<%= txtContactPerson.ClientID %>').val(data);
                    $('#<%= hdnContactId.ClientID %>').val(data.split("/")[1]);
                },);


            }
            catch (ex) {
                alert(ex);
            }
        }
        function errorMessages(ex) {
            alert(ex);
            $("#prgBar").css("display","none");
        }
        function btnAddCustomer_OnClick() {
            window.open('../EMS/ContactMaster.aspx', 'window', 'width=1024');
        }
        function lnkcustomerHistory_OnClick() {
            var id = setCustomerId();
            if (id == "") {
                alert("Please enter customer name");
                return;
            }
            window.open('../Purchase/CustomerHistory.aspx?ContactId=' + id + '&&Page=SINV', 'window', 'width=1024, ');
        }

        function setCustomerId() {
            var ctl = $('#txtCustomer').val();
            if (ctl == "") {
                return "";
            }
            return ctl.split('/')[1];
        }
 function GetCreditInfo() {
            try {
                var id = setCustomerId();
                if (id == "") {
                    throw "Please enter customer name";
                }
                var currency = $('#<%= ddlCurrency.ClientID %>').val();
                if (currency == "") {
                    throw "Please select currency";
                }

                PageMethods.GetCreditInfo(id, currency, function (data) {
                    if (data == null) {
                       //alert("Not found any credit information");
                    }
                    else {
                        $('#<%= Label17.ClientID %>').text(data.split(',')[0]);
                        $('#<%= Label19.ClientID %>').text(data.split(',')[1]);
                        $('#<%= Label23.ClientID %>').text(data.split(',')[2]);
                        var div = document.getElementById('trCreditInfo');
                                                                     
                        // show
                      $('#<%= trCreditInfo.ClientID %>').css("display", "block")
                       
                    }
                }, errorMessages);
            }
            catch (ex) {
                alert(ex);
            }

        }
        function validateAddress(ctl) {
            try {
                if (ctl.value == "") {
                    return;
                }
                var AddressID  = ctl.value.substring(ctl.value.lastIndexOf("/") + 1, ctl.value.length);
                var AddressName= ctl.value.substring(0, ctl.value.lastIndexOf("/"));

                PageMethods.validateAddress(AddressName,AddressID, function (data) {
                    if (data == false) {
                        alert("Address is not valid");
                        ctl.value = "";
                        ctl.focus();
                    }
                }, errorMessages);
            }
            catch (ex) {
                alert(ex);
            }
        }

        function GetPendingSalesOrder() {
            try {             
                var id = setCustomerId();
                if (id == "") {
                    var rdo = $('#<%= RdoSo.ClientID %>')[0].checked = false;
                    throw "Please select customer name";
                }
                
                document.getElementById('divPendingOrders').style.display = "block";                
                document.getElementById('divProductSearch').style.display = "none";
                $("#prgBar").css("display","block");
                $.ajax({
                    url: 'SalesInvoice1.aspx/getSalesOrders',
                    method: 'post',
                    contentType: "application/json; charset=utf-8",
                    data: "{'strCustomerId':'" + id + "'}",
                    success: function (data) {
                        
                        var salesOrder = $.parseJSON(data.d);
                        console.log(salesOrder);

                        $('#tblOrders').dataTable({
                            destroy:true,
                            info: false,
                            paging: false,
                            sort: false,
                            searching: true,
                            data: salesOrder,
                            columns: [
                            {
                                data: "salesOrderId", render: function (data, display, row, end) {  
                                    var so='so';
                                    var dad="<input type='checkbox' id='chkAddToInvoice' onclick='fillTblProduct(" + JSON.stringify(row) + "," + end.row + ",this,)' /> <input type='hidden' id='tblHdnisDeliveryVoucher' value='"+row.isDeliveryVoucher+"'>";
                                    return dad;
                                }, className: "text-left"
                            },
                            { data: "salesOrderNo", title: "Order No", className: "text-left" },
                            { data: "salesOrderDate", title: "Date", className: "text-left" },
                            { data: "productCode", title: "Prduct Code", className: "text-left" },
                            { data: "productName", title: "Product Name", className: "text-left" },
                            { data: "unitName", title: "Unit", className: "text-left" },
                            { data: "orderQty", title: "Order Qty", className: "text-right" },
                            { data: "salesOrderId", title: "salesOrderId", className: "text-right" },
                            { data: "productId", title: "salesOrderId", className: "text-right" }                            
                            ],
                            draw: true

                        });
                        $("#prgBar").css("display","none");
                    }
                });
            }
            catch (ex) {
                alert(ex);
            }
        }

        //set colNo as per tax system and discount system
        var colTaxPer = 16;
        var colTaxValue = 17;
        var colNetAmount = 18;
       
        //convert product table to datatable
        $(document).ready(function () {

            
            $('#tblTax').DataTable({
                info: false,
                paging: false,
                sort: false,
                searching: false
            });
            $('#tblTax tbody').empty(); //clear blank row
            $('#tblSerialNo').DataTable({
                info: false,
                paging: false,
                sort: false,
                searching: true
            });
            $('#tblSerialNo tbody').empty(); //clear blank row
            fillTblInvoice(); 
            console.log("hii city");
            $('#txtSearchProductName').focus();
        });
        function focusFunction()
        {          
           $('#<%=txtSearchProductName.ClientID %>').focus();
            
        }
        function fillTblProduct(row, index, tblRow,type) {
            debugger;
            document.getElementById('divProducts').style.display = "block";
            var decimalCount = document.getElementById('<%= hdnDecimalCount.ClientID%>').value;
            var tax = $('#<%= hdnIsTaxEnabled.ClientID %>').val()
            var discount = $('#<%= hdnIsDiscountEnable.ClientID %>').val()
            var LocationOut= LoctionList();

            var sNo = (parseInt($('#tblProduct tbody tr').length) + 1);
            var htmlRow = "<tr>";
            if(type=='so' ||type==undefined)
            {
                htmlRow = htmlRow + "<td>" + "<a value='" + row.salesOrderId + "' style='cursor:pointer' onclick='removeRowFromProductTbl(this)'> <img src='../images/erase.png' > </a>" + "</td>";
                htmlRow = htmlRow + "<td>" + row.salesOrderNo + " <input type='hidden' id='tblHdnSalesOrderId' value='" + row.salesOrderId + "'> <input type='hidden' id='tblHdnDeliveryVoucher' value=" + row.isDeliveryVoucher + "></td>";
                htmlRow = htmlRow + "<td>" + sNo + "</td>"; //serial number
                htmlRow = htmlRow + "<td>" + row.productCode + " <input type='hidden' id='tblHdnProductId' value='" + row.productId + "'></td>";
                htmlRow = htmlRow + "<td style='font-size:10px'>" + row.productName + " <input type='hidden' id='tblHdnProductDescription' value='" + row.productDescription + "'></td>";
               // htmlRow = htmlRow + "<td>" + row.unitName + " <input type='hidden' id='tblHdnUnitId' value='" + row.unitId + "'> </td>";
                htmlRow = htmlRow + "<td><select name='tblHdnUnitId' id='tblHdnUnitId'><option value = '" + row.unitId + "'>"+ row.unitName +"</option></select></td>";
                htmlRow = htmlRow + "<td><input style='width:70px;' onkeydown='return (event.keyCode!=13);' type='number' id='tblTxtUnitPrice' value='" + GetAmountWithDecimal(row.unitPrice, <%=Session["LoginLocDecimalCount"].ToString() %>) + "' onchange='reCalulateLineTotal(" + sNo + ");'> </td>";
                htmlRow = htmlRow + "<td><input style='width:30px;' onkeydown='return (event.keyCode!=13);' type='number' id='tblTxtFreeQty' value='" + row.freeQty + "'> </td>";
                htmlRow = htmlRow + "<td>" + row.orderQty + "</td>";
                htmlRow = htmlRow + "<td>" + row.soldQty + "</td>";
                htmlRow = htmlRow + "<td>" + row.sysQty + "</td>";
                htmlRow = htmlRow + "<td>" + row.remainQty + "</td>";
                if (row.inventoryType == "SNO") {
                    htmlRow = htmlRow + "<td><input style='width:40px;' onkeydown='return (event.keyCode!=13);' type='number' id='tblTxtSalesQty' value='" + row.salesQty + "' onchange='reCalulateLineTotal(" + sNo + ")'><a onclick='showProductSerialNo(this," + sNo + ")' style='cursor:pointer'>Add</a> </td>";
                }
                else {
                    htmlRow = htmlRow + "<td><input style='width:40px;' onkeydown='return (event.keyCode!=13);' type='number' id='tblTxtSalesQty' value='" + row.salesQty + "' onchange='reCalulateLineTotal(" + sNo + ")'></td>";
                }
                htmlRow = htmlRow + "<td>" + row.unitPrice * row.salesQty + "</td>"; //gross price unitprice*salesQty
                if(discount=="true")
                {
                    htmlRow = htmlRow + "<td><input style='width:40px;' onkeydown='return (event.keyCode!=13);' type='number' id='tblTxtDiscountPer' value='" + row.discountPer + "' onchange='reCalulateLineTotal(" + sNo + ")'></td>";
                    htmlRow = htmlRow + "<td>" + row.discountValue + "</td>";
                }else
                {
                    htmlRow = htmlRow + "<td style='display:none'><input style='width:40px;' onkeydown='return (event.keyCode!=13);' type='number' id='tblTxtDiscountPer' value='" + row.discountPer + "' onchange='reCalulateLineTotal(" + sNo + ")'></td>";
                    htmlRow = htmlRow + "<td style='display:none'>" + row.discountValue + "></td>";
                }
                if(tax=="true")
                {
                    htmlRow = htmlRow + "<td><label id='tblLblTaxPer'>" + row.taxPer + " </label><a title='Add Tax' style='cursor:pointer' onclick='showTax(" + sNo + ")' ><i class='fa fa-plus' /></a></td>";
                    htmlRow = htmlRow + "<td>" + row.taxValue + "</td>";
                }else
                {
                    htmlRow = htmlRow + "<td style='display:none'><label id='tblLblTaxPer'>" + row.taxPer + " </label><a title='Add Tax' style='cursor:pointer' onclick='showTax(" + sNo + ")' ><i class='fa fa-plus' /></a></td>";
                    htmlRow = htmlRow + "<td style='display:none'>" + row.taxValue + "</td>";
                }
               // htmlRow = htmlRow + "<td>" + "00.00" + "</td>"; //total = gross-discount+tax
                htmlRow = htmlRow + "<td><input name = 'Total' type = 'text' id = 'Total' style = 'width: 50px;' value='0.00000'></td>"; //total = gross-discount+tax
                htmlRow = htmlRow + "<td><input name='txtCustomerCoopCode' type='text' id='txtCustomerCoopCode' style='width: 50px; '></br>   <input type='submit' name='btnUpdateCustomerCode' value='Update Customer Code' id='btnUpdateCustomerCode'/></td>";
                htmlRow=htmlRow +"<td> <select name='Location_Out' id='Location_Out'>";
                htmlRow=htmlRow + '<option value="">----Select----</option>';
                for (i = 0; i < LocationOut.d.length; i++)
                {                            
                    htmlRow=htmlRow + '<option value="' + LocationOut.d[i] +'">'+LocationOut.d[i]+'</option>';
                }
                htmlRow=htmlRow +"</select></td>";
                htmlRow = htmlRow + "<td><a title='Stock Detail' onclick='getStockDetails(" + row.productId + ")' style='cursor:pointer' >" + row.sysQty + "</a></td>";            
            }
            if(type=='wso')
            {
                htmlRow = htmlRow + "<td>" + "<a value='0' style='cursor:pointer' onclick='removeRowFromProductTbl(this)'> <img src='../images/erase.png' > </a>" + "</td>";
                htmlRow = htmlRow + "<td><input type='hidden' id='tblHdnSalesOrderId' value='0'></td>";
                htmlRow = htmlRow + "<td>" + sNo + "</td>"; //serial number
                htmlRow = htmlRow + "<td><label id='tblLblProdutCode'>" + row.productCode + "</label></br><input type='hidden' id='tblHdnProductId' value='" + row.productId + "' readonly></td>";
                htmlRow = htmlRow + "<td ><label style='font-size:10px' id='tblLblProdutName'>" + row.productName + "</label><input type='hidden' id='tblHdnProductDescription' value='" + row.productDescription + "'></td>";
                //htmlRow = htmlRow + "<td>" + row.unitName + " <input type='hidden' id='tblHdnUnitId' value='" + row.unitId + "'> </td>";
                htmlRow = htmlRow + "<td><select name='tblHdnUnitId' id='tblHdnUnitId'><option value = '" + row.unitId + "'>"+ row.unitName +"</option></select></td>";
                htmlRow = htmlRow + "<td><input style='width:70px;' onkeydown='return (event.keyCode!=13);' type='number' id='tblTxtUnitPrice' value='" + row.unitPrice + "' onchange='reCalulateLineTotal(" + sNo + ")'> </td>";
                htmlRow = htmlRow + "<td><input style='width:30px;' onkeydown='return (event.keyCode!=13);' type='number' id='tblTxtFreeQty' value='0'> </td>";
                htmlRow = htmlRow + "<td>" + 0 + "</td>";
                htmlRow = htmlRow + "<td>" + 0 + "</td>";
                htmlRow = htmlRow + "<td>" + row.sysQty + "</td>";
                htmlRow = htmlRow + "<td>" + 0 + "</td>";
                if (row.inventoryType == "SNO") {
                    htmlRow = htmlRow + "<td><input style='width:40px;' onkeydown='return (event.keyCode!=13);' type='number' id='tblTxtSalesQty' value='" + row.salesQty + "' onchange='reCalulateLineTotal(" + sNo + ")'><a onclick='showProductSerialNo(this," + sNo + ")' style='cursor:pointer'>Add</a> </td>";
                }
                else {
                    htmlRow = htmlRow + "<td><input style='width:40px;' onkeydown='return (event.keyCode!=13);' type='number' id='tblTxtSalesQty' value='" + row.salesQty + "' onchange='reCalulateLineTotal(" + sNo + ")'></td>";
                }
                htmlRow = htmlRow + "<td>" + row.unitPrice * 1 + "</td>"; //gross price unitprice*salesQty

                if('<%= hdnIsDiscountEnable.Value %>'=="true")
                {
                    htmlRow = htmlRow + "<td><input style='width:30px;' onkeydown='return (event.keyCode!=13);' type='number' id='tblTxtDiscountPer' value='"+row.discountPer+"' onchange='reCalulateLineTotal(" + sNo + ")'></td>";
                    htmlRow = htmlRow + "<td><input style='width:40px;' onkeydown='return (event.keyCode!=13);' type='number' id='tblTxtDiscountValue' value='"+ row.discountValue +"'></td>";
                }else
                {
                    htmlRow = htmlRow + "<td style='display:none'><input style='width:40px;' onkeydown='return (event.keyCode!=13);' type='number' id='tblTxtDiscountPer' value='" + row.discountPer + "' onchange='reCalulateLineTotal(" + sNo + ")'></td>";
                    htmlRow = htmlRow + "<td style='display:none'>" + row.discountValue + "></td>";
                }
                if('<%= hdnIsTaxEnabled.Value %>'=="true")
                {
                    htmlRow = htmlRow + "<td><label id='tblLblTaxPer'>" + row.taxPer + " </label><a title='Add Tax' style='cursor:pointer' onclick='showTax(" + sNo + ")' ><i class='fa fa-plus' /></a></td>";
                    htmlRow = htmlRow + "<td>" + row.taxValue + "</td>";
                }else
                {
                    htmlRow = htmlRow + "<td style='display:none'><label id='tblLblTaxPer'>" + 0 + " </label><a title='Add Tax' style='cursor:pointer' onclick='showTax(" + sNo + ")' ><i class='fa fa-plus' /></a></td>";
                    htmlRow = htmlRow + "<td style='display:none'>" + 0 + "</td>";
                }
                htmlRow = htmlRow + "<td><input type='text' value='"+0.00000+"'></td>"; //total = gross-discount+tax
                htmlRow = htmlRow + "<td><input name='txtCustomerCoopCode' type='text' id='txtCustomerCoopCode' style='width: 50px; '></br>   <input type='submit' name='btnUpdateCustomerCode' value='Update Customer Code' id='btnUpdateCustomerCode'/></td>";
                //htmlRow = htmlRow + "<td><input style='width:40px;' id='Location_Out' onkeyup='LoctionList()' list='states-list' onkeydown='return (event.keyCode!=13);' type='text'><datalist id='states-list' onselect='LoctionList()'></td></td>";
                htmlRow=htmlRow +"<td> <select name='Location_Out' id='Location_Out'>";
                htmlRow=htmlRow + '<option value="">----Select----</option>';
                debugger;  
                console.log(LocationOut);
                for (i = 0; i < LocationOut.d.length; i++)
                {    
                   
                    htmlRow=htmlRow + '<option value="' + LocationOut.d[i] +'">'+LocationOut.d[i]+'</option>';
                }
                if(row.LocationOut!="0"){

                    htmlRow=htmlRow +'<option selected="selected" value="'+row.Location_Out+'">'+row.Location_Out+'</option>'; 
                } 
                htmlRow=htmlRow +"</select></td>";
                htmlRow = htmlRow + "<td><a title='Stock Detail' onclick='getStockDetails(" + row.productId + ")' style='cursor:pointer' >" + row.sysQty + "</a></td>";

            }
            htmlRow = htmlRow + "</tr>";
         //   LoctionList();
            $('#tblProduct > tbody:last-child').append(htmlRow);
            focusFunction();
           // LoctionList();
            if(type=="so" || type==undefined)
            {
               
                if (row.taxValue>0)
                {
                    $.ajax({
                        url: 'SalesInvoice1.aspx/getSalesOrdersTax',
                        method: 'post',
                        async:false,
                        contentType: "application/json; charset=utf-8",
                        data: "{'strOrderId':'" + row.salesOrderId + "','strOrderDetailId':'" + row.salesOrderDetailId + "'}",
                        success: function (data) {
                            var taxData = $.parseJSON(data.d);
                            $.each(taxData, function (key, values) {
                                addTax(sNo, values.taxId, values.taxName, values.taxPer);
                            });
                        }
                    });
                    focusFunction();
                }
                focusFunction();
                //debugger;
                //var tRow = $(tblRow.parentNode.parentNode);
                //var chkBox = $(tRow).find("td:eq(0) input[id='chkAddToInvoice']");
                //$(chkBox).prop('checked',false);
                //tRow.hide(true);
                //fillTblAdvancePayment(row.salesOrderId,row.salesOrderNo);
            }
            if(type=="wso")
            {
                if (row.taxPer != "0")
                {
                    var taxDtls = row.taxDetail;
                    $(taxDtls).each( function() {
                        var taxDtl=$(this);
                        addTax(sNo, taxDtl[0].taxId, taxDtl[0].taxName, taxDtl[0].taxPer); //add row in tax table
                    });
                }
                focusFunction();
            }

            reCalulateLineTotal(sNo);
            if($('#tblProduct tbody tr').length>=1)
            {
                var ddlTransType_= document.getElementById('<%= ddlTransType.ClientID %>');
                if(ddlTransType_!=null)
                {
                    document.getElementById('<%= ddlTransType.ClientID %>').disabled=false;
                }
            }  
            focusFunction();
        }

    
        <%--    function setProductTable(row) {
            var decimalCount =$('#<%= hdnDecimalCount.ClientID %>').val();
            document.getElementById('divProducts').style.display = "block";
            var htmlRow = "<tr>";
            htmlRow = htmlRow + "<td>" + "<a value='" + row.salesOrderId + "' style='cursor:pointer' onclick='removeRowFromProductTbl(this)'> <img src='../images/erase.png' > </a>" + "</td>";
            htmlRow = htmlRow + "<td>" + row.salesOrderNo + " <input type='hidden' id='tblHdnSalesOrderId' value='" + row.salesOrderId + "'> <input type='hidden' id='tblHdnDeliveryVoucher' value=" + row.isDeliveryVoucherAllow + "></td>";
            htmlRow = htmlRow + "<td>" + row.sNo + "</td>"; //serial number
            htmlRow = htmlRow + "<td>" + row.productCode + " <input type='hidden' id='tblHdnProductId' value='" + row.productId + "'></td>";
            htmlRow = htmlRow + "<td style='font-size:10px'>" + row.productName + " <input type='hidden' id='tblHdnProductDescription' value='" + row.productDescription + "'></td>";
            htmlRow = htmlRow + "<td>" + row.unitName + " <input type='hidden' id='tblHdnUnitId' value='" + row.unitId + "'> </td>";
            htmlRow = htmlRow + "<td><input style='width:70px;' onkeydown='return (event.keyCode!=13);' type='number' id='tblTxtUnitPrice' value='" + GetAmountWithDecimal(row.unitPrice, <%=Session["LoginLocDecimalCount"].ToString() %>) + "' onchange='reCalulateLineTotal(" + row.sNo + ");'> </td>";
                 htmlRow = htmlRow + "<td><input style='width:30px;' onkeydown='return (event.keyCode!=13);' type='number' id='tblTxtFreeQty' value='" + row.freeQty + "'> </td>";
                 htmlRow = htmlRow + "<td>" + GetAmountWithDecimal( row.orderQty,decimalCount) + "</td>";
                 htmlRow = htmlRow + "<td>" + GetAmountWithDecimal( row.soldQty ,decimalCount)+ "</td>";
                 htmlRow = htmlRow + "<td>" + GetAmountWithDecimal( row.sysQty ,decimalCount)+ "</td>";
                 htmlRow = htmlRow + "<td>" + GetAmountWithDecimal( row.remainQty ,decimalCount)+ "</td>";
                 if (row.inventoryType == "SNO") {
                     htmlRow = htmlRow + "<td><input style='width:40px;' onkeydown='return (event.keyCode!=13);' type='number' id='tblTxtSalesQty' value='" + row.salesQty + "' onchange='reCalulateLineTotal(" + row.sNo + ")'><a onclick='showProductSerialNo(this," + row.sNo + ")' style='cursor:pointer'>Add</a> </td>";
                 }
                 else {
                     htmlRow = htmlRow + "<td><input style='width:40px;' onkeydown='return (event.keyCode!=13);' type='number' id='tblTxtSalesQty' value='" + row.salesQty + "' onchange='reCalulateLineTotal(" + row.sNo + ")'></td>";
                 }
            //htmlRow = htmlRow + "<td><input style='width:40px;' type='number' id='tblTxtSalesQty' value='" + row.remainQty + "' onchange='reCalulateLineTotal(" + sNo + ")'><a>Add</a> </td>";
                 htmlRow = htmlRow + "<td>" + row.unitPrice * row.salesQty + "</td>"; //gross price unitprice*salesQty
                 if('<%= hdnIsDiscountEnable.Value%>'=="true")
            {
                htmlRow = htmlRow + "<td><input style='width:40px;' onkeydown='return (event.keyCode!=13);' type='number' id='tblTxtDiscountPer' value='" + row.discountPer + "' onchange='reCalulateLineTotal(" + row.sNo + ")'></td>";
                htmlRow = htmlRow + "<td>" + row.discountValue + "</td>";
            }else
            {
                htmlRow = htmlRow + "<td style='display:none'><input style='width:40px;' onkeydown='return (event.keyCode!=13);' type='number' id='tblTxtDiscountPer' value='" + row.discountPer + "' onchange='reCalulateLineTotal(" + row.sNo + ")'></td>";
                htmlRow = htmlRow + "<td style='display:none'>" + GetAmountWithDecimal( row.discountValue ,decimalCount) + "></td>";
            }
            if('<%= hdnIsTaxEnabled.Value%>'=="true")
            {
                htmlRow = htmlRow + "<td><label id='tblLblTaxPer'>" + GetAmountWithDecimal( row.taxPer  ,decimalCount)+ " </label><a title='Add Tax' style='cursor:pointer' onclick='showTax(" + row.sNo + ")' ><i class='fa fa-plus' /></a></td>";
                htmlRow = htmlRow + "<td>" + row.taxValue + "</td>";
            }else
            {
                htmlRow = htmlRow + "<td style='display:none'><label id='tblLblTaxPer'>" + row.taxPer + " </label><a title='Add Tax' style='cursor:pointer' onclick='showTax(" + row.sNo + ")' ><i class='fa fa-plus' /></a></td>";
                htmlRow = htmlRow + "<td style='display:none'>" + row.taxValue + "</td>";
            }
            htmlRow = htmlRow + "<td>" + "00.00" + "</td>"; //total = gross-discount+tax
            htmlRow = htmlRow + "<td><a title='Stock Detail' onclick='getStockDetails(" + row.productId + ")' style='cursor:pointer' >" + GetAmountWithDecimal( row.sysQty ,decimalCount) + "</a></td>";
            htmlRow = htmlRow + "</tr>";
            $('#tblProduct > tbody:last-child').append(htmlRow);
            reCalulateLineTotal(row.sNo);
        }

 function addProductToInvoice(product) {
            
            var sNo = (parseInt($('#tblProduct tbody tr').length) + 1);
            var htmlRow = "<tr>";
            htmlRow = htmlRow + "<td>" + "<a value='0' style='cursor:pointer' onclick='removeRowFromProductTbl(this)'> <img src='../images/erase.png' > </a>" + "</td>";
            htmlRow = htmlRow + "<td><input type='hidden' id='tblHdnSalesOrderId' value='0'></td>";
            htmlRow = htmlRow + "<td>" + sNo + "</td>"; //serial number
            htmlRow = htmlRow + "<td> <label id='tblLblProdutCode'>" + product.productCode + "</label> <input type='hidden' id='tblHdnProductId' value='" + product.productId + "'></td>";
            htmlRow = htmlRow + "<td ><label style='font-size:10px' id='tblLblProdutName'>" + product.productName + "</label> <input type='hidden' id='tblHdnProductDescription' value='" + product.productDescription + "'></td>";
            htmlRow = htmlRow + "<td>" + product.unitName + " <input type='hidden' id='tblHdnUnitId' value='" + product.unitId + "'> </td>";
            htmlRow = htmlRow + "<td><input style='width:70px;' onkeydown='return (event.keyCode!=13);' type='number' id='tblTxtUnitPrice' value='" + product.unitPrice + "' onchange='reCalulateLineTotal(" + sNo + ")'> </td>";
            htmlRow = htmlRow + "<td><input style='width:30px;' onkeydown='return (event.keyCode!=13);' type='number' id='tblTxtFreeQty' value='0'> </td>";
            htmlRow = htmlRow + "<td>" + 0 + "</td>";
            htmlRow = htmlRow + "<td>" + 0 + "</td>";
            htmlRow = htmlRow + "<td>" + product.sysQty + "</td>";
            htmlRow = htmlRow + "<td>" + 0 + "</td>";
            if (product.inventoryType == "SNO") {
                htmlRow = htmlRow + "<td><input style='width:40px;' onkeydown='return (event.keyCode!=13);' type='number' id='tblTxtSalesQty' value='" + 1 + "' onchange='reCalulateLineTotal(" + sNo + ")'><a onclick='showProductSerialNo(this," + sNo + ")' style='cursor:pointer'>Add</a> </td>";
            }
            else {
                htmlRow = htmlRow + "<td><input style='width:40px;' onkeydown='return (event.keyCode!=13);' type='number' id='tblTxtSalesQty' value='" + 1 + "' onchange='reCalulateLineTotal(" + sNo + ")'></td>";
            }
            htmlRow = htmlRow + "<td>" + product.unitPrice * 1 + "</td>"; //gross price unitprice*salesQty

            if('<%= hdnIsDiscountEnable.Value %>'=="true")
            {
                htmlRow = htmlRow + "<td><input style='width:30px;' onkeydown='return (event.keyCode!=13);' type='number' id='tblTxtDiscountPer' value='" + 0 + "' onchange='reCalulateLineTotal(" + sNo + ")'></td>";
                htmlRow = htmlRow + "<td><input style='width:40px;' onkeydown='return (event.keyCode!=13);' type='number' id='tblTxtDiscountValue' value='" + 0 + "'></td>";
            }else
            {
                htmlRow = htmlRow + "<td style='display:none'><input style='width:40px;' onkeydown='return (event.keyCode!=13);' type='number' id='tblTxtDiscountPer' value='" + row.discountPer + "' onchange='reCalulateLineTotal(" + sNo + ")'></td>";
                htmlRow = htmlRow + "<td style='display:none'>" + row.discountValue + "></td>";
            }
            if('<%= hdnIsTaxEnabled.Value %>'=="true")
            {
                htmlRow = htmlRow + "<td><label id='tblLblTaxPer'>" + product.taxPer + " </label><a title='Add Tax' style='cursor:pointer' onclick='showTax(" + sNo + ")' ><i class='fa fa-plus' /></a></td>";
                htmlRow = htmlRow + "<td>" + product.taxValue + "</td>";
            }else
            {
                htmlRow = htmlRow + "<td style='display:none'><label id='tblLblTaxPer'>" + 0 + " </label><a title='Add Tax' style='cursor:pointer' onclick='showTax(" + sNo + ")' ><i class='fa fa-plus' /></a></td>";
                htmlRow = htmlRow + "<td style='display:none'>" + 0 + "</td>";
            }


            htmlRow = htmlRow + "<td>" + "00.00" + "</td>"; //total = gross-discount+tax
            htmlRow = htmlRow + "<td><a title='Stock Detail' onclick='getStockDetails(" + product.productId + ")' style='cursor:pointer' >" + product.sysQty + "</a></td>";
            htmlRow = htmlRow + "</tr>";
            $('#tblProduct > tbody:last-child').append(htmlRow);
            if (product.taxPer != "0")
            {
                var taxDtls = product.taxDetail;
                $(taxDtls).each( function() {
                    var taxDtl=$(this);
                    addTax(sNo, taxDtl[0].taxId, taxDtl[0].taxName, taxDtl[0].taxPer); //add row in tax table
                });
            }
            reCalulateLineTotal(sNo);
            if($('#tblProduct tbody tr').length>=1)
            {
                var ddlTransType_= document.getElementById('<%= ddlTransType.ClientID %>');
                if(ddlTransType_!=null)
                {
                    document.getElementById('<%= ddlTransType.ClientID %>').disabled=false;
                }
            }

        }--%>

        function reCalulateLineTotal(rowSNo) {
            debugger;
            var decimalCount = document.getElementById('<%= hdnDecimalCount.ClientID%>').value;
        var discountPer= 0, discountValue= 0, taxPer= 0, taxValue = 0;
        var row = $('#tblProduct tbody tr:eq(' + (rowSNo - 1) + ')');
            
        //getting values of sales price and sales quantity
        var unitPrice = $(row).find("td:eq(6) input[id='tblTxtUnitPrice']").val();
        var salesQty = $(row).find("td:eq(12) input[id='tblTxtSalesQty']").val();
                
        //setting the decimal (if user uses more values in decimal count)
        $(row).find("td:eq(6) input[id='tblTxtUnitPrice']").val(GetAmountWithDecimal(unitPrice,decimalCount));            
        $(row).find("td:eq(12) input[id='tblTxtSalesQty']").val(GetAmountWithDecimal(salesQty,decimalCount));

        //getting the value again for calculation to avoide decimal count issue
        var unitPrice = $(row).find("td:eq(6) input[id='tblTxtUnitPrice']").val();
        var salesQty = $(row).find("td:eq(12) input[id='tblTxtSalesQty']").val();

        $(row).find('td:eq(13)').html(GetAmountWithDecimal((unitPrice * salesQty),decimalCount));

        if ($('#<%= hdnIsDiscountEnable.ClientID %>').val() == "true") {

            var discountPer = $(row).find("td:eq(14) input[id='tblTxtDiscountPer']").val();
            var discountValue = (unitPrice * discountPer) / 100;
            $(row).find("td:eq(15)")[0].innerHTML=GetAmountWithDecimal(discountValue,decimalCount);
        }
        if ($('#<%= hdnIsTaxEnabled.ClientID %>').val() == "true") {
            var taxPer = $(row).find("td:eq(16) label[id='tblLblTaxPer']").text();
            var taxValue = ((unitPrice - discountValue) * taxPer) / 100;
            $(row).find('td:eq(17)').html(GetAmountWithDecimal(taxValue,3));
        }
        var lineTotal = (unitPrice - discountValue + taxValue) * salesQty;
        $(row).find('td:eq(18)').html(GetAmountWithDecimal(lineTotal,decimalCount));

        reCalculateHeader();
    }

    function reCalculateHeader() {
        var grossAmount = 0.000;
        var totalQty = 0.000;
        var totalDiscount = 0.000;
        var totalTax = 0.000;
        var netAmount = 0.000;
        var taxPer = 0.000;
        var disPer = 0.000;
        var decimalCount = document.getElementById('<%= hdnDecimalCount.ClientID%>').value;
            
        var totalRows = parseInt($('#tblProduct tbody tr').length)-1;

        $('#tblProduct tbody tr').each(function () {
               
            var row = $(this);
            if($(row).find('td:eq(13)').html()!=undefined)
            {
                grossAmount = grossAmount + parseFloat($(row).find('td:eq(13)').html()); //Gross Amount
            }
            if($(row).find("td:eq(12) input[id='tblTxtSalesQty']").val()!=undefined)
            {
                totalQty = totalQty + parseInt($(row).find("td:eq(12) input[id='tblTxtSalesQty']").val());                
            }

            if($(row).find("td:eq(14) input[id='tblTxtDiscountPer']").html()!=undefined)
            {
                if ($('#<%= hdnIsDiscountEnable.ClientID %>').val() == "true") {
                    disPer = disPer + parseFloat($(row).find("td:eq(14) input[id='tblTxtDiscountPer']")[0].value); // Discount %
                }             
            }

            if($(row).find('td:eq(15)').html()!=undefined)
            {
                if ($('#<%= hdnIsDiscountEnable.ClientID %>').val() == "true") {
                    totalDiscount = totalDiscount + parseFloat($(row).find('td:eq(15)').html()); // Discount Value
                }             
            }

            if($(row).find('td:eq(' + colTaxValue + ')').html()!=undefined)
            {
                
                if ($('#<%= hdnIsTaxEnabled.ClientID %>').val() == "true") {
                    totalTax = totalTax + (parseFloat($(row).find('td:eq(' + colTaxValue + ')').html()) * parseFloat($(row).find("td:eq(12) input[id='tblTxtSalesQty']").val())); //Tax Value
                }              
            }

            if($(row).find('td:eq(' + colNetAmount + ')').html()!=undefined)
            {
                netAmount = netAmount + parseFloat($(row).find('td:eq(' + colNetAmount + ')').html()); //line total           
            }               
        });
           

        if(totalDiscount>0 && grossAmount>0)
        {
            disPer=(totalDiscount*100)/grossAmount;
        }

        if (totalTax > 0) {
            taxPer = totalTax * 100 / (grossAmount - totalDiscount)
        }
        $('#<%= txtAmount.ClientID %>').val(GetAmountWithDecimal(grossAmount,decimalCount));
        $('#<%= txtTotalQuantity.ClientID %>').val(GetAmountWithDecimal(totalQty,decimalCount));
        $('#<%= txtDiscountP.ClientID %> ').val(disPer.toFixed(2));
        $('#<%= txtDiscountV.ClientID %> ').val(GetAmountWithDecimal(totalDiscount,decimalCount));
        $('#<%= txtPriceafterdiscountheader.ClientID %> ').val(GetAmountWithDecimal((grossAmount - totalDiscount),decimalCount));
        $('#<%= txtTaxP.ClientID %> ').val(GetAmountWithDecimal(taxPer,decimalCount));
        $('#<%= txtTaxV.ClientID %> ').val(GetAmountWithDecimal(totalTax,decimalCount));
        $('#<%= txtGrandTotal.ClientID %> ').val(getRoundOffAmount(netAmount));
        
        if($('#<%= txtTotalExpensesAmount.ClientID %> ').val()=="")
        {
            $('#<%= txtTotalExpensesAmount.ClientID %> ').val("0");
        }
        var totalExpenses = getRoundOffAmount($('#<%= txtTotalExpensesAmount.ClientID %> ').val());

        var netAmtWithExpenses = parseFloat(totalExpenses)  + parseFloat($('#<%= txtGrandTotal.ClientID %> ').val());

        $('#<%= txtNetAmountwithexpenses.ClientID %> ').val(GetAmountWithDecimal(netAmtWithExpenses,decimalCount));
    }
    function addProductSerialNo(rowIndex) {
        alert(rowIndex);
    }

    function addTax(rowIndex,taxId, taxName,taxPer) {
        var htmlRow = "<tr>";
        htmlRow = htmlRow + "<td style='display:none'>" + rowIndex + "</td>";
        htmlRow = htmlRow + "<td style='display:none'>" + taxId + "</td>";
        htmlRow = htmlRow + "<td>" + taxName + "</td>";
        htmlRow = htmlRow + "<td>" + taxPer + "</td>";
        htmlRow = htmlRow + "</tr>";
        $('#tblTax > tbody:last-child').append(htmlRow);
    }

    function showTax(rowIndex) {
        $('#tblTax tbody tr').each(function () {
            var row = $(this);
            var sNo=parseInt($(row).find('td:eq(0)').html());
            if (sNo==parseInt(rowIndex))
            {
                row.show();
            }
            else
            {
                row.hide(true);
            }
        });
        $('#Modal_GST').modal('show')
            

    }
    function removeRowFromProductTbl(btn)
    {
        
        var tRow = $(btn.parentNode.parentNode);
        var orderId = $(tRow).find("td:eq(1) input[id='tblHdnSalesOrderId']").val();
        var productId = $(tRow).find("td:eq(3) input[id='tblHdnProductId']").val();
        var sNo = $(tRow).find("td:eq(2)").html();
        tRow.remove();
        if($('#tblProduct tbody tr').length<1)
        {
            document.getElementById('<%= ddlTransType.ClientID %>').disabled=false;
        }


        if (orderId != "")
        {
            $('#tblOrders tbody tr').each(function () {
                var row = $(this);
                var _sOrderId = parseInt($(row).find('td:eq(7)').html());
                var _productId = parseInt($(row).find('td:eq(8)').html());
                if (_sOrderId == parseInt(orderId) && _productId == parseInt(productId)) {
                    row.show();
                }
            });
        }
        reCalculateHeader();

        //remove row from from tax table
        if (sNo != "" && $('#tblTax tbody tr').length>0)
        {
            $('#tblTax tbody tr').each(function () {
                var row = $(this);
                var _sNo = parseInt($(row).find('td:eq(0)').html());
                if (_sNo == sNo) {
                    row.remove();
                }
            });
        }

        //remove row from serial table
        if (sNo != "" && $('#tblSerialNo tbody tr').length>0)
        {
            $('#tblSerialNo tbody tr').each(function () {
                var row = $(this);
                var _sNo = parseInt($(row).find('td:eq(0)').html());
                if (_sNo == sNo) {
                    row.remove();
                }
            });
        }

        if ($('#tblProduct tbody tr').length>0 && sNo<=$('#tblProduct tbody tr').length)
        {
            resetTblRowSno();
        }

        if($('#tblProduct tbody tr').length==0)
        {
            var btnshowAdvancePayment_= document.getElementById('btnshowAdvancePayment');
            btnshowAdvancePayment_.style.visibility="hidden";
        }
       
    }
    function resetTblRowSno(){
        var counter=0;
        $('#tblProduct tbody tr').each(function () {
            var row = $(this);
            var oldSno=parseInt($(row).find("td:eq(2)").html());              
            var newSno=++counter;

            $(row).find("td:eq(2)").html(newSno);
            $(row).find("td:eq(6) input[id='tblTxtUnitPrice']")[0].attributes["onchange"].nodeValue="reCalulateLineTotal(" + newSno + ")";
            $(row).find("td:eq(12) input[id='tblTxtSalesQty']")[0].attributes["onchange"].nodeValue="reCalulateLineTotal(" + newSno + ")";
            var addAnchor = $(row).find("td:eq(12) a")[0];
            if(addAnchor!=undefined)
            {
                $(row).find("td:eq(12) a")[0].attributes["onclick"].nodeValue="reCalulateLineTotal(" + newSno + ")";
            }
            var discountPer =$(row).find("td:eq(14) input[id='tblTxtDiscountPer']")[0];
            if(discountPer!=undefined)
            {
                $(row).find("td:eq(14) input[id='tblTxtDiscountPer']")[0].attributes["onchange"].nodeValue="reCalulateLineTotal(" + newSno + ")";
            }
            var showTax=$(row).find("td:eq(16) a")[0];
            if(showTax!=undefined)
            {
                $(row).find("td:eq(16) a")[0].attributes["onclick"].nodeValue="showTax(" + newSno + ")"; 
            }
                
                

            //reset serial in tax table
            $('#tblTax tbody tr').each(function () {
                var row = $(this);
                var _sNo = parseInt($(row).find('td:eq(0)').html());
                if (_sNo == oldSno) {
                    $(row).find('td:eq(0)').html(newSno);
                }
            });

            //reset serial in serialno table
            $('#tblSerialNo tbody tr').each(function () {
                var row = $(this);
                var _sNo = parseInt($(row).find('td:eq(0)').html());
                if (_sNo == oldSno) {
                    $(row).find('td:eq(0)').html(newSno);
                }
            });
        });
    }
    function showProductSearching() {
        var id = setCustomerId();
        if (id == "") {
            var rdo = $('#<%= RdoWithOutSo.ClientID %>')[0].checked = false;
                alert("Please select customer name");
                return;
            }
            document.getElementById('divProductSearch').style.display = "block";
            document.getElementById('divProducts').style.display = "block";
            document.getElementById('divPendingOrders').style.display = "none";
        }
        function getStockDetails(productId) {
            var CustomerName = "";
            try {
                CustomerName = $('#txtCustomer').val().split('/')[0];
                if (CustomerName == "") {
                    throw "Please Enter Customer Name";
                }
            }
            catch (er) {
                alert(er);
                return;
            }
            window.open('../Inventory/Magic_Stock_Analysis.aspx?ProductId=' + productId + '&&Type=SALES&&Contact=' + CustomerName + '');
        }

        function GetAmountWithDecimal(value, n) {
            const v = value.toString().split('.');
            var data="0";
            if (n <= 0) return v[0];
            let f = v[1] || '';
            if (f.length > n) {
                data=`${v[0]}.${f.substr(0, n)}`;
                if(data.split('.')[0]=="NaN")
                {
                    return "0."+data.split('.')[1];
                }
                else
                {
                    return `${v[0]}.${f.substr(0, n)}`;
                }                
            }
            while (f.length < n) f += '0';
            data=`${v[0]}.${f}`;
            if(data.split('.')[0]=="NaN")
            {
                return "0."+data.split('.')[1];
            }
            else
            {
                return `${v[0]}.${f}`;
            }
        }

        function setDecimalAndSymbol()
        {
            try
            {           
                var currency = $('#<%= ddlCurrency.ClientID %>')[0];                
            var ExpCurrency = $('#<%= ddlExpCurrency.ClientID %>')[0];
            var txtExchangeRate_ = document.getElementById('<%= txtExchangeRate.ClientID%>'); 
            var hdnDenomination_=document.getElementById('<%= hdnDenomination.ClientID%>'); 
            if(currency.value=="--Select--")
            {
                document.getElementById('<%= hdnCurrencyCode.ClientID%>').value="0";
                document.getElementById('<%= hdnDecimalCount.ClientID%>').value="0";
                setCurrencySymbol();
                return;
            }

            $("#prgBar").css("display","block");
            PageMethods.getCurrencyDecimalAndSymbol(currency.value,function(data){      
                document.getElementById('<%= hdnCurrencyCode.ClientID%>').value=data.split(',')[1];
                document.getElementById('<%= hdnDecimalCount.ClientID%>').value=data.split(',')[0];
                txtExchangeRate_.value=data.split(',')[2];
                hdnDenomination_.value=data.split(',')[3];
                txtExchangeRate_TextChanged();
                setCurrencySymbol();
                $("#prgBar").css("display","none");
            },errorMessages);

            ExpCurrency.selectedIndex=currency.selectedIndex;
        }        
        catch(er)
        {
            alert(er);
        }
    }

    function ddlPaymentMode_SelectedIndexChanged(paymentMode)
    {
        
        var txtPayAccountNo_ = document.getElementById('<%= txtPayAccountNo.ClientID%>');
        var txtPayAmount_ = document.getElementById('<%= txtPayAmount.ClientID%>');
        var txtLocalAmount_ = document.getElementById('<%= txtLocalAmount.ClientID%>');
        var txtPayCardName_ = document.getElementById('<%= txtPayCardName.ClientID%>');
        var txtPayChequeNo_ = document.getElementById('<%= txtPayChequeNo.ClientID%>');
        var txtPayCardNo_ = document.getElementById('<%= txtPayCardNo.ClientID%>');
        var txtPayChequeDate_ = document.getElementById('<%= txtPayChequeDate.ClientID%>');
        var txtCreditNote_ = document.getElementById('<%= txtCreditNote.ClientID%>');                
        var txtNetAmountwithexpenses_ = document.getElementById('<%= txtNetAmountwithexpenses.ClientID%>');                
        var divChequeDetails_ = document.getElementById('divChequeDetails');    
        var divCardDetails_ = document.getElementById('divCardDetails');    
        var decimalCount = document.getElementById('<%= hdnDecimalCount.ClientID%>').value;
        var hdnPaymentType_ = document.getElementById('<%= hdnPaymentType.ClientID%>');                
        
        


        divChequeDetails_.style.display="none";
        divCardDetails_.style.display="none";

        txtCreditNote_.disabled = true;
        if(paymentMode.selectedOptions[0].innerHTML=="--Select--")
        {
            txtPayAccountNo_.value="";
            return;
        }

        if(txtNetAmountwithexpenses_.value=="")
        {
            paymentMode.selectedIndex=0;
            alert("Please add a Product to create a Payment");
            return;
        }


            
        var total1=0;
               
        if($('#tblPayment tbody tr').length>=1){
            var ddlPaymentModeValue="";
            $('#tblPayment tbody tr').each(function(){
                var tblPaymentRow1 = $(this);                    
                if($(tblPaymentRow1).find("td:eq(4)").html()!=undefined)
                {
                    total1=total1+parseFloat($(tblPaymentRow1).find("td:eq(4)").html());    
                }                        
            });
        }
        if(txtPayAmount_.value==""){
            txtPayAmount_.value=txtNetAmountwithexpenses_.value;
            txtPayAmount_OnTextChanged();
        }
        else
        {
            txtPayAmount_.value=GetAmountWithDecimal((parseFloat(txtNetAmountwithexpenses_.value)-total1),decimalCount);
            txtPayAmount_OnTextChanged();
        }
        if(paymentMode.selectedOptions[0].innerHTML=="Credit Note")
        {
            txtCreditNote_.disabled = false;
        }

        if(paymentMode.selectedOptions[0].innerHTML=="Credit")
        {
            divChequeDetails_.style.display="block";
        }
        if(paymentMode.selectedOptions[0].innerHTML=="Card")
        {
            divCardDetails_.style.display="block";
        }


        $("#prgBar").css("display","block");
        PageMethods.getAccountNo(paymentMode.value,function(data){
            txtPayAccountNo_.value=data[0];
            hdnPaymentType_.value=data[1];
            $("#prgBar").css("display","none");
        },errorMessages);
    }

     
    function txtPayAmount_OnTextChanged()
    {
        var decimalCount = document.getElementById('<%= hdnDecimalCount.ClientID%>').value;
        var txtPayAmount_ = document.getElementById('<%= txtPayAmount.ClientID%>');
        var txtPaymentExchangerate_=document.getElementById('<%= txtPaymentExchangerate.ClientID%>');    
        var txtLocalAmount_ = document.getElementById('<%= txtLocalAmount.ClientID%>');

        if(txtPayAmount_.value=="")
        {
            txtLocalAmount_.value="";
            return;
        }
        if (isNaN(txtPayAmount_.value)) {
            alert("Please Enter A Valid Number");
            txtPayAmount_.value = "";
            txtPayAmount_.focus();
            return;
        }
        if (isNaN(txtPaymentExchangerate_.value)) {
            alert("Please Enter A Valid Number");
            txtPaymentExchangerate_.value = "";
            txtPaymentExchangerate_.focus();
            return;
        }
        txtLocalAmount_.value=GetAmountWithDecimal((parseFloat(txtPayAmount_.value)*parseFloat(txtPaymentExchangerate_.value)),decimalCount);
    }

    function txtPayAccountNo_TextChanged()
    {            
        var txtPayAccountNo_ = document.getElementById('<%= txtPayAccountNo.ClientID%>');
        if(txtPayAccountNo_.value=="")
        {
            return;
        }
        try{
            var accountName = txtPayAccountNo_.value.split('/')[0];
            var accountNo = txtPayAccountNo_.value.split('/')[1];

            if (isNaN(accountNo)) {
                txtPayAccountNo_.value="";
                txtPayAccountNo_.focus();
                return;
            }
            $("#prgBar").css("display","block");
            PageMethods.txtPayAccountNo_TextChanged(accountName,function(data){
                if(data==false)
                {
                    txtPayAccountNo_.value="";
                }
                $("#prgBar").css("display","none");
            },errorMessages)
        }
        catch(er)
        {
            alert(er);
        }            
    }

    function txtCreditNote_TextChanged()
    {
        try
        {
            var txtLocalAmount_ = document.getElementById('<%= txtLocalAmount.ClientID%>');
            var currencyid = $('#<%= ddlCurrency.ClientID %>').val();
            var txtCreditNote_ = document.getElementById('<%= txtCreditNote.ClientID%>');   
            var decimalCount = document.getElementById('<%= hdnDecimalCount.ClientID%>').value;
            var hdnVoucherID_ = document.getElementById('<%= hdnVoucherID.ClientID%>').value;
            $("#prgBar").css("display","block");
            PageMethods.txtCreditNote_TextChanged(txtCreditNote_.value,currencyid,function(data){
                if(data=="0")
                {
                    txtCreditNote_.value="";
                    txtCreditNote_.focus();     
                    txtCreditNote_.disabled = false;
                    hdnVoucherID_.value="";
                    alert("This credit Note is not Valid");
                    return;
                }
                if(data.split(',')[0]=="false")
                {
                    txtCreditNote_.value="";
                    txtCreditNote_.focus();     
                    txtCreditNote_.disabled = false;
                    hdnVoucherID_.value="";
                    alert("Currency Mismatch please select another credit note");
                    return;
                }
                if(data.split(',')[0]=="Select another")
                {
                    hdnVoucherID_.value="";
                    alert("Customer having only " + data.split(',')[1] + " Amount in selected credit Note, Please select another one.");
                    return;
                }
                if(data.split(',')[1]!="")
                {
                    txtCreditNote_.disabled = false;
                    txtLocalAmount_.value=GetAmountWithDecimal((parseFloat(txtPayAmount_.value)*parseInt(txtPaymentExchangerate_.value)),decimalCount);
                    hdnVoucherID_.value=data.split(',')[1];
                    return;
                }
                $("#prgBar").css("display","none");
            },errorMessages);
        }
        catch(er)
        {
            txtCreditNote_.value="";
            txtCreditNote_.focus();              
            alert(er);
        }
    }

    function btnAddPayment(){
        try
        {            
            var txtPayAccountNo_ = document.getElementById('<%= txtPayAccountNo.ClientID%>');
            var txtPayAmount_ = document.getElementById('<%= txtPayAmount.ClientID%>');
            var txtLocalAmount_ = document.getElementById('<%= txtLocalAmount.ClientID%>');
            var txtPayCardName_ = document.getElementById('<%= txtPayCardName.ClientID%>');
            var txtPayChequeNo_ = document.getElementById('<%= txtPayChequeNo.ClientID%>');
            var txtPayCardNo_ = document.getElementById('<%= txtPayCardNo.ClientID%>');
            var txtPayChequeDate_ = document.getElementById('<%= txtPayChequeDate.ClientID%>');
            var txtCreditNote_ = document.getElementById('<%= txtCreditNote.ClientID%>');    
            var ddlPayBank_ = document.getElementById('<%= ddlPayBank.ClientID%>');    
            var ddlTabPaymentMode_ = document.getElementById('<%= ddlTabPaymentMode.ClientID%>');    
            var txtPaymentExchangerate_=document.getElementById('<%= txtPaymentExchangerate.ClientID%>');    
            var ddlCurrency_ = document.getElementById('<%= ddlCurrency.ClientID%>');    
            var hdnVoucherID_ = document.getElementById('<%= hdnVoucherID.ClientID%>');
            var txtNetAmountwithexpenses_ = document.getElementById('<%= txtNetAmountwithexpenses.ClientID%>');
            var decimalCount = document.getElementById('<%= hdnDecimalCount.ClientID%>').value;
            var hdnPaymentType_ = document.getElementById('<%= hdnPaymentType.ClientID%>');                
        
            var divChequeDetails_ = document.getElementById('divChequeDetails');    
            var divCardDetails_ = document.getElementById('divCardDetails');    
            
                

            var total1=0;
               
            if($('#tblPayment tbody tr').length>=1){
                var ddlPaymentModeValue="";
                $('#tblPayment tbody tr').each(function(){
                    var tblPaymentRow1 = $(this);
                    if($(tblPaymentRow1).find("td:eq(1)").html()!=undefined)
                    {
                        ddlPaymentModeValue=$(tblPaymentRow1).find("td:eq(1)")[0].childNodes[0].nodeValue;
                        if(ddlTabPaymentMode_.selectedOptions[0].innerHTML.trim()==ddlPaymentModeValue.trim())
                        {
                            throw "Payment Mode in "+ddlTabPaymentMode_.selectedOptions[0].innerHTML+" has already been selected";                                
                        }
                        ddlPaymentModeValue="";
                    }
                    if($(tblPaymentRow1).find("td:eq(4)").html()!=undefined)
                    {
                        total1=total1+parseFloat($(tblPaymentRow1).find("td:eq(4)").html());    
                    }                        
                });
                total1=total1+parseFloat(txtPayAmount_.value);
            }
               
            if(total1>(parseFloat(txtNetAmountwithexpenses_.value)))
            {
                alert("Amount Value Exceeded !!!");
                return;
            }
                
            var sNo = (parseInt($('#tblPayment tbody tr').length) + 1);

            if(ddlTabPaymentMode_.selectedOptions[0].innerHTML=="--Select--")
            {
                throw "Please Select Payment Mode";
            }
            if(txtPayAmount_.value=="")
            {
                throw "Please Enter Balance Amount";
            }
            if(txtPayAccountNo_.value=="")
            {
                throw "Please Enter Account No";
            }

                
            divChequeDetails_.style.display="none";
            divCardDetails_.style.display="none";

            hdnVoucherID_.value=hdnVoucherID_.value==undefined?'':hdnVoucherID_.value;
            
            var htmlRow = "<tr>";
            htmlRow = htmlRow + "<td><a value='" + sNo + "' title='Delete' style='cursor:pointer' onclick='deletePaymentRow(this)'> <img src='../images/erase.png' > </a></td>";
            htmlRow = htmlRow + "<td>" + ddlTabPaymentMode_.selectedOptions[0].innerHTML + " <input type='hidden' id='tblHdnPaymentModeID' value='" + ddlTabPaymentMode_.value  + "'> </td>"; 
            htmlRow = htmlRow + "<td>" + txtPayAccountNo_.value.split('/')[0] + " <input type='hidden' id='tblHdnAccountID' value='" + txtPayAccountNo_.value.split('/')[1] + "'></td>";
            htmlRow = htmlRow + "<td style='display:none;'> <input type='hidden' id='tblHdnVoucherID' value='"+hdnVoucherID_.value+"'><input type='hidden' id='tblHdnBankId' value='"+ddlPayBank_.value+"'><input type='hidden' id='tblHdnChequeDate' value='"+txtPayChequeDate_.value+"'> <input type='hidden' id='tblHdnChequeNo' value='"+txtPayChequeNo_.value+"'> <input type='hidden' id='tblHdnBankAccountNo' value=''><input type='hidden' id='tblHdnBankAccountName' value=''> <input type='hidden' id='tblHdnCurrencyID' value='" + ddlCurrency_.value + "'><input type='hidden' id='tblHdnCardNo' value='" + txtPayCardNo_.value + "'><input type='hidden' id='tblHdnCardName' value='" + txtPayCardName_.value + "'><input type='hidden' id='tblHdnPaymentType' value='" + hdnPaymentType_.value + "'></td>";
            htmlRow = htmlRow + "<td>" + txtPayAmount_.value + "</td>";
            htmlRow = htmlRow + "<td>" + txtPaymentExchangerate_.value + "</td>";
            htmlRow = htmlRow + "<td>" + txtLocalAmount_.value + "</td>";
            htmlRow = htmlRow + "</tr>";
                
            $('#tblPayment > tbody:last-child').append(htmlRow);
                
            var total=0;
            if($('#tblPayment tbody tr').length>1){
                $('#tblPayment tbody tr').each(function(){
                    var tblPaymentRow = $(this);
                    if($(tblPaymentRow).find("td:eq(4)").html()!=undefined)
                    {
                        total=total+parseFloat($(tblPaymentRow).find("td:eq(4)").html());    
                    }                        
                });
                txtPayAmount_.value = GetAmountWithDecimal((parseFloat(txtNetAmountwithexpenses_.value)-total),decimalCount);
                   
            }
            else{
                txtPayAmount_.value = GetAmountWithDecimal((parseFloat(txtNetAmountwithexpenses_.value)-parseFloat(txtPayAmount_.value)),decimalCount);                    
            }

            ddlTabPaymentMode_.selectedIndex=0;
            txtPayAccountNo_.value ="";
            txtPayAmount_OnTextChanged();
        }
        catch(er)
        {
            alert(er);
        }
    }

    function deletePaymentRow(btn)
    {
        var tRow = $(btn.parentNode.parentNode);
        tRow.remove();
    }
    function setCurrencySymbol()
    {
        var hdnCurrencyCode_ = document.getElementById('<%= hdnCurrencyCode.ClientID%>');
        var lblAmount_ = document.getElementById('<%= lblAmount.ClientID%>');
        var lbltaxValue_ = document.getElementById('<%= Label2.ClientID%>');
        var lblGrandTotal_ = document.getElementById('<%= lblGrandTotal.ClientID%>');
        var lblTotalExpences_ = document.getElementById('<%= Label11.ClientID%>');
        var lblNetAmountwithexpenses_ = document.getElementById('<%= Label12.ClientID%>');

        lblAmount_.innerHTML=hdnCurrencyCode_.value +" Gross Amount";
        try{lbltaxValue_.innerHTML=hdnCurrencyCode_.value +" Value";}catch(er){}
        lblGrandTotal_.innerHTML=hdnCurrencyCode_.value +" Net Amount";
        lblTotalExpences_.innerHTML=hdnCurrencyCode_.value +" Total Expenses";
        lblNetAmountwithexpenses_.innerHTML=hdnCurrencyCode_.value +" Net Amount";
    }

    function setTotalExpensesAmount()
    {
        var txtTotalExpensesAmount_ = document.getElementById('<%= txtTotalExpensesAmount.ClientID%>');
        txtTotalExpensesAmount_.value="0";            
    }

    function txtExchangeRate_TextChanged()
    {            
        var txtPaymentExchangerate_ = document.getElementById('<%= txtPaymentExchangerate.ClientID%>');
            var txtPayAmount_ = document.getElementById('<%= txtPayAmount.ClientID%>'); 
            var txtExchangeRate_ = document.getElementById('<%= txtExchangeRate.ClientID%>'); 
            var txtExpExchangeRate_ = document.getElementById('<%= txtExpExchangeRate.ClientID%>');
            txtPaymentExchangerate_.value=txtExchangeRate_.value;
            txtExpExchangeRate_.value=txtExchangeRate_.value;
            if(txtPayAmount_.value!="")
            {
                txtPayAmount_OnTextChanged();
            }            
        }

        function ddlExpense_SelectedIndexChanged()
        {
            var ddlExpense_ = document.getElementById('<%= ddlExpense.ClientID%>');
            var txtExpensesAccount_ = document.getElementById('<%= txtExpensesAccount.ClientID%>');

            if (ddlExpense_.selectedOptions[0].innerHTML == "--Select--")
            {
                txtExpensesAccount_.value = "";
            }
            else
            {
                $("#prgBar").css("display","block");
                PageMethods.ddlExpense_SelectedIndexChanged(ddlExpense_.value,function(data){
                    txtExpensesAccount_.value=data;
                    $("#prgBar").css("display","none");
                },errorMessages);
            }
        }
   function ddlPaymentMode_Selected()
   {
       debugger;
       var ddlPaymentMode_ = document.getElementById('<%= ddlTabPaymentMode.ClientID%>');          
       var txtPayAccountNo_=document.getElementById('<%=txtPayAccountNo.ClientID%>');
       var txtPayAmount_=document.getElementById('<%=txtPayAmount.ClientID%>');
       var txtLocalAmount_=document.getElementById('<%=txtLocalAmount.ClientID%>');
       var txtPaymentExchangerate_=document.getElementById('<%=txtPaymentExchangerate.ClientID%>');
       if (ddlPaymentMode_.selectedOptions[0].innerHTML == "--Select--")
            {
           txtPayAccountNo_.value = "";
            }
            else
            {
                $("#prgBar").css("display","block");
                PageMethods.ddlPaymentMode_SelectedIndexChanged(ddlPaymentMode_.value,function(data){
                    console.log(data);
                    txtPayAccountNo_.value=data;
                    txtPayAmount_.value=$('#ctl00_MainContent_txtNetAmountwithexpenses').val();
                    txtLocalAmount_.value=txtPaymentExchangerate_.value * txtPayAmount_.value;
                    //console.log(txtLocalAmount_.value);
                    $("#prgBar").css("display","none");
                    
                },errorMessages);
            }
        }

        function txtFCExpAmount_OnTextChanged()
        {
            var txtExpExchangeRate_ = document.getElementById('<%= txtExpExchangeRate.ClientID%>');
            var txtFCExpAmount_ = document.getElementById('<%= txtFCExpAmount.ClientID%>');
            var txtExpCharges_ = document.getElementById('<%= txtExpCharges.ClientID%>');
            var txtExchangeRate_ = document.getElementById('<%= txtExchangeRate.ClientID%>');
            
            var decimalCount = document.getElementById('<%= hdnDecimalCount.ClientID%>').value;

            if (txtExpExchangeRate_.value == "")
            {
                txtExpExchangeRate_.value = "0";
            }
            if (txtFCExpAmount_.value == "")
            {
                txtFCExpAmount_.value = "0";
            }
            try
            {
                txtExpCharges_.value = (parseFloat(txtFCExpAmount_.value) * parseFloat(txtExchangeRate_.value));
                txtExpCharges_.value = GetAmountWithDecimal(txtExpCharges_.value,decimalCount);
            }
            catch(er)
            {
                txtExpCharges_.value =  GetAmountWithDecimal(0,decimalCount);
            }
        }
        function txtExpensesAccount_TextChanged(control)
        {
            if(control.value=="")
            {
                return;
            }
            $("#prgBar").css("display","block");
            PageMethods.txtExpensesAccount_TextChanged(control.value.split('/')[0],function(data){
                if(data!="True")
                {
                    control.value="";
                    control.focus();
                    alert(data);
                    $("#prgBar").css("display","none");
                }
            },errorMessages)
        }

        function AddExpenses()
        {
                    
            var txtFCExpAmount_ = document.getElementById('<%= txtFCExpAmount.ClientID%>');
            var txtExpensesAccount_ = document.getElementById('<%= txtExpensesAccount.ClientID%>');
            var ddlCurrency_ = document.getElementById('<%= ddlCurrency.ClientID%>');    
            var txtExpensesAccount_ = document.getElementById('<%= txtExpensesAccount.ClientID%>');
            var ddlExpense_ = document.getElementById('<%= ddlExpense.ClientID%>');    
            var txtExpCharges_ = document.getElementById('<%= txtExpCharges.ClientID%>');
            var txtExpExchangeRate_ = document.getElementById('<%= txtExpExchangeRate.ClientID%>');
            var txtTotalExpensesAmount_ = document.getElementById('<%= txtTotalExpensesAmount.ClientID%>');
            var decimalCount = document.getElementById('<%= hdnDecimalCount.ClientID%>').value;
            var txtGrandTotal_ = document.getElementById('<%= txtGrandTotal.ClientID%>');
            var txtNetAmountwithexpenses_ = document.getElementById('<%= txtNetAmountwithexpenses.ClientID%>');
            
            var sNo = (parseInt($('#tblExpenses tbody tr').length) + 1);            
            var htmlRow = "<tr>";
            htmlRow = htmlRow + "<td><a value='" + sNo + "' title='Delete' style='cursor:pointer' onclick='deleteExpensesRow(this)'> <img src='../images/erase.png' > </a></td>";
            htmlRow = htmlRow + "<td>" + ddlExpense_.selectedOptions[0].innerHTML + " <input type='hidden' id='tblHdnExpensesId' value='" + ddlExpense_.value  + "'> </td>"; 
            htmlRow = htmlRow + "<td>" + ddlCurrency_.selectedOptions[0].innerHTML + " <input type='hidden' id='tblHdnCurrencyId' value='" + ddlCurrency_.value + "'></td>";
            htmlRow = htmlRow + "<td>" + txtFCExpAmount_.value + " <input type='hidden' id='tblHdnAccountId' value='"+txtExpensesAccount_.value.split('/')[1]+"'></td>";                                   
            htmlRow = htmlRow + "<td>" + txtExpExchangeRate_.value + "</td>";
            htmlRow = htmlRow + "<td>" + txtExpCharges_.value + "</td>";
            htmlRow = htmlRow + "<td>" + txtFCExpAmount_.value + "</td>";
            htmlRow = htmlRow + "</tr>";
            $('#tblExpenses > tbody:last-child').append(htmlRow);

            var total=0;
            if($('#tblExpenses tbody tr').length>1){
                $('#tblExpenses tbody tr').each(function(){
                    var tblExpensesRow = $(this);
                    if($(tblExpensesRow).find("td:eq(3)").html()!=undefined)
                    {
                        total=total+parseFloat($(tblExpensesRow).find("td:eq(3)").html());    
                    }                        
                });
                txtTotalExpensesAmount_.value = getRoundOffAmount(total);           
            }
            else{
                txtTotalExpensesAmount_.value = getRoundOffAmount(parseFloat(txtFCExpAmount_.value));
            }

            if(txtGrandTotal_.value!="")
            {
                txtNetAmountwithexpenses_.value = GetAmountWithDecimal((parseFloat(txtTotalExpensesAmount_.value)+parseFloat(txtGrandTotal_.value)),decimalCount);
            }else
            {
                txtNetAmountwithexpenses_.value = GetAmountWithDecimal(parseFloat(txtTotalExpensesAmount_.value),decimalCount);
            }

            ddlExpense_.selectedIndex=0;
            txtFCExpAmount_.value ="";
            txtExpExchangeRate_.value ="";
            txtExpCharges_.value ="";
            txtExpensesAccount_.value ="";

        }
        function deleteExpensesRow(btn)
        {
            var txtTotalExpensesAmount_ = document.getElementById('<%= txtTotalExpensesAmount.ClientID%>');
            var decimalCount = document.getElementById('<%= hdnDecimalCount.ClientID%>').value;
            var txtNetAmountwithexpenses_ = document.getElementById('<%= txtNetAmountwithexpenses.ClientID%>');
            var txtGrandTotal_ = document.getElementById('<%= txtGrandTotal.ClientID%>');
            var tRow = $(btn.parentNode.parentNode);
            var ExpensesAmt = parseFloat(txtTotalExpensesAmount_.value) - parseFloat(tRow[0].cells[3].innerText.trim());
            txtTotalExpensesAmount_.value=getRoundOffAmount(ExpensesAmt);
            txtNetAmountwithexpenses_.value= GetAmountWithDecimal((parseFloat(txtGrandTotal_.value) + parseFloat(txtTotalExpensesAmount_.value)),decimalCount);
            tRow.remove();
        }


        function txtProductName_TextChanged(ctl) {
            var searctText = $(ctl).val();
            if (searctText == "") {
                return;
            }
            debugger;
            var customerId = setCustomerId();
            if (customerId = "") {
                return;
            }
            var trnsType = $('#<%= ddlTransType.ClientID %>').val();
            if (trnsType == undefined)
            {
                trnsType = 0;
            }
            $("#prgBar").css("display","block");
            $.ajax({
                url: 'SalesInvoice1.aspx/getProductDetail',
                method: 'post',                 
                async: false,
                contentType: "application/json; charset=utf-8",
                data: "{'strSearchText':'" + searctText + "','isSalesTax':'" + $('#<%= hdnIsTaxEnabled.ClientID %>').val() + "','transType':'" + trnsType + "','strCustomerId':'" + setCustomerId() + "'}",
                 success: function (data) {                    
                     if(data.d=="Product Not Found" || data.d=="Invalid Serial")
                     {
                         alert(data.d);
                         ctl.value="";
                         ctl.focus();
                         $("#prgBar").css("display","none");
                         return;
                     }
                     var product = $.parseJSON(data.d);
                     console.log(product);
                     var isUpdateDone = false;
                     //check product in existing table if it already exist then need to increase only qty
                     if ($('#tblProduct tbody tr').length > 0) {
                         $('#tblProduct tbody tr').each( function () {
                             var row = $(this);
                             if ($(row).find("td:eq(3) input[id='tblHdnProductId']").val() == product.productId) {
                                 var sNo = $(row).find("td:eq(2)").html();
                                 //check serial no for duplicate
                                 if (product.inventoryType == "SNO" && product.searchBySerialNo == true) {
                                     if ($('#tblSerialNo tbody tr').length > 0) {
                                         $('#tblSerailNo tbody tr').each(function () {
                                             var tblSnoRow = $(this);
                                             if ($(tblSnoRow).find("td:eq(2)").html() == searctText) {
                                                 alert("Serial No already exist please select another one");
                                                 isUpdateDone = true;
                                                 $("#prgBar").css("display","none");
                                                 return;
                                             }
                                         });
                                         //insert new row in serial no table
                                         addRowToSerailNoTable(sNo, searctText);
                                     }
                                 }
                                 if (isUpdateDone == false) {
                                     var salesQty = $(row).find("td:eq(12) input[id='tblTxtSalesQty']").val();
                                     $(row).find("td:eq(12) input[id='tblTxtSalesQty']").val(parseInt(salesQty) + 1);
                                     ctl.value="";
                                     reCalulateLineTotal(sNo);
                                     isUpdateDone = true;
                                     $("#prgBar").css("display","none");
                                 }
                                 $("#txtSearchProductName").focus();
                                 return;
                             }
                             $("#txtSearchProductName").focus();
                         });
                     }
                     if (isUpdateDone == false) {
                         fillTblProduct(product,0,this,'wso');
                         ctl.value="";
                         $("#prgBar").css("display","none");
                         isUpdateDone = true;
                         var datad=document.getElementById('<%= ddlTransType.ClientID %>')
                        if(document.getElementById('<%= ddlTransType.ClientID %>')!=null)
                        {
                            if($('#tblProduct tbody tr').length>=1)
                            {
                                document.getElementById('<%= ddlTransType.ClientID %>').disabled=true;
                            }                        
                        } 
                         $("#txtSearchProductName").focus();
                     }
                     $("#txtSearchProductName").focus();
                     $("#prgBar").css("display","none");
                 }
            });
            $("#txtSearchProductName").focus();
        }

     
        function showProductSerialNo(ctl, rowIndex) {

            var tRow = $(ctl.parentNode.parentNode);
            var productCode = $(tRow).find("td:eq(3)")[0].childNodes[0].data;
            var productName = $(tRow).find("td:eq(4)")[0].childNodes[0].data;
            var productId = $(tRow).find("td:eq(3) input[id='tblHdnProductId']").val()

            $('#tblSerialNo tbody tr').each(function () {
                var row = $(this);
                var sNo = parseInt($(row).find('td:eq(0)').html());
                if (sNo == parseInt(rowIndex)) {
                    row.show();
                }
                else {
                    row.hide(true);
                }
            });
            $('#<%=hdnHeaderRowForSno.ClientID %>').val(rowIndex); //set value to get curren row
            $('#<%=hdnProductIdForSno.ClientID %>').val(productId);
            $('#<%=txtSerialNo.ClientID %>').val('');

            $('#<%=lblProductIdvalue.ClientID %>').text(productCode);
            $('#<%=lblProductNameValue.ClientID %>').text(productName);
            $('#Return_Modal').modal('show');
        }
        function productSerialAdd() {
            var txtSno = $('#<%= txtSerialNo.ClientID %>');
            var serialNos = $(txtSno).val();
            var productId = $('#<%=hdnProductIdForSno.ClientID %>').val();
            if (serialNos == "") {
                return;
            }
            $(txtSno).val(''); //set blank
            var serailNoArray = serialNos.split("\n");
            var validSerialNos = [];
            var errMessage = "";
            //get unique in list
            $(serailNoArray).each(function (key, value) {
                if ($.inArray(value, validSerialNos) == -1) {
                    $('#tblSerialNo tbody tr').each(function () {  //check table for duplicate
                        var row = $(this);
                        if ($(row).find('td:eq(2)').html() == value) {
                            $(txtSno).val($(txtSno).val() + "\n" + value);
                            value = "";
                            return false;
                        }
                    });
                    if (value != "") {
                        validSerialNos.push(value);
                    }
                    else {
                        errMessage = errMessage + value + "(Duplicate)\n";
                    }
                } else {
                    $(txtSno).val($(txtSno).val() + "\n" + value);
                }
            });

            if (validSerialNos.length > 0) {
                $("#prgBar").css("display","block");
                $.ajax({
                    url: 'SalesInvoice1.aspx/validateSerailNo',
                    method: 'post',
                    contentType: "application/json; charset=utf-8",
                    data: "{'strProductId':'" + productId + "','strSerial':'" + JSON.stringify(validSerialNos) + "'}",
                    success: function (data) {
                        var snoData = $.parseJSON(data.d);
                        
                        $.each(snoData, function (key, values) {
                            if (values.status == "VALID") {
                                addRowToSerailNoTable($('#<%=hdnHeaderRowForSno.ClientID %>').val(), values.sNo);
                            }
                            else {
                                $(txtSno).val($(txtSno).val() + "\n" + values.sNo);
                                errMessage = errMessage + values.sNo + "(" + values.status + ")\n";
                            }

                            //addTax(sNo, values.taxId, values.taxName, values.taxPer);
                        });
                        if ($(txtSno).val() != "") //remove leading \n
                        {
                            var val = $(txtSno).val().substring(1, $(txtSno).val().length);
                            $(txtSno).val(val)
                        }
                        if (errMessage != "") {
                            alert(errMessage);
                        }
                        $("#prgBar").css("display","none");
                    }
                      
                });
            }
        }

        function addRowToSerailNoTable(headerRowNo, serialNo) {
            var htmlRow = "<tr>";
            console.log('table bind');
            htmlRow = htmlRow + "<td style='display:none'>" + headerRowNo + "</td>";
            htmlRow = htmlRow + "<td><a style='cursor:pointer' onclick='removeRowFromSerialNoTbl(this)'> <img src='../images/erase.png' > </a></td>";
            htmlRow = htmlRow + "<td>" + serialNo + "</td>";
            htmlRow = htmlRow + "<td></td>";
            htmlRow = htmlRow + "<td></td>";
            htmlRow = htmlRow + "<td></td>";
            htmlRow = htmlRow + "</tr>";
            $('#tblSerialNo > tbody:last-child').append(htmlRow);
        }
        function removeRowFromSerialNoTbl(btn) {
            var tRow = $(btn.parentNode.parentNode);
            tRow.remove();
        }
        function ddlProductSerach_SelectedIndexChanged(ctl) {                              
            if (ctl.value == "ProductCode") {
                document.getElementById('divProductName').style.display="none";
                document.getElementById('divProductCode').style.display="block";                   
            }
            else {
                document.getElementById('divProductName').style.display="block";
                document.getElementById('divProductCode').style.display="none";
            }
        }

        function fillTblInvoice(){
            $('#tblInvoice').DataTable({
                destroy:true,
                bServerSide: true,
                bProcessing:true,
                sAjaxSource:'../pryceService.asmx/fillTblInvoice',
                sServerMethod:'post',
                columns:[
                     {
                         data: "salesInvoiceId", render: function (data, display, row, end) {
                             return "<input type='checkbox' id='tblChkTransId' value='"+data+"' onchange='gridActions(this)'>";
                         }, className: "text-left"
                     },
                    { data: "invoiceNo", title: "Invoice No.", className: "text-left" },
                        { data: "invoiceDate", title: "Invoice Date", className: "text-left" },
                        { data: "refType", title: "Ref. Type", className: "text-left" },
                        { data: "refNo", title: "Ref. No.", className: "text-left" },
                        { data: "salesPerson", title: "Sales Person", className: "text-left" },
                        { data: "customerName", title: "Customer Name", className: "text-left" },
                        { data: "approvalStatus", title: "Status", className: "text-left" },
                        { data: "createdBy", title: "Created By", className: "text-left" },
                        { data: "invoiceAmount", render:function (data, display, row, end) {
                            return row.currencyCode + " " + row.invoiceAmount;
                        }, title: "Amount", className: "text-right" }                        
                ], 
                fnServerParams:function(aoData){
                    aoData.push({name:"strRecordType",value: "" + $('#<%=ddlPosted.ClientID %>').val() + ""});
                },
                order: [[ 2, "desc" ]]
            });
            }

            function txtDiscountP_TextChanged(data)
            {
                var discountPer=data.value;
                $('#tblProduct tbody tr').each(function () { 
                    var row = $(this);               
                
                    if($(row).find("td:eq(14) input[id='tblTxtDiscountPer']").html()!=undefined)
                    {              
                        if ($('#<%= hdnIsDiscountEnable.ClientID %>').val() == "true") {
                            $(row).find("td:eq(14) input[id='tblTxtDiscountPer']")[0].value=discountPer; // Discount %                        
                        }             
                    }       
                    if($(row).find('td:eq(2)').html()!=undefined)
                    {
                        reCalulateLineTotal($(row).find('td:eq(2)').html());
                    }
                });
            
            }


            //$(document).ajaxStart(function() {
            //    // show loader on start
            //    $("#prgBar").css("display","block");
            //}).ajaxSuccess(function() {
            //    // hide loader on success
            //    $("#prgBar").css("display","none");
            //}).ajaxError(function() {
            //    // hide loader on erro
            //    $("#prgBar").css("display","none");
            //});


            function getCurrentDate() {

                var today = new Date();

                var dd = today.getDate();
                var mm = today.getMonth() + 1;
                var yyyy = today.getFullYear();
                var hr = today.getHours();
                var min = today.getMinutes();

                if (min == '1' || min == '2' || min == '3' || min == '4' || min == '5' || min == '6' || min == '7' || min == '8' || min == '9') {
                    min = '0' + min;
                }

                if (dd < 10) {
                    dd = '0' + dd;
                }

                var mmm;
                if (mm == '1') {
                    mmm = 'Jan';
                } else if (mm == '2') {
                    mmm = 'Feb';
                } else if (mm == '3') {
                    mmm = 'Mar';
                } else if (mm == '4') {
                    mmm = 'Apr';
                } else if (mm == '5') {
                    mmm = 'May';
                } else if (mm == '6') {
                    mmm = 'Jun';
                } else if (mm == '7') {
                    mmm = 'Jul';
                } else if (mm == '8') {
                    mmm = 'Aug';
                } else if (mm == '9') {
                    mmm = 'Sep';
                } else if (mm == '10') {
                    mmm = 'Oct';
                } else if (mm == '11') {
                    mmm = 'Nov';
                } else if (mm == '12') {
                    mmm = 'Dec';
                }
                var today = dd + '-' + mmm + '-' + yyyy;
                var time = hr + ':' + min;

                return today; // date formated in dd-MMM-yyyy
                //time if time needed please uncomment it;
            }

            function reset(){
                var defaultCurrencyIndex = document.getElementById('<%= hdnDefaultCurrencyIndex.ClientID%>').value; 
                var defaultSalesPersonName = document.getElementById('<%= hdnDefaultSalesPersonName.ClientID%>').value; 
                $('#<%= txtSInvDate.ClientID %>').val(getCurrentDate());
                document.getElementById('<%= ddlCurrency.ClientID%>').selectedIndex= parseInt(defaultCurrencyIndex);
                setDecimalAndSymbol();
                $('#<%= Lbl_Tab_New.ClientID %>').text("New");
                $('#<%= txtInvoiecRefno.ClientID %>').val("");
                $('#<%= txtSInvNo.ClientID %>')[0].disabled=false;                              
                $('#<%= txtOrderId.ClientID %>').val("");
                $('#<%= txtPOSNo.ClientID %>').val("");
                $('#<%= txtCustomer.ClientID %>').val("");
                $('#<%= txtSalesPerson.ClientID %>').val(defaultSalesPersonName);
                $('#<%= txtSInvDate.ClientID %>').selectedIndex=0;
                $('#<%= txtInvoiceTo.ClientID %>').val("");
                $('#<%= txtShipCustomerName.ClientID %>').val("");
                $('#<%= txtShipingAddress.ClientID %>').val("");
                $('#<%= txtAmount.ClientID %>').val("");
                $('#<%= txtTotalQuantity.ClientID %>').val("");
                $('#<%= txtDiscountP.ClientID %>').val("");
                $('#<%= txtDiscountV.ClientID %>').val("");
                $('#<%= txtTaxP.ClientID %>').val("");
                $('#<%= txtTaxV.ClientID %>').val("");
                $('#<%= txtPriceafterdiscountheader.ClientID %>').val("");
                $('#<%= txtGrandTotal.ClientID %>').val("");
                $('#<%= txtTotalExpensesAmount.ClientID %>').val("");
                $('#<%= txtNetAmountwithexpenses.ClientID %>').val("");
                $('#<%= RdoSo.ClientID %>')[0].checked=false;
                $('#<%= RdoWithOutSo.ClientID %>')[0].checked=false;

                $('#<%= txtContactPerson.ClientID %>').val("");
                $('#<%= hdnContactId.ClientID %>').val("");
                setContactId("");
                document.getElementById('divProductSearch').style.display = "none";
                document.getElementById('divProducts').style.display = "none";
                document.getElementById('divPendingOrders').style.display = "none";                
                $('#tblPayment tbody').empty();
                $('#tblExpenses tbody').empty();
                $('#tblTax tbody').empty();
                $('#tblSerialNo tbody').empty();
                $('#tblProduct tbody').empty();
                $('#tblOrders tbody').empty();

                $('#<%= txtInvoiecRefno.ClientID %>').val("");
                getDocumentNo();
            }

            function getDocumentNo()
            {
                $("#prgBar").css("display","block");

                $.ajax({
                    type: "POST",
                    async: false,
                    url: "SalesInvoice1.aspx/getDocumentNumber",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function(data) {
                        
                        $('#<%= txtSInvNo.ClientID %>').val(data.d);
                        $('#<%= hdnDocNo.ClientID %>').val(data.d);
                        $("#prgBar").css("display","none");
                    }
                });

                <%--PageMethods.getDocumentNumber(function(data){
                    $('#<%= txtSInvNo.ClientID %>').val(data);
                    $('#<%= hdnDocNo.ClientID %>').val(data);
                    $("#prgBar").css("display","none");
                });--%>
            }
        function saveInvoice()
        {
            debugger;
                    
            //check customer exist or not
            var customerId = setCustomerId();
            if (customerId == "") {
                alert("Please select customer name");
                return;
            }
            //check product exist or not
            if (parseInt($('#tblProduct tbody tr').length)==0)
            {
                alert("There should be one product");
                return;
            }

            if ($('#<%= txtSalesPerson.ClientID %>').val()=="")
            {
                alert("Please add sales person name");
                return;
            }

            if ($('#<%= txtSInvNo.ClientID %>').val() == "")
            {
                alert("Invoice no should there");
                return;
            }

            //check payment information exist or not
            if (parseInt($('#tblPayment tbody tr').length) == 0) {
                alert("There should be payment information");
                return;
            }

           
            var InvoiceNo= $('#<%= editid.ClientID %>').val();           
            InvoiceNo=InvoiceNo==""?"0":InvoiceNo;
            var objSalesInvoice = new Object();
            objSalesInvoice.salesInvoiceId = InvoiceNo;
            objSalesInvoice.invoiceNo = $('#<%= txtSInvNo.ClientID %>').val();
                objSalesInvoice.invoiceDate=$('#<%= txtSInvDate.ClientID %>').val();
            objSalesInvoice.currencyId = $('#<%= ddlCurrency.ClientID %>').val();
            objSalesInvoice.invoiceCosting="0";
            if ($('#<%= RdoSo.ClientID %>')[0].checked==true)
            {
                objSalesInvoice.siFromTransType="S"; //D- For direct and S from sales order no
            }
            else
            {
                objSalesInvoice.siFromTransType="D"; //D- For direct and S from sales order no
            }
            
            objSalesInvoice.salesPersonCode = $('#<%= txtSalesPerson.ClientID %>').val().split('/')[1]; //need to get sales person id
            objSalesInvoice.posNo = $('#<%= txtPOSNo.ClientID %>').val();
            objSalesInvoice.remark=$('#<%= txtRemark.ClientID %>').val();
            objSalesInvoice.grossAmount=$('#<%= txtAmount.ClientID %>').val();
            objSalesInvoice.totalQuantity=$('#<%= txtTotalQuantity.ClientID %>').val();
            
            if('<%= hdnIsDiscountEnable.Value%>'=="true")
            {
                objSalesInvoice.discountPer=$('#<%= txtDiscountP.ClientID %>').val();
                objSalesInvoice.discountAmount=$('#<%= txtDiscountV.ClientID %>').val();
            }
            else
            {
                objSalesInvoice.discountPer="0";
                objSalesInvoice.discountAmount="0";            
            }

            if('<%= hdnIsTaxEnabled.Value%>'=="true")
            {
                objSalesInvoice.taxPer=$('#<%= txtTaxP.ClientID %>').val();
                    objSalesInvoice.taxAmount = $('#<%= txtTaxV.ClientID %>').val();
                }
                else
                {
                    objSalesInvoice.taxPer="0"
                    objSalesInvoice.taxAmount = "0";
                }

            
            


                objSalesInvoice.expensesAmount = $('#<%= txtTotalExpensesAmount.ClientID %>').val();
            objSalesInvoice.netAmount=$('#<%= txtGrandTotal.ClientID %>').val();
            objSalesInvoice.customerId = customerId;
            objSalesInvoice.invoiceRefNo = $('#<%= txtInvoiecRefno.ClientID %>').val();
            objSalesInvoice.invoiceMerchantId = $('#<%= ddlMerchant.ClientID %>').val();
            objSalesInvoice.refOrderNumber=$('#<%= txtOrderId.ClientID %>').val();                
            objSalesInvoice.contactId =$('#<%= hdnContactId.ClientID %>').val();

            objSalesInvoice.netAmountWithExp=$('#<%= txtNetAmountwithexpenses.ClientID %>').val();
            objSalesInvoice.jobCardId='<%= Session["JobCardId"]==null? "0": Session["JobCardId"].ToString() %>';

            if($('#<%= ddlTransType.ClientID %>').val()==null || $('#<%= ddlTransType.ClientID %>').val()==undefined)
            {
                objSalesInvoice.condition4="0";            
                objSalesInvoice.transType= "0";            
            }
            else
            {
                objSalesInvoice.transType= $('#<%= ddlTransType.ClientID %>').val();
                objSalesInvoice.condition4=$('#<%= ddlTransType.ClientID %>').val();
            }


            objSalesInvoice.condition1= $find('<%= txtCondition1.ClientID%>').get_content();

            objSalesInvoice.condition5 = "";
            objSalesInvoice.billingAddressId = $('#<%= txtInvoiceTo.ClientID %>').val().split('/')[1]; //txtInvoiceTo
            objSalesInvoice.shippingCustomerId = $('#<%= txtShipCustomerName.ClientID %>').val().split('/')[1]; //customerId-shipto.id
            objSalesInvoice.shippingAddressId = $('#<%= txtShipingAddress.ClientID %>').val().split('/')[1];; //txtShippingAddress.id
            objSalesInvoice.exchangeRate = $('#<%= txtExchangeRate.ClientID %>').val();
            objSalesInvoice.docNo= $('#<%= hdnDocNo.ClientID %>').val();
            objSalesInvoice.lstProductDetail = [];
            objSalesInvoice.lstProductSerialDetail = [];
            objSalesInvoice.lstTaxDetail = [];
            objSalesInvoice.lstExpensesDetail = [];
            objSalesInvoice.lstPaymentDetail = [];           
            var paymentAmount=0;
            //Generate json for payment detail
            $('#tblPayment tbody tr').each(function () {
                var row = $(this);
                var payment = {
                    "refRowSno": $(row).find("td:eq(0) a").val(),
                    "paymentModeId": $(row).find("td:eq(1) input[id='tblHdnPaymentModeID']").val(),
                    "accountId": $(row).find("td:eq(2) input[id='tblHdnAccountID']").val(),
                    "currencyId": $(row).find("td:eq(3) input[id='tblHdnCurrencyID']").val(),
                    "foreignAmount": $(row).find("td:eq(4)").html(),
                    "exchangeRate": $(row).find("td:eq(5)").html(),
                    "localAmount": $(row).find("td:eq(6)").html(),
                    "creditNoteVoucherId":$(row).find("td:eq(3) input[id='tblHdnVoucherID']").val(),  //in case of credit note
                    "cardNo":$(row).find("td:eq(3) input[id='tblHdnCardNo']").val(),
                    "cardName":"",
                    "chequeNo":$(row).find("td:eq(3) input[id='tblHdnChequeNo']").val(),
                    "chequeDate":$(row).find("td:eq(3) input[id='tblHdnChequeDate']").val()==""?"01-Jan-1800":$(row).find("td:eq(3) input[id='tblHdnChequeDate']").val(),
                    "bankId":"0", //$(row).find("td:eq(3) input[id='tblHdnBankId']").val()
                    "paymentType":$(row).find("td:eq(3) input[id='tblHdnPaymentType']").val()
                };
                objSalesInvoice.lstPaymentDetail.push(payment);

                if($(row).find("td:eq(4)").html()!=undefined)
                {
                    paymentAmount =  paymentAmount + parseFloat($(row).find("td:eq(4)").html());
                }
            });                    
            if(paymentAmount!=objSalesInvoice.netAmountWithExp)
            {
                alert("Invoice and Payment amount should be same");
                return;
            }

            //Generate json for product detail
            $('#tblProduct tbody tr').each(function () {
                var row = $(this);
                var product = {
                    "sNo": $(row).find("td:eq(2)").html(),
                    "salesOrderId": $(row).find("td:eq(1) input[id='tblHdnSalesOrderId']").val(), //1-tblHdnSalesOrderId
                    "isDeliveryVoucherAllow":$(row).find("td:eq(1) input[id='tblHdnDeliveryVoucher']").val()==undefined?false:$(row).find("td:eq(1) input[id='tblHdnDeliveryVoucher']").val()=="false"?false:true,
                    "productId": $(row).find("td:eq(3) input[id='tblHdnProductId']").val(),
                    "productDescription":"",
                    "orderQty": $(row).find("td:eq(8)").html()==""?"0":$(row).find("td:eq(8)").html(),//8
                    "salesQty": $(row).find("td:eq(12) input[id='tblTxtSalesQty']").val(),
                    "freeQty": $(row).find("td:eq(7) input[id='tblTxtFreeQty']").val(),
                    "unitId": $(row).find("td:eq(5) select[id='tblHdnUnitId']").val(),
                    "unitPrice": $(row).find("td:eq(6) input[id='tblTxtUnitPrice']").val(),
                    "discountPer": $(row).find("td:eq(14) input[id='tblTxtDiscountPer']").val()==""?"0":$(row).find("td:eq(14) input[id='tblTxtDiscountPer']").val(),
                    "discountValue": $(row).find("td:eq(15)").html()== "" ? "0" : $(row).find("td:eq(15)").html(),
                    "taxPer": $(row).find("td:eq(16) label[id='tblLblTaxPer']").text() == "" ? "0" : $(row).find("td:eq(16) label[id='tblLblTaxPer']").text(),
                    "taxValue": $(row).find("td:eq(17)").html() == "" ? "0" : $(row).find("td:eq(17)").html(),
                    "lineTotal": $(row).find("td:eq(18)").html(),
                    "txtCustomerCoopCode": $(row).find("td:eq(19) input[id='txtCustomerCoopCode']").val(),
                    "Location_Out": $(row).find("td:eq(20) select[id='Location_Out']").val()
                  
                };
                objSalesInvoice.lstProductDetail.push(product);
            });

            //Generate json for serial detail
            
            $('#tblSerialNo tbody tr').each(function () {
                var row = $(this);
                var productSerialNo = {
                    "refRowSno": $(row).find("td:eq(0)").html(),
                    "serialNo": $(row).find("td:eq(2)").html()
                };
                objSalesInvoice.lstProductSerialDetail.push(productSerialNo);
            });


            //Generate json for tax detail
            $('#tblTax tbody tr').each(function () {
                var row = $(this);
                var tax = {
                    "refRowSno": $(row).find("td:eq(0)").html(),
                    "taxId": $(row).find("td:eq(1)").html(),
                    "taxPer": $(row).find("td:eq(3)").html()
                };
                objSalesInvoice.lstTaxDetail.push(tax);
            });

            //Generate json for expenses detail
            $('#tblExpenses tbody tr').each(function () {
                var row = $(this);
                var expenses = {
                    "refRowSno": $(row).find("td:eq(0) a").val(),
                    "expenesId": $(row).find("td:eq(1) input[id='tblHdnExpensesId']").val(),
                    "currencyId": $(row).find("td:eq(2) input[id='tblHdnCurrencyId']").val(),
                    "foreignAmount": $(row).find("td:eq(3)")[0].childNodes[0].nodeValue,
                    "accountId": $(row).find("td:eq(3) input[id='tblHdnAccountId'] ").val(),
                    "exchangeRate": $(row).find("td:eq(4)").html(),
                    "localAmount": $(row).find("td:eq(5)").html()
                };
                objSalesInvoice.lstExpensesDetail.push(expenses);
            });
            console.log(JSON.stringify(objSalesInvoice));

            $("#prgBar").css("display","block");
            //ajax call to set data
            $.ajax({
                url: 'SalesInvoice1.aspx/updateInvoice',
                method: 'post',
                contentType: "application/json;",
                data: "{clsSInvHeader:" + JSON.stringify(objSalesInvoice) + "}",
                dataType:'json',
                success: function (data) {
                    var response = data.d;
                    alert(response[1]);                            
                    if(response[0]!="fail")
                    {
                        reset();
                        if (confirm("Do you want to print the invoice")) {
                            window.open('../Sales/SalesInvoicePrint.aspx?Id=' + response[2] + '', 'window', 'width=1024');
                        }
                        fillTblInvoice();
                    }
                    $("#prgBar").css("display","none");
                },
                error: function (request, status, error) {
                    alert(request.responseText);
                    $("#prgBar").css("display","none");
                }
            });


        }

        
        var gridSellectionCount=0;
        function gridActions(ctrl)
        {
            var ddlAction_ = document.getElementById('<%= ddlAction.ClientID%>');
            if(ctrl.checked==true)
            {
                gridSellectionCount=gridSellectionCount+1;
            }
            else
            {
                gridSellectionCount=gridSellectionCount-1;
            }
            ddlAction_.selectedIndex=0;

            $('#tblInvoice tbody tr').each(function(){
                var tblInvoiceRow = $(this);
                if($(tblInvoiceRow).find("td:eq(0)").html()!=undefined)
                {
                    if($(tblInvoiceRow).find("td:eq(0)")[0].childNodes[0]==ctrl)
                    {
                        $(tblInvoiceRow).find("td:eq(0)")[0].childNodes[0].checked=ctrl.checked;
                    }
                    else
                    {
                        $(tblInvoiceRow).find("td:eq(0)")[0].childNodes[0].checked=false;
                    }
                }                         
            });
        }


        function setDllActionOptions()
        {

            var ddlPosted_ = document.getElementById('<%= ddlPosted.ClientID%>');
                var ddlAction_ = document.getElementById('<%= ddlAction.ClientID%>');

                var hdnCanView_ = document.getElementById('<%= hdnCanView.ClientID%>');
                var hdnCanEdit_ = document.getElementById('<%= hdnCanEdit.ClientID%>');
                var hdnCanSave_ = document.getElementById('<%= hdnCanSave.ClientID%>');
                var hdnCanPrint_ = document.getElementById('<%= hdnCanPrint.ClientID%>');
                var hdnCanRestore_ = document.getElementById('<%= hdnCanRestore.ClientID%>');
                var hdnCanUpload_ = document.getElementById('<%= hdnCanUpload.ClientID%>');
                var hdnCanDelete_ = document.getElementById('<%= hdnCanDelete.ClientID%>');


                $('#<%= ddlAction.ClientID %>').empty();
                if(ddlPosted_.value == "posted")
                {
                    $('#<%= ddlAction.ClientID %>').append(new Option("Select Action", "0"));      
                        if(hdnCanPrint_.value=="True")
                        {
                            $('#<%= ddlAction.ClientID %>').append(new Option("Print Invoice", "Invoice"));                
                            $('#<%= ddlAction.ClientID %>').append(new Option("Print Delivery", "Delivery"));                
                        }
                        if(hdnCanView_.value=="True")
                        {
                            $('#<%= ddlAction.ClientID %>').append(new Option("View", "View"));                
                        }                        
                    }
                    if(ddlPosted_.value == "unPosted")
                    {
                        $('#<%= ddlAction.ClientID %>').append(new Option("Select Action", "0"));                
                        if(hdnCanPrint_.value=="True")
                        {
                            $('#<%= ddlAction.ClientID %>').append(new Option("Print Invoice", "Invoice"));                
                            $('#<%= ddlAction.ClientID %>').append(new Option("Print Delivery", "Delivery"));                
                        }
                        if(hdnCanView_.value=="True")
                        {
                            $('#<%= ddlAction.ClientID %>').append(new Option("View", "View"));                
                        }
                        if(hdnCanEdit_.value=="True")
                        {
                            $('#<%= ddlAction.ClientID %>').append(new Option("Edit", "Edit"));                 
                        }
                        if(hdnCanDelete_.value=="True")
                        {
                            $('#<%= ddlAction.ClientID %>').append(new Option("Delete", "Delete"));               
                        } 
                        $('#<%= ddlAction.ClientID %>').append(new Option("Cancel", "Cancel")); 

                    }
                    if(ddlPosted_.value == "inActive")
                    {
                        $('#<%= ddlAction.ClientID %>').append(new Option("Select Action", "0"));        
                        if(hdnCanRestore_.value=="True")
                        {
                            $('#<%= ddlAction.ClientID %>').append(new Option("Restore", "Restore"));                     
                        } 
                    }
                }
               
                function ddlActionChange(ctrl)
                {

                    debugger;
                    var transId="0";
                    var hdnIsApproved_ = document.getElementById('<%= hdnIsApproved.ClientID%>');

                    $('#tblInvoice tbody tr').each(function(){
                        var tblInvoiceRow = $(this);
                        if($(tblInvoiceRow).find("td:eq(0)").html()!=undefined)
                        {
                            if($(tblInvoiceRow).find("td:eq(0)")[0].childNodes[0].checked)
                            {
                                transId = $(tblInvoiceRow).find("td:eq(0)")[0].childNodes[0].value;
                                return;
                            }
                        }                         
                    });

                    if(transId=="0")
                    {
                        return;
                    }
                    if(ctrl.value=="Cancel")
                    {
                       
                        debugger;
                      var a=CancelData(transId);                 
                      debugger;
                      clearTimeout(animate);
                      return;
                      //return false;
                     
                    }
                    if(ctrl.value=="Invoice")
                    {
               
                        PageMethods.IbtnPrint_Command(transId,hdnIsApproved_.value,function(data){
                            if(data=="true")
                            {
                                window.open('../Sales/SalesInvoicePrint.aspx?Id=' + transId + '', 'window', 'width=1024');
                            }
                            else
                            {
                                alert(data);
                            }
                        },errorMessages);
                    }

                    if(ctrl.value=="Delivery")
                    {
                        PageMethods.IbtnDeliveryPrint_Command(transId,function(data){
                            if(data=="true")
                            {
                                window.open('../Sales_Report/DeliveryVoucherReport.aspx?Id=' + transId + '','window','width=1024, ');
                            }
                            else
                            {
                                alert(data);
                            }
                        },errorMessages);                
                    }
                    if(ctrl.value=="Delete")
                    {
                        $("#prgBar").css("display","block");
                        PageMethods.IbtnDelete_Command(transId,hdnIsApproved_.value,function(data){
                            alert(data);
                            fillTblInvoice();
                            $("#prgBar").css("display","none");
                        },errorMessages);
                    }
                    if(ctrl.value=="Restore")
                    {
                        $("#prgBar").css("display","block");
                        PageMethods.imgBtnRestore_Click(transId,function(data){
                            alert(data);
                            fillTblInvoice();
                            $("#prgBar").css("display","none");
                        },errorMessages);                
                    }
                    if(ctrl.value=="View")
                    {
                        reset();
                        $("#prgBar").css("display","block");
                        $('#<%= Lbl_Tab_New.ClientID %>').text("View");
                        PageMethods.getInvoice(transId,ctrl.value,"",function(data){
                            var objSalesInvoice=JSON.parse(data);
                            debugger;
                            $('#<%= editid.ClientID %>').val(objSalesInvoice.salesInvoiceId);
                            $('#<%= txtSInvNo.ClientID %>').val(objSalesInvoice.invoiceNo);   
                            $('#<%= txtSInvNo.ClientID %>')[0].disabled=true;          
                    
                            $('#<%= txtSInvDate.ClientID %>').val(objSalesInvoice.invoiceDate);
                            $('#<%= txtInvoiecRefno.ClientID %>').val(objSalesInvoice.invoiceRefNo);
                            $('#<%= txtOrderId.ClientID %>').val(objSalesInvoice.refOrderNumber);
                            $('#<%= txtPOSNo.ClientID %>').val(objSalesInvoice.posNo);
                            $('#<%= txtCustomer.ClientID %>').val(objSalesInvoice.customerName+'/'+objSalesInvoice.customerId);
                            
                            //setContactId(objSalesInvoice.customerId);
                            if(!(objSalesInvoice.contactId=="" || objSalesInvoice.contactId=="0"))
                            {
                                $('#<%= txtContactPerson.ClientID %>').val(objSalesInvoice.contactName+'/'+objSalesInvoice.contactId);
                                $('#<%= hdnContactId.ClientID %>').val(objSalesInvoice.contactId);
                            }

                            $('#<%= txtSalesPerson.ClientID %>').val(objSalesInvoice.salesPersonName+'/'+objSalesInvoice.salesPersonCode);
                            $('#<%= txtInvoiceTo.ClientID %>').val(objSalesInvoice.billingAddressName+'/'+ objSalesInvoice.billingAddressId);
                            $('#<%= txtShipCustomerName.ClientID %>').val(objSalesInvoice.shippingCustomerName+'/'+objSalesInvoice.shippingCustomerId);
                            $('#<%= txtShipingAddress.ClientID %>').val(objSalesInvoice.shippingAddressName+'/'+objSalesInvoice.shippingAddressId);
                            $('#<%= txtAmount.ClientID %>').val(objSalesInvoice.grossAmount);
                            $('#<%= txtTotalQuantity.ClientID %>').val(objSalesInvoice.totalQuantity);
                            $('#<%= hdnDecimalCount.ClientID %>').val(objSalesInvoice.currencyDecimalCount);
                    
                            $('#<%= RdoSo.ClientID %>')[0].enabled=false;
                            $('#<%= RdoWithOutSo.ClientID %>')[0].enabled=false;

                            $('#<%= txtAmount.ClientID %>').val(objSalesInvoice.totalAmount);
                            $('#<%= txtTotalQuantity.ClientID %>').val(objSalesInvoice.totalQuantity);

                            $('#<%= txtAmount.ClientID %>').val(objSalesInvoice.netAmount);
                            $('#<%= txtTotalQuantity.ClientID %>').val(objSalesInvoice.totalQuantity);
                            $('#<%= hdnDenomination.ClientID %>').val(objSalesInvoice.denomination);
                        
                            if(document.getElementById('<%= ddlTransType.ClientID%>')!=null ||document.getElementById('<%= ddlTransType.ClientID%>')!=undefined)
                            {
                                document.getElementById('<%= ddlTransType.ClientID%>').value= parseInt(objSalesInvoice.transType);
                    
                            }
					
                            document.getElementById('divProductSearch').style.display = "none";
                            document.getElementById('divProducts').style.display = "none";
                            document.getElementById('divPendingOrders').style.display = "none";
                            var invoiceType="";
                            if (objSalesInvoice.siFromTransType=="S")
                            {
                                invoiceType="so";
                                $('#<%= RdoWithOutSo.ClientID %>')[0].checked=false;
                            $('#<%= RdoSo.ClientID %>')[0].checked=true;
                            GetPendingSalesOrder();
                            $("#prgBar").css("display","block");
                            document.getElementById('divPendingOrders').style.display = "block";
                        }
                        else
                        {   
                            invoiceType="wso";
                            $('#<%= RdoWithOutSo.ClientID %>')[0].checked=true;
                            $('#<%= RdoSo.ClientID %>')[0].checked=false;
                            document.getElementById('divProductSearch').style.display = "block";
                            document.getElementById('divProducts').style.display = "block";
                        }
                
                            $(objSalesInvoice.lstProductDetail).each(function(){
                                var data =$(this);
                                if(data!=undefined)
                                {
                                    fillTblProduct(data[0],0,this,invoiceType);                         
                                }
                            });
                    
                            $(objSalesInvoice.lstProductSerialDetail).each(function(){

                                var data=$(this);
                                if(data!=undefined)
                                {
                                    addRowToSerailNoTable(data[0].refRowSno,data[0].serialNo);                         
                                }
                            });

                            $(objSalesInvoice.lstTaxDetail).each(function(){
                                var data=$(this);
                                if(data!=undefined)
                                {
                                    addTax(data[0].refRowSno,data[0].taxId,data[0].taxName,data[0].taxPer);                         
                                }
                            });
                    
                            $(objSalesInvoice.lstExpensesDetail).each(function(){
                                var data=$(this);
                                if(data!=undefined)
                                {
                                    setExpensesTable(data[0]);                         
                                }
                            });
                    
                            $(objSalesInvoice.lstPaymentDetail).each(function(){
                                var data=$(this);
                                if(data!=undefined)
                                {
                                    setPaymentTable(data[0]);                         
                                }
                            });                    
                            LI_Edit_Active();
                            $("#prgBar").css("display","none");
                           
                        },errorMessages); 
                 document.getElementById('btnSaveUsingAjax').style.visibility="hidden";
                }
                if(ctrl.value=="Edit")
                {
                    reset();
                    $("#prgBar").css("display","none");
                    $("#prgBar").css("display","block");
                    PageMethods.getInvoice(transId,ctrl.value,"",function(data){
                        var objSalesInvoice=JSON.parse(data);
                            
                    debugger;  
                        $('#<%= Lbl_Tab_New.ClientID %>').text("Edit");
                        $('#<%= editid.ClientID %>').val(objSalesInvoice.salesInvoiceId);
                            $('#<%= txtSInvNo.ClientID %>').val(objSalesInvoice.invoiceNo);          
                            $('#<%= txtSInvNo.ClientID %>')[0].disabled=true;                              
                            $('#<%= txtSInvDate.ClientID %>').val(objSalesInvoice.invoiceDate);
                            $('#<%= txtInvoiecRefno.ClientID %>').val(objSalesInvoice.invoiceRefNo);
                            $('#<%= txtOrderId.ClientID %>').val(objSalesInvoice.refOrderNumber);
                            $('#<%= txtPOSNo.ClientID %>').val(objSalesInvoice.posNo);
                            $('#<%= txtCustomer.ClientID %>').val(objSalesInvoice.customerName+'/'+objSalesInvoice.customerId);
                            
                          if(!(objSalesInvoice.contactId=="" || objSalesInvoice.contactId=="0"))
                            {
                                $('#<%= txtContactPerson.ClientID %>').val(objSalesInvoice.contactName+'/'+objSalesInvoice.contactId);
                                $('#<%= hdnContactId.ClientID %>').val(objSalesInvoice.contactId);
                            }
                            $('#<%= txtSalesPerson.ClientID %>').val(objSalesInvoice.salesPersonName+'/'+objSalesInvoice.salesPersonCode);
                            $('#<%= txtInvoiceTo.ClientID %>').val(objSalesInvoice.billingAddressName+'/'+ objSalesInvoice.billingAddressId);
                            $('#<%= txtShipCustomerName.ClientID %>').val(objSalesInvoice.shippingCustomerName+'/'+objSalesInvoice.shippingCustomerId);
                            $('#<%= txtShipingAddress.ClientID %>').val(objSalesInvoice.shippingAddressName+'/'+objSalesInvoice.shippingAddressId);
                            $('#<%= txtAmount.ClientID %>').val(objSalesInvoice.grossAmount);
                            $('#<%= txtTotalQuantity.ClientID %>').val(objSalesInvoice.totalQuantity);
                            $('#<%= hdnDecimalCount.ClientID %>').val(objSalesInvoice.currencyDecimalCount);
                    
                            if(document.getElementById('<%= ddlTransType.ClientID%>')!=null ||document.getElementById('<%= ddlTransType.ClientID%>')!=undefined)
                            {
                                document.getElementById('<%= ddlTransType.ClientID%>').value= parseInt(objSalesInvoice.transType);
                    
                        }
                        
                            $('#<%= RdoSo.ClientID %>')[0].enabled=false;
                            $('#<%= RdoWithOutSo.ClientID %>')[0].enabled=false;

                            $('#<%= txtAmount.ClientID %>').val(objSalesInvoice.totalAmount);
                            $('#<%= txtTotalQuantity.ClientID %>').val(objSalesInvoice.totalQuantity);

                            $('#<%= txtAmount.ClientID %>').val(objSalesInvoice.netAmount);
                            $('#<%= txtTotalQuantity.ClientID %>').val(objSalesInvoice.totalQuantity);
                            $('#<%= hdnDenomination.ClientID %>').val(objSalesInvoice.denomination);
                            document.getElementById('divProductSearch').style.display = "none";
                            document.getElementById('divProducts').style.display = "none";
                            document.getElementById('divPendingOrders').style.display = "none";

                            var invoiceType="";
                            if (objSalesInvoice.siFromTransType=="S")
                            {
                                invoiceType="so";
                                $('#<%= RdoWithOutSo.ClientID %>')[0].checked=false;
                            $('#<%= RdoSo.ClientID %>')[0].checked=true;
                            GetPendingSalesOrder();
                            $("#prgBar").css("display","block");
                            document.getElementById('divPendingOrders').style.display = "block";
                        }
                        else
                        {   
                            invoiceType="wso";
                            $('#<%= RdoWithOutSo.ClientID %>')[0].checked=true;
                            $('#<%= RdoSo.ClientID %>')[0].checked=false;
                            document.getElementById('divProductSearch').style.display = "block";
                            document.getElementById('divProducts').style.display = "block";
                        }

                
                            $(objSalesInvoice.lstProductDetail).each(function(){
                                var data =$(this);
                                if(data!=undefined)
                                {
                                    //setProductTable(data[0]);
                                    fillTblProduct(data[0],'0',this,invoiceType);                         
                                }
                            });
                    
                            $(objSalesInvoice.lstProductSerialDetail).each(function(){

                                var data=$(this);
                                if(data!=undefined)
                                {
                                    addRowToSerailNoTable(data[0].refRowSno,data[0].serialNo);                         
                                }
                            });

                            $(objSalesInvoice.lstTaxDetail).each(function(){
                                var data=$(this);
                                if(data!=undefined)
                                {
                                    addTax(data[0].refRowSno,data[0].taxId,data[0].taxName,data[0].taxPer);                         
                                }
                            });
                    
                            $(objSalesInvoice.lstExpensesDetail).each(function(){
                                var data=$(this);
                                if(data!=undefined)
                                {
                                    setExpensesTable(data[0]);                         
                                }
                            });
                    
                            $(objSalesInvoice.lstPaymentDetail).each(function(){
                                var data=$(this);
                                if(data!=undefined)
                                {
                                    setPaymentTable(data[0]);                         
                                }
                            });
                    
                            LI_Edit_Active();
                            $("#prgBar").css("display","none");
                        },errorMessages);    
                    document.getElementById('btnSaveUsingAjax').style.visibility="visible";
                }            
            }

            function setExpensesTable(row)
            {        
                var htmlRow = "<tr>";
                htmlRow = htmlRow + "<td><a value='" + row.refRowSno + "' title='Delete' style='cursor:pointer' onclick='deleteExpensesRow(this)'> <img src='../images/erase.png' > </a></td>";
                htmlRow = htmlRow + "<td>" + row.expensesName + " <input type='hidden' id='tblHdnExpensesId' value='" + row.expenseId  + "'> </td>"; 
                htmlRow = htmlRow + "<td>" + row.currencyName + " <input type='hidden' id='tblHdnCurrencyId' value='" + row.currencyId + "'></td>";
                htmlRow = htmlRow + "<td>" + row.foreignAmount + " <input type='hidden' id='tblHdnAccountId' value='"+row.accountId+"'></td>";                                   
                htmlRow = htmlRow + "<td>" + row.exchangeRate + "</td>";
                htmlRow = htmlRow + "<td>" + row.localAmount + "</td>";
                htmlRow = htmlRow + "<td>" + row.localAmount + "</td>";
                htmlRow = htmlRow + "</tr>";
                $('#tblExpenses > tbody:last-child').append(htmlRow);
            }
            function setPaymentTable(row)
            {

                var htmlRow = "<tr>";
                htmlRow = htmlRow + "<td><a value='" + row.sNo + "' title='Delete' style='cursor:pointer' onclick='deletePaymentRow(this)'> <img src='../images/erase.png' > </a></td>";
                htmlRow = htmlRow + "<td>" + row.paymentModeName + " <input type='hidden' id='tblHdnPaymentModeID' value='" + row.paymentModeId + "'> </td>"; 
                htmlRow = htmlRow + "<td>" + row.accountName + " <input type='hidden' id='tblHdnAccountID' value='" + row.accountId + "'></td>";
                htmlRow = htmlRow + "<td style='display:none;'> <input type='hidden' id='tblHdnVoucherID' value='"+row.creditNoteVoucherId+"'><input type='hidden' id='tblHdnBankId' value='"+row.bankId+"'><input type='hidden' id='tblHdnChequeDate' value='"+row.chequeDate+"'> <input type='hidden' id='tblHdnChequeNo' value='"+row.chequeNo+"'> <input type='hidden' id='tblHdnBankAccountNo' value=''><input type='hidden' id='tblHdnBankAccountName' value=''> <input type='hidden' id='tblHdnCurrencyID' value='" + row.currencyId + "'><input type='hidden' id='tblHdnCardNo' value='" + row.cardNo + "'><input type='hidden' id='tblHdnCardName' value='" + row.cardName + "'><input type='hidden' id='tblHdnPaymentType' value='" + row.paymentType + "'></td>";
                htmlRow = htmlRow + "<td>" + row.localAmount + "</td>";
                htmlRow = htmlRow + "<td>" + row.exchangeRate + "</td>";
                htmlRow = htmlRow + "<td>" + row.localAmount + "</td>";
                htmlRow = htmlRow + "</tr>";
                $('#tblPayment > tbody:last-child').append(htmlRow);
            }

        
            function btnexecute_Click()
            {
                debugger;
                var productId = $('#<%=hdnProductIdForSno.ClientID %>').val();
            var txtSerialNo_=  document.getElementById('<%= txtSerialNo.ClientID%>');
            $("#prgBar").css("display","block");
            PageMethods.getProductSerialFromStock(productId,function(json){
                debugger;
                if(json=="No Record Found")
                {
                    alert("No Record Found");
                    $("#prgBar").css("display","none");
                    return;
                }
                var data=JSON.parse(json);

                $(data).each(function(){
                    
                    var serialnoData=$(this);
                    txtSerialNo_.value=txtSerialNo_.value+serialnoData[0].serialNo+"\n";
                });
                $("#prgBar").css("display","none");
            },errorMessages);
        }
        function btnSInvCancel_Click()
        {
            reset();
            LI_List_Active();
        }
        function getRoundOffAmount(amount)
        {
            
            var decimalCount=parseInt($('#<%= hdnDecimalCount.ClientID %>').val());
                 var denomimination=parseFloat($('#<%= hdnDenomination.ClientID %>').val());
                 if(isNaN(denomimination))
                 {
                     denomimination=0;
                 }
                 try
                 {
                
                     var amount=parseFloat(amount);
                     var decValue = amount.toString().split('.')[1];
                     if (decValue <= 0)
                     {
                         return GetAmountWithDecimal(amount,decimalCount);
                     }

                     var roundOfValue = 0;
                     if (denomimination != 0 && denomimination!='' && denomimination!= NaN)
                     {
                         var modulerValue = amount % denomimination;
                         var actualValue = amount - modulerValue;
                         var devideValue = denomimination / 2;
                         if (modulerValue >= devideValue)
                             roundOfValue = actualValue + denomimination;
                         else
                             roundOfValue = actualValue + 0;                    
                     }
                     else
                     {
                         roundOfValue = Amount;
                     }
                     roundOfValue = GetAmountWithDecimal(roundOfValue,decimalCount);
                     return roundOfValue ;
                 }
                 catch(e)
                 {
                     return  GetAmountWithDecimal(amount,decimalCount);
                 }
             }

             function fillTblPendingOrder()
             {
                 $("#prgBar").css("display","block");
                 PageMethods.fillTblPendingOrder(function(json){
                     var pendingOrder=JSON.parse(json);

                     $('#tblPendingOrder').dataTable({
                         data:pendingOrder,
                         destroy: true,
                         columns:[{data:"SalesOrderNo"},
                         {data:"SalesOrderDate"},
                         {data:"TransType"},
                         {data:"QuotationNo"},
                         {data:"CustomerName"},
                         {data:"ProductCode"},
                         {data:"Unit_Name"},
                         {data:"sysQty"},
                         {data:"OrderQty"},
                         {data:"RemainQty"},
                         {data:"CreatedUser"},
                         {data:"NetAmount",render:function(amt,display,row){
                             return "<label>"+row.Currency_Code+" "+GetAmountWithDecimal(amt,row.decimalCount)+"</label>";
                         }},
                         ]
                     });
                     $("#prgBar").css("display","none");
                 });

             }
             function btnAddProductScreen_Click()
             {
                 var custid = setCustomerId();
                 if(custid=="" ||custid=="0")
                 {
                     alert("Please add customer id");
                     return;
                 }
                 var currencyid =document.getElementById('<%=ddlCurrency.ClientID%>');
            window.open('../Inventory/AddItem.aspx?Page=SIN&&CustomerId=' + custid + '&&CurId=' + currencyid.value + '','window','width=1024');        
            }
        function btnAddtoList_Click()
        {        
            debugger;
            var decimalCount = document.getElementById('<%= hdnDecimalCount.ClientID%>').value;
            $("#prgBar").css("display","block");
            PageMethods.getTblProductDataFromAvdSearch(decimalCount,function(data){
                
                var json= JSON.parse(data);
                $(json).each(function(){
                    console.log(json);
                    var row =$(this);
                    if(row!=undefined)
                    {
                        fillTblProduct(row[0],'0',this,"wso");
                        //setProductTable(row[0]);                   
                    }                    
                });
                $("#prgBar").css("display","none");
            });
        }
        function fillTblAdvancePayment(orderId,orderNo)
        {
            
            var btnshowAdvancePayment_= document.getElementById('btnshowAdvancePayment');

            $("#prgBar").css("display","block");
            PageMethods.fillAdvancePayment_BYOrderId(orderId,orderNo,function(data){
                
                var result=data[0];
                if(result=="true")
                {
                    $('#tblAdvancePayment tbody').empty();
                    var json= JSON.parse(data[1]);
                    btnshowAdvancePayment_.style.visibility="visible";
                    $(json).each(function(){
                        var row =$(this);
                        if(row!=undefined)
                        {
                            setTblAdvancePayment(row[0]);                   
                        }                    
                    });
                }
                //else
                //{
                //    btnshowAdvancePayment_.style.visibility="hidden";
                //}
                $("#prgBar").css("display","none");
            });
        }
        function setTblAdvancePayment(row)
        {
            var decimalCount = document.getElementById('<%= hdnDecimalCount.ClientID%>').value;
            var htmlRow="<tr>";
            htmlRow=htmlRow+"<td>"+row.OrderNo+"</td>";
            htmlRow=htmlRow+"<td>"+row.PaymentName+"</td>";
            htmlRow=htmlRow+"<td>"+row.AccountName+"</td>";
            htmlRow=htmlRow+"<td>"+GetAmountWithDecimal(row.Pay_Charges,decimalCount)+"</td>";
            htmlRow=htmlRow+"</tr>";
            $('#tblAdvancePayment > tbody:last-child').append(htmlRow);
        }
        function showAdvancePaymentTbl()
        {
            $('#advancePayment').modal('show');
        }

        // user when we are redirecting from other page
        function urlRequest()
        {
            
            var urlParams = new URLSearchParams(window.location.search);
            //console.log(urlParams.has('post')); // true
            var id=urlParams.get('Id');
            var StrLocationId = urlParams.get('LocId');
            viewInvoice(id,StrLocationId);
        }

        function viewInvoice(transId,locationid)
        {            
            reset();
            locationid=locationid==null?"":locationid;
            debugger;
            $("#prgBar").css("display","block");
            $('#<%= Lbl_Tab_New.ClientID %>').text("View");
            PageMethods.getInvoice(transId,"View",locationid,function(data){
                debugger;
                var objSalesInvoice=JSON.parse(data);
                $('#<%= editid.ClientID %>').val(objSalesInvoice.salesInvoiceId);
                $('#<%= txtSInvNo.ClientID %>').val(objSalesInvoice.invoiceNo);   
                $('#<%= txtSInvNo.ClientID %>')[0].disabled=true;          
                    
                $('#<%= txtSInvDate.ClientID %>').val(objSalesInvoice.invoiceDate);
                $('#<%= txtInvoiecRefno.ClientID %>').val(objSalesInvoice.invoiceRefNo);
                $('#<%= txtOrderId.ClientID %>').val(objSalesInvoice.refOrderNumber);
                $('#<%= txtPOSNo.ClientID %>').val(objSalesInvoice.posNo);
                $('#<%= txtCustomer.ClientID %>').val(objSalesInvoice.customerName+'/'+objSalesInvoice.customerId);
                $('#<%= txtSalesPerson.ClientID %>').val(objSalesInvoice.salesPersonName+'/'+objSalesInvoice.salesPersonCode);
                $('#<%= txtInvoiceTo.ClientID %>').val(objSalesInvoice.billingAddressName+'/'+ objSalesInvoice.billingAddressId);
                $('#<%= txtShipCustomerName.ClientID %>').val(objSalesInvoice.shippingCustomerName+'/'+objSalesInvoice.shippingCustomerId);
                $('#<%= txtShipingAddress.ClientID %>').val(objSalesInvoice.shippingAddressName+'/'+objSalesInvoice.shippingAddressId);
                $('#<%= txtAmount.ClientID %>').val(objSalesInvoice.grossAmount);
                $('#<%= txtTotalQuantity.ClientID %>').val(objSalesInvoice.totalQuantity);
                $('#<%= hdnDecimalCount.ClientID %>').val(objSalesInvoice.currencyDecimalCount);
                    
                $('#<%= RdoSo.ClientID %>')[0].enabled=false;
                $('#<%= RdoWithOutSo.ClientID %>')[0].enabled=false;

                $('#<%= txtAmount.ClientID %>').val(objSalesInvoice.totalAmount);
                $('#<%= txtTotalQuantity.ClientID %>').val(objSalesInvoice.totalQuantity);

                $('#<%= txtAmount.ClientID %>').val(objSalesInvoice.netAmount);
                $('#<%= txtTotalQuantity.ClientID %>').val(objSalesInvoice.totalQuantity);
                $('#<%= hdnDenomination.ClientID %>').val(objSalesInvoice.denomination);
                        
                if(document.getElementById('<%= ddlTransType.ClientID%>')!=null ||document.getElementById('<%= ddlTransType.ClientID%>')!=undefined)
                {
                    document.getElementById('<%= ddlTransType.ClientID%>').value= parseInt(objSalesInvoice.transType);
                    
                }
                    
                var invoiceType="";
                if (objSalesInvoice.siFromTransType=="S")
                {
                    invoiceType='so';
                    $('#<%= RdoWithOutSo.ClientID %>')[0].checked=false;
                    $('#<%= RdoSo.ClientID %>')[0].checked=true;
                    GetPendingSalesOrder();
                }
                else
                {                    
                    invoiceType='wso';
                    $('#<%= RdoWithOutSo.ClientID %>')[0].checked=true;
                    $('#<%= RdoSo.ClientID %>')[0].checked=false;
                }

                
                $(objSalesInvoice.lstProductDetail).each(function(){
                    var data =$(this);
                    if(data!=undefined)
                    {
                        //setProductTable(data[0]);                         
                        fillTblProduct(data[0],'0',this,invoiceType);
                    }
                });
                    
                $(objSalesInvoice.lstProductSerialDetail).each(function(){

                    var data=$(this);
                    if(data!=undefined)
                    {
                        addRowToSerailNoTable(data[0].refRowSno,data[0].serialNo);                         
                    }
                });

                $(objSalesInvoice.lstTaxDetail).each(function(){
                    var data=$(this);
                    if(data!=undefined)
                    {
                        addTax(data[0].refRowSno,data[0].taxId,data[0].taxName,data[0].taxPer);                         
                    }
                });
                    
                $(objSalesInvoice.lstExpensesDetail).each(function(){
                    var data=$(this);
                    if(data!=undefined)
                    {
                        setExpensesTable(data[0]);                         
                    }
                });
                    
                $(objSalesInvoice.lstPaymentDetail).each(function(){
                    var data=$(this);
                    if(data!=undefined)
                    {
                        setPaymentTable(data[0]);                         
                    }
                });
                    
                LI_Edit_Active();
                $("#prgBar").css("display","none");
            },errorMessages);    

            document.getElementById('btnSaveUsingAjax').style.visibility="hidden";
        }

        function txtContactPerson_TextChanged(ctrl) {
            debugger;
            if (ctrl.value == "") {
                ctrl.value = "";
                document.getElementById('<%= hdnContactId.ClientID %>').value = "";
                return;
            }
            var id = ctrl.value.split('/')[1];
            var name = ctrl.value.split('/')[0];
            if (!$.isNumeric(id)) {
                alert("Contact Person is not valid");
                ctrl.value = "";
                document.getElementById('<%= hdnContactId.ClientID %>').value = "";
                return;
            }
            var id1 = getContactIdFromNameNId(name, id);
            document.getElementById('<%= hdnContactId.ClientID %>').value = id1;
            if (id.trim() != id1.trim()) {
                alert("Contact Person is not valid");
                ctrl.value = "";
                document.getElementById('<%= hdnContactId.ClientID %>').value = "";
            }
        }
        function Modal_NewAddress_Open() {
            document.getElementById('<%= Btn_NewAddress.ClientID %>').click();
        }
        function resetPosition1()
        {

        }
        function Modal_CustomerInfo_Open() {
            $('#modelContactDetail').modal('show');
        }
    </script>
      <link href="../CSS/controlsCss.css" rel="stylesheet" />

    <script type="text/javascript">
        function View_Modal_Popup() {
            debugger;
            ShowPopup();
           // document.getElementById('<%= btnShowPopup.ClientID %>').click();
        }
       

    </script>

       <script type="text/javascript">
        function ShowPopup() {
            $("#MyPopup .modal-title").html("Cancel Invoice");
            $("#MyPopup").modal("show");
        }
    </script>
    <script src="../Script/customer.js"></script>
</asp:Content>
